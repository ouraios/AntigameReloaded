if(!AGB)var AGB={};AGB.Option={Data:{},Limit:{U11:[0,7],U62:[0,100],U65:[0,20],U66:[0,100],U67:[0,100],B21:[0,3],B35:[0,2],CM3:[0,100],I05:[1,100],CT2:[0,100],D04:[1,3],D61:[1,3],D71:[0,2],D81:[0,2],O03:[0,4],I02:[0,9],I85:[0,500],F02:[0,3],F70:[0,3],F80:[0,3],F90:[0,3],FA0:[0,3],FA1:[0,3],FH0:[0,3],FL0:[0,3],FL2:[0,6],E23:[1,2],E41:[0,8],E42:[0,8],E43:[0,8],E44:[0,8],E45:[0,8],E46:[0,8],E47:[0,8],E48:[0,8],E49:[0,8],G42:[0,3],G45:[0,3],M12:[0,4],M28:[1,9],M30:[0,5]},Messages:function(e,t,a){"Set"===e?AGB.Option.Set(t,a):"Menu"===e?AGB.Option.Menu(t,a):"Save"===e&&AGB.Option.MenuSave(t,a)},Init:function(e,t){var a,n,i,r,s,o;if(i=AGB.App.getPlayer(e)){if(AGB.Option.Data[i]={status:2},a=OBJ.parse(OBJ.get(t,AGB.Data.getKey(i,"Option","Data"))),n=OBJ.parse(OBJ.get(t,AGB.Data.getKey(i,"Option","Local"))),a.version){for(AGB.Option.Data[i].version=a.version,AGB.Option.Data[i].status=NMR.minMax(a.status,1,2),s=STR.check(a.empty).split(","),o=0;o<s.length;o++)a[s[o]]="";for(s=STR.check(a.one).split(","),o=0;o<s.length;o++)a[s[o]]=1;a.version===n.version&&OBJ.parseCopy(n,a)}r=AGB.Option.get(a,"D04"),r=NMR.isMinMax(r,1,3)?r:NMR.minMax(AGB.Option.getDefault("D04",0),1,3),OBJ.iterate(AGB.Para,function(e){AGB.Para[e][0]&&(AGB.Option.set(AGB.Option.Data[i],e,AGB.Option.getDefault(e,r)),e in a&&AGB.Option.set(AGB.Option.Data[i],e,a[e]))}),AGB.Option.Upgrade(AGB.Option.Data[i])}},Upgrade:function(e){var t;t=AGB.Data.get("Option","Data","version"),e.version&&e.version<12&&(AGB.Core.Log("Option - Upgrade version 12 ",!0),e.F01=0,e.F13=e.FH0=1,e.F70=2,e.FA0=3,e.F80=e.F90=e.FL0=4,e.F63=""),e.version!==t&&(e.version=t,e.changed=!0,AGB.Data.Change())},Save:function(e){var t,a,n,i,r,s;a=AGB.App.getPlayer(e),t=AGB.Option.Data[a],AGB.Data.isStatus(a)&&t&&(e.backup||t.changed)&&(delete t.changed,r=[],s=[],n={version:AGB.Data.get("Option","Data","version")},i={version:AGB.Data.get("Option","Data","version")},OBJ.iterate(AGB.Para,function(e){AGB.Para[e][1]&&(t[e]?1===t[e]?s.push(e):n[e]=t[e]:r.push(e),3===AGB.Para[e][1]&&(i[e]=t[e]))}),n.empty=r.join(","),n.one=s.join(","),e.save&&(e.save[a+"_Option_Data"]=JSON.stringify(n),e.save[a+"_Option_Local"]=JSON.stringify(i)),e.backup&&AGB.Data.isBackup(a,"Option","Data",2)&&(e.backup.Option_Data=JSON.stringify(n)))},Menu:function(e,t){var a;a=AGB.App.getPlayer(e),AGB.Data.isStatus(a)&&t&&t({Limit:AGB.Option.Limit,Para:AGB.Para,Data:AGB.Option.Data[a]})},MenuSave:function(t,e){var a,n;n=AGB.App.getPlayer(t),a=AGB.Option.Data[n],AGB.Data.isStatus(n)&&a&&(OBJ.is(t.data)&&(OBJ.iterate(AGB.Para,function(e){AGB.Para[e][0]&&e in t.data&&AGB.Option.set(a,e,t.data[e])}),a.status=1),t.data=null,a.changed=!0,AGB.Data.Change(n),AGB.Token.InitInfo(t),AGB.Data.Sync(t),e&&e(a))},Set:function(e,t){var a,n,i;n=AGB.App.getPlayer(e),a=AGB.Option.Data[n],n&&a&&((i=AGB.Option.valid(e.id))&&AGB.Para[i]&&AGB.Para[i][0]?((n=AGB.Option.get(a,i))!==(i={id:i,value:AGB.Option.set(a,i,e.value)}).value&&(a.changed=!0,AGB.Data.Change()),t&&t(i)):i&&(a[i]=e.value))},Get:function(e,t){return(t=AGB.Option.valid(t))&&e&&OBJ.is(AGB.Option.Data[e])?AGB.Option.get(AGB.Option.Data[e],t):""},set:function(e,t,a){var n;if(n=OBJ.get(AGB.Para[t],0),e&&t&&n){if(1===n)e[t]=a&&"0"!==a?1:0;else if(2===n)a=NMR.parseIntFormat(a),t in AGB.Option.Limit&&(a=Math.max(Math.min(a,AGB.Option.Limit[t][1]),AGB.Option.Limit[t][0])),e[t]=a;else if(6===n)e[t]=AGB.Option.valid(a);else if(VAL.check(n,20,21,22,23)){for((a=STR.check(a).split("|"))[0]=AGB.Option.valid(a[0]),a[1]=21<=n&&NMR.minMax(+a[1],0,100)||"",a[2]=22<=n&&NMR.minMax(+a[2],0,19)||"",a[3]=a[2]&&+a[3]||"",a[4]=23<=n?AGB.Option.valid(a[4]):"",a=a[0]?a.join("|"):"";a.length&&"|"===a[a.length-1];)a=a.substring(0,a.length-1);e[t]=AGB.Option.valid(a)}else 25===n?("|"!==(a=(STR.check(a)+"|").split("|",2).join("|").trim())&&"0|"!==a&&"0"!==a||(a=""),e[t]=AGB.Option.valid(a)):-1===n&&(e[t]=AGB.Option.validTask(a));return e[t]}},get:function(e,t){var a;return a=OBJ.get(AGB.Para[t],0),e&&t?1===a?e[t]?1:0:2===a?+e[t]||0:a?"string"==typeof e[t]?e[t]:"number"==typeof e[t]?(e[t]||"")+"":"":e[t]:""},getDefault:function(e,t){var a;return a=OBJ.get(AGB.Para[e],0),e&&a?(t=NMR.minMax(AGB.Para[e].length-3,0,+t||0),AGB.Para[e][2+t]||""):""},valid:function(e){return STR.check(e).replace(/[\"\;]/g,"").trim()},validTask:function(e){return STR.check(e).replace(/\"/g,"").replace(/^\;*/g,"").replace(/\;*$/g,"").trim()}},AGB.Label={Data:{},Messages:function(e,t){"Update"===e&&AGB.Label.Update(t)},Init:function(e,t){var a,n;n=AGB.App.getPlayer(e,"copy"),a=AGB.Label.Data,n&&(a[n]={status:2},OBJ.parseCopy(AGB.Core.resourceFile("loca/EN.json"),a[n]),OBJ.parseCopy(AGB.Core.resourceFile("loca/"+e.abbrCom+".json"),a[n]),a[e.abbrCom]=OBJ.create(a[n]),OBJ.parseCopy(OBJ.get(t,AGB.Data.getKey(n,"Label","Loca")),a[n]),OBJ.parseCopy(OBJ.get(t,AGB.Data.getKey(e.keyCom,"Label","Api")),a[n]))},Load:function(c){var l;AGB.App.getPlayer(c,"copy")&&((l=new XMLHttpRequest).open("GET",c.urlUni+"/api/localization.xml?nocache="+AGB.Time.timestamp(),!0),l.overrideMimeType("text/html"),l.setRequestHeader("Cache-Control","no-cache"),l.setRequestHeader("Pragma","no-cache"),l.onerror=l.onload=function(){var e,t,a,n,i,r,s,o;if(e={},(t=AGB.App.getPlayer(c))&&AGB.Label.Data[t]){if(200==+l.status&&l.responseText)for(a=STR.check(l.responseText).split("<name"),o=0;o<a.length;o++)(n=STR.check(a[o]))&&(e.status=1,s=STR.getAttribute(n,"id"),r=STR.check((n.split(">")[1]||"").split("<")[0]).trim(),+s&&r&&("techs"===i&&(e["L"+STR.trimZero(s,3)]=r),"missions"===i&&(e["LM"+STR.trimZero(s,2)]=r)),-1<n.indexOf("<techs>")&&(i="techs"),-1<n.indexOf("<missions>")&&(i="missions"));1===e.status&&(OBJ.copy(e,AGB.Label.Data[t]),AGB.Item.Init(c),AGB.Data.setStorage(c.keyCom,"Label","Api",e)),AGB.Core.Log("Update   - Label    : "+c.urlUni+"/api/localization.xml"+(e.status=1,""),!0)}},l.send(null))},Update:function(e){var t,a,n,i,r;(a=AGB.App.getPlayer(e))&&OBJ.is(e.data)&&(t={},n=OBJ.is(e.data.localization)?e.data.localization:{},i=OBJ.is(n.timeunits)&&n.timeunits.short?n.timeunits.short:{},t.KU0S=n.thousandSeperator||".",t.KU0C="."===n.thousandSeperator?",":".",t.KU0K=n.unitKilo||"k",t.KU0M=n.unitMega||"m",t.KU0B=n.unitMilliard||"b",t.KD0Y=i.year||"y",t.KD0W=i.week||"w",t.KD0D=i.day||"d",t.KD0H=i.hour||"h",t.KD0M=i.minute||"m",t.KD0S=i.second||"s",n=OBJ.is(e.data.production)?e.data.production:{},r={metal:"091",crystal:"092",deuterium:"093",energy:"094"},OBJ.iterate(r,function(e){OBJ.is(n[e])&&(t["L"+r[e]]=(STR.check(n[e].tooltip).split("|")[0]||"").trim()||e)}),AGB.Core.Log("Update   - Label    : "+t.KU0B+":"+t.KU0M+":"+t.KU0K+" - "+t.KD0Y+":"+t.KD0W+":"+t.KD0D+" - "+t.KD0H+":"+t.KD0M+":"+t.KD0S,!0),AGB.Data.setStorage(a,"Label","Loca",t),OBJ.copy(t,AGB.Label.Data[a]),AGB.Item.Init(e))},Get:function(e,t,a){return(e=AGB.App.getPlayer(e))&&AGB.Label.Data[e]&&t?(a&&(t=1===t.length?"L00"+t:2===t.length?"L0"+t:"L"+t),t in AGB.Label.Data[e]?AGB.Label.Data[e][t]||"":t):""}},AGB.Styles={Data:{},opacity:33,colorType:["","#99CC00","#FFFFFF","#FD8A1C"],classType:["","ago_color_planet","ago_color_debris","ago_color_moon"],colorStatusUnits:"#6A0A0A #640 #640 #640 #004A00 #170 #0D0".split(" "),Messages:function(e,t,a){"Init"===e&&AGB.Styles.Init(t,a)},Init:function(e,t){var a;(a=AGB.App.getPlayer(e))&&t&&1===AGB.Data.Status[a]&&(function(e,r){function t(e,t,a,n,i){i||t&&!AGB.Option.Get(s,t)?(t="",a=0):(t=OBJ.get(AGB.App.Page[e],"css")||"",a=+AGB.Option.Get(s,a)||0),t!==r.Page.file&&(r[e]||(r[e]={}),r[e].file=t),a!==r.Page.improve&&(r[e]||(r[e]={}),r[e].improve=a),r.Events&&n&&(n=+AGB.Option.Get(s,n)||0)!==r.Page.events&&(r[e]||(r[e]={}),r[e].events=n)}var s,a,n,i;s=e.keyPlayer,r.Main="main",AGB.Option.Get(s,"O50")&&(r.Planets=AGB.Option.Get(s,"O51")?"main_planets_improve":"main_planets"),AGB.Option.Get(s,"E30")&&(r.Events=AGB.Option.Get(s,"E31")?"main_events_improve":"main_events"),e.mobile&&(r.Mobile="ogame_mobile"),(a=AGB.Option.Get(s,"U11"))&&(i="  middle dark    color".split(" ")[a],n=AGB.Option.Get(s,"U19"),r.Skin='@import url("'+AGB.Config.pathSkin+'cache/cache.css");'+(i?'@import url("'+AGB.Config.pathSkin+"cache/"+i+'.css");':"")+(7===a&&n?"body { background: "+n+" !important; }":"")),r.Page={file:"pages",improve:0,events:+AGB.Option.Get(s,"E49")||0},t("overview","B01","B01","E41"),t("resources","B00","B00","E47"),t("resourcesettings","","B00","E47"),t("station","B00","B00","E47"),t("research","B00","B00",""),t("shipyard","B00","B00","E48"),t("defense","B00","B00","E48"),t("fleet1","F00","","E42"),t("fleet2","F00","","E43"),t("fleet3","F00","","E44"),t("movement","E10","E11","E45",e.mobile),t("galaxy","G40","G41","E46",e.mobile),t("empire","G20","G21",""),t("messages","","M12","")}(e,a={}),function(e,t){var a,n,i,r,s,o;if(a=e.keyPlayer,n=[],i=[],OBJ.copy(AGB.Styles.colorType,i),AGB.Option.Get(a,"CM0")&&(OBJ.iterate(AGB.Item.Mission,function(e){n.push(".ago_color_"+e+"{color:"+AGB.Option.Get(a,e.replace(/M/,"C"))+"!important;}")}),r=AGB.Option.Get(a,"CM3"),NMR.isMinMax(r,1,99)&&n.push("#eventContent .ago_events_reverse, #eventContent .ago_events_reverse + .ago_eventlist, #inhalt div.fleetDetails[ago_events_reverse] > span{opacity:"+AGB.Styles.getOpacity(r)+"!important;}")),AGB.Option.Get(a,"CT0"))for(r=21;r<80;r++)(s=AGB.Token.getColor(a,r))&&"INHERIT"!==s&&n.push("."+AGB.Token.getClass(a,r)+"{color:"+s+"!important;}");if(AGB.Option.Get(a,"CE0"))for(r=91;r<100;r++)(s=AGB.Token.getColor(a,r))&&"INHERIT"!==s&&n.push("."+AGB.Token.getClass(a,r)+"{color:"+s+"!important;}");if(AGB.Option.Get(a,"CS0")){for((s=AGB.Token.getColor(a,"S5"))&&n.push(".ago_selected_S5{box-shadow: 0 0 3px 2px "+s+", 0 0 1px 1px "+s+" inset;}"),o=1;o<=3;o++)r="S"+o,(s=AGB.Token.getColor(a,r))&&(i[o]=s,n.push(".ago_selection_"+r+"{color:"+s+"!important;}"),n.push(".ago_selected_"+r+"{box-shadow: 0 0 0 1px "+s+" inset;}"),n.push(".ago_selected_"+r+"_own{box-shadow: 0 0 0 1px "+s+" inset;color:"+s+"!important;}"),n.push(".ago_hover_"+r+":hover{box-shadow: 0 0 1px 0 "+s+" inset;}"),n.push(".ago_hover_"+r+"_own:hover{color:"+s+"!important;box-shadow: 0 0 1px 0 "+s+" inset;}"),AGB.Token.getCondition(a,r)&&(n.push(".ago_highlight_"+r+"{background-color:"+AGB.Token.getColorOpacity(a,r)+";}"),n.push(".ago_highlight_"+r+"_active{background-color:"+AGB.Token.getColorOpacity(a,r,"active")+";}")));AGB.Option.Get(a,"O55")&&((s=AGB.Token.getColor(a,"S1"))&&(n.push("#rechts .ago_highlight .planet-name, #rechts .ago_highlight .planet-koords{color:"+s+"!important;}"),n.push("#rechts .smallplanet:hover .planet-name, #rechts .smallplanet:hover .planet-koords{color:"+s+"!important;}")),(s=AGB.Token.getColor(a,"S3"))&&(n.push("#rechts .ago_highlight_S3 .planet-name, #rechts .ago_highlight_S3 .planet-koords{color:"+s+"!important;}"),n.push("#rechts .ago_highlight_S3_active .planet-name, #rechts .ago_highlight_S3_active .planet-koords{color:"+s+"!important;}"),n.push("#rechts .ago_hover_S3:hover .planet-name, #rechts .ago_hover_S3:hover .planet-koords{color:"+s+"!important;}"))),(s=AGB.Token.getColor(a,"SA"))&&n.push(".ago_selected_SA{box-shadow:0 0 1px 1px "+s+" inset;}")}for(o=1;o<=3;o++)n.push("."+AGB.Styles.classType[o]+"{color:"+i[o]+"!important;}");t.colorType=i,t.Color=n.join("")}(e,a),t(a))},getOpacity:function(e){return"0."+(e<10?"0"+e:e)},getImport:function(e){return e?'@import url("'+AGB.Config.pathSkin+"ago/"+e+'.css");':""},getColor:function(e,t){return!e||4!==e.length&&7!==e.length?"":0<t&&t<100?"rgba("+(e=7===e.length?parseInt(e.substring(1,3),16)+","+parseInt(e.substring(3,5),16)+","+parseInt(e.substring(5,7),16):parseInt(e.substring(1,2),16)+","+parseInt(e.substring(2,3),16)+","+parseInt(e.substring(3,4),16))+(t<10?",0.0":",0.")+t+")":e}},AGB.Item={Data:{},Info:{timeResource:{index:0},metal:{index:1},crystal:{index:2},deuterium:{index:3},energy:{index:4},timeMining:{index:31},timeStation:{index:32},1:{index:33,metal:60,crystal:15,deuterium:0,factor:1.5},2:{index:34,metal:48,crystal:24,deuterium:0,factor:1.6},3:{index:35,metal:225,crystal:75,deuterium:0,factor:1.5},4:{index:36,metal:75,crystal:30,deuterium:0,factor:1.5},12:{index:37,metal:900,crystal:360,deuterium:180,factor:1.8},14:{index:38,metal:400,crystal:120,deuterium:200,factor:2},15:{index:39,metal:1e6,crystal:5e5,deuterium:1e5,factor:2},21:{index:41,metal:400,crystal:200,deuterium:100,factor:2},22:{index:42,metal:1e3,crystal:0,deuterium:0,factor:2},23:{index:43,metal:1e3,crystal:500,deuterium:0,factor:2},24:{index:44,metal:1e3,crystal:1e3,deuterium:0,factor:2},25:{index:45,metal:2645,crystal:0,deuterium:0,factor:2.3},26:{index:46,metal:2645,crystal:1322,deuterium:0,factor:2.3},27:{index:47,metal:2645,crystal:2645,deuterium:0,factor:2.3},31:{index:48,metal:200,crystal:400,deuterium:200,factor:2},33:{index:49,metal:0,crystal:5e4,deuterium:1e5,factor:2},34:{index:50,metal:2e4,crystal:4e4,deuterium:0,factor:2},41:{index:51,metal:2e4,crystal:4e4,deuterium:2e4,factor:2},42:{index:52,metal:2e4,crystal:4e4,deuterium:2e4,factor:2},43:{index:53,metal:2e6,crystal:4e6,deuterium:2e6,factor:2},44:{index:54,metal:2e4,crystal:2e4,deuterium:1e3,factor:2},timeResearch:{index:31},106:{index:32,metal:200,crystal:1e3,deuterium:200,factor:2},108:{index:33,metal:0,crystal:400,deuterium:600,factor:2},109:{index:34,metal:800,crystal:200,deuterium:0,factor:2},110:{index:35,metal:200,crystal:600,deuterium:0,factor:2},111:{index:36,metal:1e3,crystal:0,deuterium:0,factor:2},113:{index:37,metal:0,crystal:800,deuterium:400,factor:2},114:{index:38,metal:0,crystal:4e3,deuterium:2e3,factor:2},115:{index:39,metal:400,crystal:0,deuterium:600,factor:2},117:{index:40,metal:2e3,crystal:4e3,deuterium:600,factor:2},118:{index:41,metal:1e4,crystal:2e4,deuterium:6e3,factor:2},120:{index:42,metal:200,crystal:100,deuterium:0,factor:2},121:{index:43,metal:1e3,crystal:300,deuterium:100,factor:2},122:{index:44,metal:2e3,crystal:4e3,deuterium:1e3,factor:2},123:{index:45,metal:24e4,crystal:4e5,deuterium:16e4,factor:2},124:{index:46,metal:4e3,crystal:8e3,deuterium:4e3,factor:1.75},199:{index:47,metal:0,crystal:0,deuterium:0,factor:3},timeShip:{index:5},202:{index:6,metal:2e3,crystal:2e3,deuterium:0,retreat:1e3,drive:"115",speed:5e3,capacity:5e3,consumption:20},203:{index:7,metal:6e3,crystal:6e3,deuterium:0,retreat:3e3,drive:"115",speed:7500,capacity:25e3,consumption:50},204:{index:8,metal:3e3,crystal:1e3,deuterium:0,retreat:4e3,drive:"115",speed:12500,capacity:50,consumption:20},205:{index:9,metal:6e3,crystal:4e3,deuterium:0,retreat:1e4,drive:"117",speed:1e4,capacity:100,consumption:75},206:{index:10,metal:2e4,crystal:7e3,deuterium:2e3,retreat:29e3,drive:"117",speed:15e3,capacity:800,consumption:300},207:{index:11,metal:45e3,crystal:15e3,deuterium:0,retreat:6e4,drive:"118",speed:1e4,capacity:1500,consumption:500},208:{index:12,metal:1e4,crystal:2e4,deuterium:1e4,retreat:1e4,drive:"117",speed:2500,capacity:7500,consumption:1e3},209:{index:13,metal:1e4,crystal:6e3,deuterium:2e3,retreat:4500,drive:"115",speed:2e3,capacity:2e4,consumption:300},210:{index:14,metal:0,crystal:1e3,deuterium:0,retreat:0,drive:"115",speed:1e8,capacity:0,consumption:1},211:{index:15,metal:5e4,crystal:25e3,deuterium:15e3,retreat:9e4,drive:"117",speed:4e3,capacity:500,consumption:1e3},212:{index:16,metal:0,crystal:2e3,deuterium:500,retreat:0,drive:0,speed:0,capacity:0,consumption:0},213:{index:17,metal:6e4,crystal:5e4,deuterium:15e3,retreat:125e3,drive:"118",speed:5e3,capacity:2e3,consumption:1e3},214:{index:18,metal:5e6,crystal:4e6,deuterium:1e6,retreat:1e7,drive:"118",speed:100,capacity:1e6,consumption:1},215:{index:19,metal:3e4,crystal:4e4,deuterium:15e3,retreat:85e3,drive:"118",speed:1e4,capacity:750,consumption:250},timeDefense:{index:20},401:{index:21,metal:2e3,crystal:0,deuterium:0,retreat:2e3},402:{index:22,metal:1500,crystal:500,deuterium:0,retreat:2e3},403:{index:23,metal:6e3,crystal:2e3,deuterium:0,retreat:8e3},404:{index:24,metal:2e4,crystal:15e3,deuterium:2e3,retreat:37e3},405:{index:25,metal:2e3,crystal:6e3,deuterium:0,retreat:8e3},406:{index:26,metal:5e4,crystal:5e4,deuterium:3e4,retreat:13e4},407:{index:27,metal:1e4,crystal:1e4,deuterium:0,retreat:2e4},408:{index:28,metal:5e4,crystal:5e4,deuterium:0,retreat:1e5},502:{index:29,metal:8e3,crystal:0,deuterium:2e3,retreat:0},503:{index:30,metal:12500,crystal:2500,deuterium:1e4,retreat:0}},Mining:{1:1,2:1,3:1,4:1,12:1,22:1,23:1,24:1,25:1,26:1,27:1,212:1},Station:{14:1,15:1,21:1,31:1,33:1,34:1,41:1,42:1,43:1,44:1},Ship:{202:1,203:1,204:2,205:2,206:2,207:2,208:1,209:1,210:1,211:2,212:3,213:2,214:2,215:2},ShipCivil:{202:1,203:1,208:1,209:1,210:1},ShipCombat:{204:2,205:2,206:2,207:2,215:2,211:2,213:2,214:2},ShipTransport:{203:1,202:1,209:1,214:1},Defense:{401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,502:2,503:2},Resource:{metal:"091",crystal:"092",deuterium:"093"},ResourceEnergy:{metal:"091",crystal:"092",deuterium:"093",energy:"094"},Coordinates:{galaxy:1,system:1,position:1},Research:{106:8,108:10,109:3,110:6,111:2,113:12,114:-8,115:6,117:6,118:8,120:-12,121:5,122:7,123:0,124:8,199:-1},ByName:{},Mission:{M15:0,M07:0,M08:0,M03:0,M04:0,M06:0,M05:0,M01:0,M02:0,M09:0},Init:function(t){var a,e;(e=AGB.App.getPlayer(t))&&1==+OBJ.get(AGB.Label.Data[e],"status")&&(AGB.Item.Data[e]={},a=AGB.Item.Data[e],OBJ.iterate(AGB.Item.Ship,function(e){a[AGB.Label.Get(t,e,1)||e]=e}),OBJ.iterate(AGB.Item.Defense,function(e){a[AGB.Label.Get(t,e,1)||e]=e}),OBJ.iterate(AGB.Item.Research,function(e){a[AGB.Label.Get(t,e,1)||e]=e}),OBJ.iterate(AGB.Item.ResourceEnergy,function(e){a[AGB.Label.Get(t,AGB.Item.ResourceEnergy[e],1)||e]=e}))},valid:function(e){return e in AGB.Item.Info?e:""}},AGB.Units={Data:{},Messages:function(e,t,a){"Action"===e?AGB.Units.Action(t,a):"Update"===e?AGB.Units.Update(t,a):"List"===e&&AGB.Units.List(t,a)},Start:function(e){var t,a;return a={},(t=AGB.Units.Data[e])&&t.account&&(a.status=t.status,a.timeResearch=AGB.Time.timestampMinuteConvert(t.account.timeResearch),OBJ.iterate(AGB.Item.Research,function(e){a[e]=+t.account[e]||0})),a},Init:function(e,t){var n,i,a,r,s;r=AGB.Data.get("Units","Data","version"),(a=AGB.App.getPlayer(e))&&(AGB.Units.Data[a]={status:2,version:r},(n=AGB.Units.Data[a]).account={},(i=OBJ.parse(t[AGB.Data.getKey(a,"Units","Data")])).version===r&&(n.status=i.status||2,i.account&&(s=STR.check(i.account).split(","),AGB.Item.Info.timeResearch&&(n.account.timeResearch=+s[AGB.Item.Info.timeResearch.index]||0),OBJ.iterate(AGB.Item.Research,function(e){AGB.Item.Info[e]&&(n.account[e]=+s[AGB.Item.Info[e].index]||0)})),OBJ.iterate(i,function(t){var a;0<+t&&(n[t]={},a=STR.check(i[t]).split(","),OBJ.iterate(AGB.Item.Info,function(e){100<+e&&+e<200||"timeResearch"===e||(n[t][e]=+a[AGB.Item.Info[e].index]||0)}))})),AGB.Units.SummarizePlanets(e))},Save:function(e){var t,a,n,i;n=AGB.App.getPlayer(e),t=AGB.Units.Data[n],AGB.Data.isStatus(n)&&t&&(e.backup||t.changed)&&(i={version:t.version,status:t.status},delete t.changed,t.account&&(a=[],AGB.Item.Info.timeResearch&&(a[AGB.Item.Info.timeResearch.index]=+t.account.timeResearch||""),OBJ.iterate(AGB.Item.Research,function(e){AGB.Item.Info[e]&&(a[AGB.Item.Info[e].index]=+t.account[e]||"")}),i.account=a.join(",")),AGB.Units.iterate(n,function(t,e){var a,n;for(a=[],OBJ.iterate(AGB.Item.Info,function(e){100<+e&&+e<200||"timeResearch"===e||(a[AGB.Item.Info[e].index]=+t[e]||"")}),n=a.length;0<n&&!a[n-1];)n--;a.length=n,i[e]=a.join(",")}),e.save&&(e.save[n+"_Units_Data"]=JSON.stringify(i)),e.backup&&AGB.Data.isBackup(n,"Units","Data",2)&&(e.backup.Units_Data=JSON.stringify(i)))},Update:function(e,t){var a,n,i;n=AGB.App.getPlayer(e),a=AGB.Units.Data[n],n&&a&&OBJ.is(e.data)&&(i=[{planet:e.planet,tabs:["Resource"],data:e.data}],(a={research:"Research",resources:"Mining",station:"Station",shipyard:"Ship",defense:"Defense",fleet1:"Ship"}[e.data.page])&&i.push({planet:"Research"===a?"account":e.planet,tabs:[a],data:e.data}),AGB.Units.Action({keyPlayer:n,list:i},t))},Action:function(e,t){var s,a,n,i,r;a=AGB.App.getPlayer(e),s=AGB.Units.Data[a],a&&s&&Array.isArray(e.list)&&(OBJ.iterateArray(e.list,function(e){e&&function(e,t,a,n){var i,r;if(("account"===e||0<+e)&&Array.isArray(t)&&OBJ.is(n))for(OBJ.is(s[e])||(s[e]={}),i=s[e],r=0;r<t.length;r++)"Resource"===(e=t[r])?(OBJ.iterate(AGB.Item.ResourceEnergy,function(e){i[e]=+n[e]||0}),i.resources=i.metal+i.crystal+i.deuterium,i.timeResource=AGB.Time.timestampMinute()):"Ship"===e?(i.shipsCivil=0,i.shipsCombat=0,OBJ.iterate(AGB.Item.Ship,function(e){var t=+n[e]||0;i[e]="add"===a?(+i[e]||0)+t:"remove"===a?Math.max((+i[e]||0)-t,0):t,e in AGB.Item.ShipCivil&&(i.shipsCivil+=i[e]),e in AGB.Item.ShipCombat&&(i.shipsCombat+=i[e])}),i.ships=i.shipsCivil+i.shipsCombat,i.timeShip=AGB.Time.timestampMinute()):"Research"===e?(OBJ.iterate(AGB.Item.Research,function(e){i[e]=+n[e]||0}),i.timeResearch=AGB.Time.timestampMinute(),s.status=1):AGB.Item[e]&&(OBJ.iterate(AGB.Item[e],function(e){i[e]=+n[e]||0}),i["time"+e]=1)}(e.planet,e.tabs,e.action,e.data)}),e.planets&&(n=e.planets,r=0,i={account:1,status:1,version:1,changed:1},OBJ.iterate(n,function(e){var t;r++,t=n[e],i[t]=e,OBJ.is(s[t])||(s[t]={})}),r&&OBJ.iterate(s,function(e){e in i||(s[e]="")}),AGB.Units.SummarizePlanets(e)),s.changed=!0,AGB.Data.Change()),t&&t()},List:function(e,t){var a,n,i;n=AGB.App.getPlayer(e),a=AGB.Units.Data[n],n&&a&&(i={},"summarized"===e.action&&OBJ.iterate(a,function(e){var t;0<+e&&(t=a[e],i[e]={ships:t.ships,shipsCivil:t.shipsCivil,shipsCombat:t.shipsCombat,timeShip:t.timeShip})})),t&&t(i)},Get:function(e,t,a,n){var i;return e&&AGB.Units.Data[e]&&t&&AGB.Units.Data[e][t]&&a&&(i=AGB.Units.Data[e][t][a]),6===n?STR.check(i):+i||0},XXsummarizeAccount:function(e){var a,n;e=AGB.App.getPlayer(e),a=AGB.Units.Data[e],e&&a&&(a.account||(a.account={}),(n=a.account).resources=0,OBJ.iterate(AGB.Item.Resource,function(e){n[e]=0}),n.ships=0,n.shipsCivil=0,n.shipsCombat=0,OBJ.iterate(AGB.Item.Ship,function(e){n[e]=0}),OBJ.iterate(a,function(e){var t;0<+e&&(t=a[e],OBJ.iterate(AGB.Item.Resource,function(e){n[e]+=+t[e]||0}),n.resources+=+n.resources||0,OBJ.iterate(AGB.Item.Ship,function(e){n[e]+=+t[e]||0}),n.ships+=+t.ships||0,n.shipsCivil+=+t.shipsCivil||0,n.shipsCombat+=+t.shipsCombat||0)}))},SummarizePlanets:function(e){var t;t=AGB.App.getPlayer(e),e=AGB.Units.Data[t],t&&e&&AGB.Units.iterate(t,function(t){t.resources=0,OBJ.iterate(AGB.Item.Resource,function(e){t.resources+=+t[e]||0}),t.shipsCivil=0,t.shipsCombat=0,OBJ.iterate(AGB.Item.ShipCivil,function(e){t.shipsCivil+=+t[e]||0}),OBJ.iterate(AGB.Item.ShipCombat,function(e){t.shipsCombat+=+t[e]||0}),t.ships=t.shipsCivil+t.shipsCombat})},SummarizePosition:function(n){function e(e){o[e]=r?(+i[e]||0)+(+r[e]||0):+i[e]||0}function t(e){var t,a;t=+OBJ.get(i,e)||0,a=+OBJ.get(r,e)||0,o[e]=n.moon?t&&a?t:t||a?-1:0:t}var a,i,r,s,o;return s=AGB.App.getPlayer(n),a=AGB.Units.Data[s],o={},s&&a&&(i=a[n.planet]||{},r=a[n.moon],OBJ.iterate(AGB.Item.Resource,e),OBJ.iterate(AGB.Item.Ship,e),OBJ.iterate({resources:0,ships:0,shipsCivil:0,shipsCombat:0},e),t("timeResource"),t("timeShip")),o},SummarizeAccount:function(e){var t,a;return t=AGB.App.getPlayer(e),e=AGB.Units.Data[t],t&&e&&(a={resources:0,ships:0,shipsCivil:0,shipsCombat:0,timeResource:0,timeShip:0},OBJ.iterate(AGB.Item.Resource,function(e){a[e]=0}),OBJ.iterate(AGB.Item.Ship,function(e){a[e]=0}),AGB.Units.iterate(t,function(t){t.timeResource&&(a.timeResource=1),t.timeShip&&(a.timeShip=1),OBJ.iterate(AGB.Item.Resource,function(e){a[e]+=+t[e]||0}),a.resources+=+t.resources||0,OBJ.iterate(AGB.Item.Ship,function(e){a[e]+=+t[e]||0}),a.ships+=+t.ships||0,a.shipsCivil+=+t.shipsCivil||0,a.shipsCombat+=+t.shipsCombat||0})),a},create:function(e,t,a){var n;return n=AGB.Units.Data[e],e&&n&&t?OBJ.createFilter(AGB.Units.Data[e][t],a):{}},iterate:function(e,t){var a,n;if(a=AGB.Units.Data[e],e&&a)for(n in a)a.hasOwnProperty(n)&&0<+n&&t(a[n],n)}},AGB.Task={splitActive:function(e,t,a){var n,i;if((e=OBJ.split(e)).standard&&e[a]){for(i in n=AGO.Task.split(e.standard,t,-1),t=AGO.Task.split(e[a],t,-1))t[i]&&(n[i]="string"==typeof t[i]?t[i]:Math.max(t[i],0));return n.ships=0,OBJ.iterate(AGB.Item.Ship,function(e){n.ships+=+n[e]||0}),n}return AGB.Task.split(e[a]||e.standard,t)},split:function(e,t){var a,n,i,r;if((a={galaxy:+(n=STR.check(e).split(":"))[0]||0,system:+n[1]||0,position:+n[2]||0,type:+n[3]||0,mission:+n[4]||0,speed:+n[5]||0,holdingtime:+n[6]||0}).expeditiontime=+n[7]||0,a.union=+n[8]||0,a.routine=+n[9]||0,a.name=n[10]||"",a.detail=n[11]||"",a.detail2=+n[12]||0,a.preferCargo=n[13]||"",a.preferShip=n[14]||"",a.arrival=+n[15]||0,1<=t&&(a.metal=+n[16]||0,a.crystal=+n[17]||0,a.deuterium=+n[18]||0,a.preferResource=+n[19]||0,a.timeResource=+n[20]||0,a.resources=a.metal+a.crystal+a.deuterium),2<=t)for(a.timeShip=+n[21]||0,a.ships=0,r=22;r<=35;r++)i=+n[r]||0,(a[String(r+180)]=i)&&(a.ships+=i);return a},join:function(e,t){var a,n;if(OBJ.is(e)){if((a=[e.galaxy||"",e.system||"",e.position||"",e.type||"",e.mission||"",e.speed||"",e.holdingtime||""])[7]=e.expeditiontime||"",a[8]=e.union||"",a[9]=e.routine||"",a[10]=e.name||"",a[11]=e.detail||"",a[12]=e.detail2||"",a[13]=e.preferCargo||"",a[14]=e.preferShip||"",a[15]=e.arrival||"",1<=t&&(a[16]=e.metal||"",a[17]=e.crystal||"",a[18]=e.deuterium||"",a[19]=e.preferResource||"",a[20]=e.timeResource||""),2<=t)for(a[21]=e.timeShip||"",n=22;n<=35;n++)e[String(n+180)]&&(a[n]=e[String(n+180)]||"");for(n=a.length;0<n&&!a[n-1];)n--;return a.length=n,a.join(":")}return""},splitCoords:function(e){return{galaxy:+(e=STR.check(e).split(":"))[0]||0,system:+e[1]||0,position:+e[2]||0}},checkCoords:function(e,t,a){return 1<=e&&e<=AGB.Uni.Info.galaxies&&1<=t&&t<=AGB.Uni.Info.systems&&1<=a&&a<=AGB.Uni.Info.positions},checkCoordsType:function(e,t,a,n){return 1<=e&&e<=AGB.Uni.Info.galaxies&&1<=t&&t<=AGB.Uni.Info.systems&&1<=a&&a<=AGB.Uni.Info.positions&&1<=n&&n<=3},getCoordsType:function(e){return OBJ.is(e)&&AGB.Task.checkCoordsType(e.galaxy,e.system,e.position,e.type)?e.galaxy+":"+e.system+":"+e.position+":"+e.type:""},updateCoordsType:function(e,t){var a;t=STR.check(t),OBJ.is(e)&&t&&(a=t.split(":"),NMR.isMinMax(+a[3],1,3)&&(e.type=+a[3]||0),AGB.Task.checkCoords(+a[0],+a[1],+a[2])&&(e.galaxy=+a[0]||0,e.system=+a[1]||0,e.position=+a[2]||0,e.coords=e.galaxy+":"+e.system+":"+e.position,e.coordstype=e.type?e.coords+":"+e.type:""))},cut:function(e,t){return"string"==typeof e?e.split(":",t).join(":"):""},cutSystem:function(e){return"string"==typeof e?e.split(":",2).join(":"):""},cutCoords:function(e){return"string"==typeof e?e.split(":",3).join(":"):""},cutCoordsType:function(e){return"string"==typeof e?e.split(":",4).join(":"):""}},AGB.Construction={Data:{},Messages:function(e,t,a){"List"===e?AGB.Construction.List(t,a):"Action"===e&&AGB.Construction.Action(t,a)},Init:function(e,t){var a,n;(a=AGB.App.getPlayer(e))&&(n=OBJ.parse(t[AGB.Data.getKey(a,"Construction","Data")]),AGB.Construction.Data[a]={version:n.version},OBJ.iterate(n,function(t){Array.isArray(n[t])&&(AGB.Construction.Data[a][t]=[],n[t].forEach(function(e){AGB.Construction.Data[a][t].push(AGB.Construction.split(e))}))}),AGB.Construction.Upgrade(AGB.Construction.Data[a]))},Upgrade:function(e){var t;t=AGB.Data.get("Construction","Data","version"),e.version!==t&&(e.changed=!0,e.version=t,AGB.Data.Change())},Save:function(e){var a,n,t;t=AGB.App.getPlayer(e),a=AGB.Construction.Data[t],AGB.Data.isStatus(t)&&a&&(e.backup||a.changed)&&(delete a.changed,n={version:AGB.Data.get("Construction","Data","version")},OBJ.iterate(a,function(t){Array.isArray(a[t])&&a[t].length&&(n[t]=[],a[t].forEach(function(e){n[t].push(AGB.Construction.join(e))}))}),e.save&&(e.save[t+"_Construction_Data"]=JSON.stringify(n)),e.backup&&AGB.Data.isBackup(t,"Construction","Data",2)&&(e.backup.Construction_Data=JSON.stringify(n)))},Action:function(e,t){var a,n,i,r,s,o,c;n=AGB.App.getPlayer(e),a=AGB.Construction.Data[n],n&&a&&e.value&&("set"===(i=e.action)?OBJ.get(e.value,"id")&&((r=OBJ.create(e.value)).time=0,s=AGB.Task.getCoordsType(r))&&(AGB.Construction.update(n,r),OBJ.is(a[s])?a[s].unshift(r):a[s]=[r],a.changed=!0,AGB.Data.Change(),t({tab:"Construction",data:s+":0"})):"remove"===i?(s=AGB.Construction.getKey(e.value),o=AGB.Construction.getIndex(e.value),OBJ.is(a[s])&&a[s][o]&&(a[s].splice(o,1),a.changed=!0,AGB.Data.Change(),t({tab:"Construction",data:s+":"+o}))):"reserve"===i?(s=AGB.Construction.getKey(e.value),o=AGB.Construction.getIndex(e.value),OBJ.is(a[s])&&a[s][o]&&(r=OBJ.create(a[s][o]),OBJ.get(r,"id")&&s!==e.coords&&r.reserved&&(AGB.Task.updateCoordsType(r,e.coords),r.coordstype===e.coords&&(a[s].splice(o,1),s=r.coordstype,OBJ.is(a[s])?a[s].push(r):a[s]=[r],o=a[s].length-1,a.changed=!0,AGB.Data.Change(),t({tab:"Construction",data:s+":"+o}))))):VAL.check(i,"increase","decrease","increaseRange","decreaseRange")&&(s=AGB.Construction.getKey(e.value),o=AGB.Construction.getIndex(e.value),OBJ.is(a[s])&&a[s][o]&&(r=OBJ.create(a[s][o]),OBJ.get(r,"id")))&&(+r.id<200?((c={increase:1,decrease:-1}[i]||0)&&(r.increase+=c),(c={increaseRange:1,decreaseRange:-1}[i]||0)&&r.increase&&(r.range+=c)):(c={increase:1,decrease:-1,increaseRange:10,decreaseRange:-10}[i]||0)&&(r.level+=c),AGB.Construction.update(n,r),a[s][o]=r,a.changed=!0,AGB.Data.Change(),t({tab:"Construction",data:s+":"+o})))},update:function(e,a){var n,i,r,s,o,c,l;OBJ.is(a)&&AGB.Item.valid(a.id)&&(n=a.id,OBJ.copy({metal:0,crystal:0,deuterium:0,resources:0,duration:0},a),n in AGB.Item.Ship||n in AGB.Item.Defense?(a.level=Math.max(a.level,1),a.duration=a.time*a.level,a.range=0,a.increase=0,OBJ.iterate(AGB.Item.Resource,function(e){var t;t=OBJ.get(AGB.Item.Info[n],e),a[e]=t?t*a.level:0}),a.resources=a.metal+a.crystal+a.deuterium):(n in AGB.Item.Mining||n in AGB.Item.Station||n in AGB.Item.Research)&&(i=OBJ.get(AGB.Item.Info[n],"factor"),a.increase=n in AGB.Item.Research?Math.max(a.increase||0,0):Math.max(a.increase||0,-1*a.level),a.range=a.reserved?0:a.increase<0?Math.max(Math.min(a.level+a.increase,a.range||0),0):Math.max(a.range||0,0),a.increase<0?(s=Math.max(a.level+a.increase,0),r=Math.max(s-a.range,0),o=4*AGB.Units.Get(e,"account","121")):(0<a.increase?(r=a.level+a.increase,s=r+a.range):r=s=a.level,o=0),a.start=r,a.stop=s,c={metal:0,crystal:0},OBJ.iterate(AGB.Item.Resource,function(e){var t;if(t=OBJ.get(AGB.Item.Info[n],e)){for(l=r;l<=s;l++)a[e]+=Math.floor(t*Math.pow(i,l-1));c[e]=a[e],o&&(a[e]=Math.floor(a[e]-a[e]/100*o))}}),a.duration=Math.floor((c.metal+c.crystal)*a.time),a.resources=a.metal+a.crystal+a.deuterium))},List:function(e,t){var a,n,i;n=AGB.App.getPlayer(e),a=AGB.Construction.Data[n],n&&a&&((i={tab:"Construction",list:a}).Active=AGB.Units.SummarizePosition({keyPlayer:n,planet:e.active}),i.Units=e.planet&&"account"!==e.planet?AGB.Units.SummarizePosition(e):AGB.Units.SummarizeAccount(e)),AGB.Panel.Cache(e,i),t&&t(i)},split:function(e){return(e={galaxy:+(e=STR.check(e).split(":"))[0]||0,system:+e[1]||0,position:+e[2]||0,type:+e[3]||0,mission:+e[4]||0,speed:+e[5]||0,holdingtime:+e[6]||0,disabled:+e[7]||0,time:+e[8]||0,id:e[10]||"",level:+e[11]||0,increase:+e[12]||0,range:+e[13]||0,reserved:+e[14]||0,arrival:+e[15]||0,metal:+e[16]||0,crystal:+e[17]||0,deuterium:+e[18]||0,preferResource:+e[19]||0,timeResource:+e[20]||0}).resources=e.metal+e.crystal+e.deuterium,e},join:function(e){var t;if(OBJ.is(e)){for(t=(e=[e.galaxy||"",e.system||"",e.position||"",e.type||"",e.mission||"",e.speed||"",e.holdingtime||"",e.disabled||"",e.time||"","",e.id||"",e.level||"",e.increase||"",e.range||"",e.reserved||"",e.arrival||"",e.metal||"",e.crystal||"",e.deuterium||"",e.preferResource||"",e.timeResource||""]).length;0<t&&!e[t-1];)t--;return e.length=t,e.join(":")}return""},getKey:function(e){return STR.check(e).split(":",4).join(":")},getIndex:function(e){return+STR.check(e).split(":")[4]||0}},AGB.Token={Data:{},Sort:{},Info:{21:{cls:"active"},22:{cls:"inactive"},23:{cls:"longinactive"},24:{cls:"noob"},25:{cls:"strong"},26:{cls:"honorableTarget"},27:{cls:"outlaw"},28:{cls:"banned"},29:{cls:"vacation"},30:{cls:"admin"},41:{cls:"ally_own"},42:{},43:{},44:{},45:{},46:{},47:{},48:{},49:{},51:{cls:"buddy"},52:{},53:{},54:{},55:{},56:{},57:{},58:{},59:{},61:{},62:{},63:{},64:{},65:{},66:{},67:{},68:{},69:{},71:{},72:{},73:{},74:{},75:{},76:{},77:{},78:{},79:{},81:{},91:{},92:{},94:{},95:{},96:{},97:{},98:{},99:{},S1:{},S2:{},S3:{},S4:{},S5:{},S6:{},S7:{},S8:{},S9:{},SA:{},SB:{},SC:{}},Messages:function(e,t,a){"Get"===e?AGB.Token.Get(t,a):"Action"===e?AGB.Token.Action(t,a):"List"===e&&AGB.Token.List(t,a)},Init:function(e,a){var n;(n=AGB.App.getPlayer(e))&&(AGB.Token.Data[n]={},AGB.Token.Sort[n]={},AGB.Data.iterate("Token",function(e,t){2<=e.tab?(AGB.Token.Data[n][t]=OBJ.parse(a[AGB.Data.getKey(n,"Token",t)]),AGB.Token.Upgrade(n,t)):e.tab&&(AGB.Token.Data[n][t]={})}),AGB.Token.InitInfo(e))},InitInfo:function(e){var a,n;(n=AGB.App.getPlayer(e))&&AGB.Token.Data[n]&&(AGB.Token.Data[n].Info={},a=AGB.Token.Data[n].Info,OBJ.iterate(AGB.Token.Info,function(e){var t;a[e]={},AGB.Token.Info[e].cls&&(a[e].cls=AGB.Token.Info[e].cls),(t=AGB.Option.Get(n,"C"+e))&&"string"==typeof t&&((t=t.split("|"))[0]&&(a[e].color=t[0],t[1]&&(a[e].opacity=+t[1]),t[2]&&(a[e].condition=+t[2]),t[3]&&(a[e].limit=+t[3]),t[4]&&(a[e].name=t[4])))}))},Upgrade:function(e,t){var a,n;n=AGB.Data.get("Token",t,"version"),a=AGB.Token.Data[e],OBJ.is(a[t])||(a[t]={}),a[t].version!==n&&(a[t].changed=!0,a[t].version=n,AGB.Data.Change())},Save:function(t){var a,n;n=AGB.App.getPlayer(t),a=AGB.Token.Data[n],OBJ.iterate(a,function(e){AGB.Data.isStorage(n,"Token",e)&&(t.backup||a[e].changed)&&(delete a[e].changed,t.save&&(t.save[AGB.Data.getKey(n,"Token",e)]=JSON.stringify(a[e])),t.backup&&AGB.Data.isBackup(n,"Token",e,2)&&(t.backup["Token_"+e]=JSON.stringify(a[e])))})},Action:function(e,t){var a,n,i,r,s,o,c,l;n=AGB.App.getPlayer(e),i=AGB.Token.getTab(e),a=AGB.Token.Data[n],r=-1===(r=+e.token||0)?r:"Alliance"!==i||!NMR.isMinMax(r,41,49)&&81!==r?"Player"===i&&NMR.isMinMax(r,51,89)?r:"Target"===i&&NMR.isMinMax(r,61,89)?r:0:r,n&&i&&a&&r&&(s=STR.check(e.id),"Target"===i&&(1e8<e.time?s=AGB.Task.cutCoordsType(e.coords)||e.time:(e.time=0,s=s||AGB.Task.cutCoords(e.coords))),l={tab:i,action:e.action,id:s,token:r},"set"===e.action&&(o=r+"|"+STR.check(e.name),"Alliance"===i&&e.tag&&(o+="|"+e.tag),"Target"===i&&(o+="|"+STR.check(e.coords),e.time&&(o+="|"+e.time))),r<80?"set"===e.action?(l.changed=!0,a[i].changed=!0,a[i][s]=o):"remove"===e.action&&s in a[i]&&(l.changed=!0,a[i].changed=!0,delete a[i][s]):81===r&&OBJ.is(a.Current)&&(s=i[0]+s,"set"===e.action?(l.changed=!0,a.Current.changed=!0,a.Current[s]=o,c=0,OBJ.iterate(a.Current,function(e){e[0]===i[0]&&c++}),c=Math.max(0,c-AGB.Option.Get(n,"I05")),OBJ.iterate(a.Current,function(e){0<c&&e[0]===i[0]&&(c--,delete a.Current[e])})):"remove"===e.action&&s in a.Current&&(l.changed=!0,a.Current.changed=!0,delete a.Current[s])),l.changed&&(OBJ.is(AGB.Token.Sort[n])&&(AGB.Token.Sort[n][i]=null),e.refresh&&(l.Data=a),AGB.Data.Change())),t&&t(l)},List:function(t,e){var a,n,i,r,s;i=AGB.App.getPlayer(t),r=AGB.Token.getTab(t),a=AGB.Token.Data[i],r&&OBJ.is(a)&&(AGB.Token.Sort[i]||(AGB.Token.Sort[i]={}),(n=AGB.Token.Sort[i])[r]||(n[r]={},OBJ.iterate(a[r],function(e){var t;"version"!==e&&"changed"!==e&&(41<=(t=STR.check(a[r][e]).split("|")[0])&&t<=79&&(n[r][t]?n[r][t].push(e):n[r][t]=[e]))}),OBJ.iterate(a.Current,function(e){var t;"version"!==e&&"changed"!==e&&(t=STR.check(a.Current[e]).split("|")[0],e[0]===r[0]&&81<=t&&t<=89&&(e=e.slice(1),n[r][t]?n[r][t].push(e):n[r][t]=[e]))})),s={tab:r,token:t.token,listTab:{},listToken:[]},OBJ.iterate(n[r],function(e){s.listTab[e]=n[r][e].length}),t.token&&(OBJ.iterateArray(n[r][t.token],function(e){(e=AGB.Token.get(a,r,t.token,e))&&s.listToken.push(e)}),"Target"===r&&t.sort?s.listToken.sort(function(e,t){var a=(OBJ.get(e,"coords")||"").split(":"),n=(OBJ.get(t,"coords")||"").split(":");return+a[0]<+n[0]?-1:+a[0]>+n[0]?1:+a[1]<+n[1]?-1:+a[1]>+n[1]?1:+a[2]<+n[2]?-1:+a[2]>+n[2]?1:0}):s.listToken.sort(function(e,t){var a=(OBJ.get(e,"name")||"").toLowerCase(),n=(OBJ.get(t,"name")||"").toLowerCase();return a<n?-1:a===n?0:1}))),AGB.Panel.Cache(t,s),e&&e(s)},Get:function(e,t){var a,n,i;if(a=AGB.App.getPlayer(e),(n=AGB.Token.getTab(e))&&(i=AGB.Token.get(AGB.Token.Data[a],n,e.token,e.id)),!t)return i||"";t(i)},get:function(e,t,a,n){var i;return OBJ.is(e)&&t&&n&&(a<80?OBJ.is(e[t])&&e[t][n]&&(i={id:n,name:AGB.Token.getName(e[t],n)},"Alliance"===t&&(i.tag=AGB.Token.getTag(e[t],n)),"Target"===t&&(i.coords=AGB.Token.getCoords(e[t],n),i.time=AGB.Token.getTime(e[t],n))):81===a&&OBJ.is(e.Current)&&e.Current[t[0]+n]&&(i={id:n,name:AGB.Token.getName(e.Current,t[0]+n)},"Alliance"===t&&(i.tag=AGB.Token.getTag(e.Current,t[0]+n)),"Target"===t&&(i.coords=AGB.Token.getCoords(e.Current,t[0]+n),i.time=AGB.Token.getTime(e.Current,t[0]+n)))),i||""},getName:function(e,t){return OBJ.is(e)&&t&&STR.check(e[t]).split("|")[1]||""},getCoords:function(e,t){return OBJ.is(e)&&t&&STR.check(e[t]).split("|")[2]||""},getTag:function(e,t){return OBJ.is(e)&&t&&STR.check(e[t]).split("|")[2]||""},getTime:function(e,t){var a;return OBJ.is(e)&&t?1e8<(a=+STR.check(e[t]).split("|")[3]||0)?a:0:0},getColor:function(e,t){return AGB.Token.is(e,"Info")&&AGB.Token.Data[e].Info[t]&&AGB.Token.Data[e].Info[t].color||""},getClass:function(e,t){return AGB.Token.is(e,"Info")&&AGB.Token.Data[e].Info[t]?"status_abbr_"+(AGB.Token.Data[e].Info[t].cls||t):""},getCondition:function(e,t){return AGB.Token.is(e,"Info")&&AGB.Token.Data[e].Info[t]&&+AGB.Token.Data[e].Info[t].condition||0},getOpacity:function(e,t){return AGB.Token.is(e,"Info")&&AGB.Token.Data[e].Info[t]&&+AGB.Token.Data[e].Info[t].opacity||0},getColorOpacity:function(e,t,a){var n,i;return n=AGB.Token.getColor(e,t),i=AGB.Token.getOpacity(e,t),n?(i=i||(t<80?AGB.Option.Get(e,"CT2"):AGB.Styles.opacity)||100,"INHERIT"===n?i/100:AGB.Styles.getColor(n,a?2*i:i)):""},getTab:function(e){return OBJ.is(e)&&e.keyPlayer&&AGB.Token.Data[e.keyPlayer]&&e.tab&&OBJ.is(AGB.Token.Data[e.keyPlayer][e.tab])?e.tab:""},is:function(e,t){return e&&t&&AGB.Token.Data[e]&&OBJ.is(AGB.Token.Data[e][t])?t:""}},AGB.Fleet={Data:{},Messages:function(e,t){"Set"===e?AGB.Fleet.Set(t):"Action"===e&&AGB.Fleet.Action(t)},Init:function(e,t){var a,n,i,r;(i=AGB.App.getPlayer(e))&&(a=AGB.Fleet.Data[i]={version:AGB.Data.get("Fleet","Data","version")},n=OBJ.parse(t[AGB.Data.getKey(i,"Fleet","Data")]),r=a.version!==n.version,AGB.Data.iterate("Fleet",function(e,t){2<=e.tab?a[t]=OBJ.is(n[t])&&!r?n[t]:3===e.tab?[]:{}:e.tab&&(a[t]={})}),r&&(a.changed=!0,AGB.Data.Change())),a=n=i=r=null},Save:function(e){var t,a;a=AGB.App.getPlayer(e),t=AGB.Fleet.Data[a],AGB.Data.isStatus(a)&&t&&(e.backup||t.changed)&&(delete t.changed,e.save&&(e.save[a+"_Fleet_Data"]=JSON.stringify(t)),e.backup&&AGB.Data.isBackup(a,"Fleet","Data",2)&&(e.backup.Fleet_Data=JSON.stringify(t)))},Set:function(t){var a,e,n,i;e=AGB.App.getPlayer(t),n=AGB.Data.getTab(t,"Fleet"),a=AGB.Fleet.Data[e],e&&n&&a&&(OBJ.is(a[n])||(a[n]={}),OBJ.iterate(t.data,function(e){a[n][e]!==t.data[e]&&(a[n][e]=t.data[e],i=!0)}),i&&(a.changed=!0,AGB.Data.Change())),a=e=n=i=null},Action:function(e){var t,a,n,i,r;if(a=AGB.App.getPlayer(e),n=AGB.Data.getTab(e,"Fleet"),t=AGB.Fleet.Data[a],a&&n&&t&&"Last"===n&&OBJ.get(e.data,"coords"))if(Array.isArray(t.Last)||(t.Last=[]),i=+(n=e.data).routine||0,r=n.mission,n.routine=0,!i||VAL.check(i,1,2,3,4)){for(1!==r&&delete n.retreatAfterDefenderRetreat,5!==r&&delete n.holdingtime,15!==r&&delete n.expeditiontime,2!==r&&delete n.union,3===i?(1===r&&(n.routine=3),n.metal=n.crystal=n.deuterium=0):4===i?(8===r&&(n.routine=4),n.metal=n.crystal=n.deuterium=0):(2===i||n.resources)&&(!n.resources||3!==r&&4!==r?n.metal=n.crystal=n.deuterium=0:n.routine=2),i=[AGB.Task.join(n,2)],a=0;a<t.Last.length;a++)(e=AGB.Task.split(t.Last[a],2)).mission&&(n.coordstype===AGB.Task.cutCoordsType(t.Last[a])&&r===e.mission&&n.routine===e.routine||i.push(t.Last[a]));for(t.Last=[],a=0;a<i.length&&(i[a]&&t.Last.push(i[a]),!(8<t.Last.length));a++);t.changed=!0,AGB.Data.Change()}else 5===i?(e=AGB.Task.split(OBJ.get(t.Routine,"Collect"))).routine&&(n.routine=e.routine,i=AGB.Task.cut(AGB.Task.join(n),10),AGB.Fleet.Set({keyPlayer:a,tab:"Routine",data:{Collect:i}})):6===i?(e=AGB.Task.split(OBJ.get(t.Routine,"Save"))).routine&&(n.routine=e.routine,i=AGB.Task.cut(AGB.Task.join(n),10),AGB.Fleet.Set({keyPlayer:a,tab:"Routine",data:{Save:i}})):7===i&&(i=AGB.Task.cutSystem(e.coords),15===r&&i&&AGB.Fleet.Set({keyPlayer:a,tab:"Expo",data:OBJ.createKey(i,(+OBJ.get(t.Expo,i)||0)+1)}))}},AGB.DataBase={status:0,readLimit:2e3,Info:{Player:{keyPath:"I",hour:24,url:"/api/players.xml",split:"<player "},Universe:{keyPath:"pI",hour:168,url:"/api/universe.xml",split:"<planet "}},Data:{},Cache:{},Messages:function(e,t,a){OBJ.is(t)&&("Remove"===e?AGB.DataBase.Remove(t):"Set"===e?AGB.DataBase.Set(t,a):"GetPlayer"===e?AGB.DataBase.GetPlayer(t,a):"GetPlanet"===e&&AGB.DataBase.GetPlanet(t,a))},Start:function(e){OBJ.is(e.indexedDB)&&"function"==typeof e.IDBKeyRange&&(AGB.DataBase.indexedDB=e.indexedDB,AGB.DataBase.IDBKeyRange=e.IDBKeyRange,AGB.DataBase.status=1)},Init:function(e){var t;(t=AGB.App.getUni(e))&&(OBJ.is(AGB.DataBase.Data[t])||(AGB.DataBase.Data[t]={status:0,keyUni:e.keyUni,urlUni:e.urlUni}),0<=(t=AGB.DataBase.Data[t]).status&&t.status<=2&&(t.status=3,t.keyPlayer=e.keyPlayer,t.api=AGB.Option.Get(e.keyPlayer,"D20"),AGB.DataBase.Open(OBJ.create(t),"Player")))},Status:function(e){var a,n;return(n=AGB.App.getUni(e))&&AGB.DataBase.Data[n]&&(a={status:AGB.DataBase.Data[n].status,tab:e.tab},OBJ.iterate(AGB.DataBase.Info,function(e){var t;t=AGB.DataBase.Data[n+"_"+e]||{},a[e]={status:+t.status||0,timestamp:+t.timestamp||0,loading:+t.loading||0,entries:+t.entries||0}})),a},Close:function(e){if(OBJ.is(AGB.DataBase.Data[e])){if(OBJ.is(AGB.DataBase.Data[e].db))try{AGB.DataBase.Data[e].db.close()}catch(e){}AGB.DataBase.Data[e].db=null}},Remove:function(e){var i;(i=AGB.App.getUni(e))&&(AGB.DataBase.set(i,"status",-3),OBJ.iterate(AGB.DataBase.Info,function(n){var e;e=i+"_"+n,AGB.DataBase.Close(e),AGB.DataBase.Data[e]={status:-3},AGB.DataBase.indexedDB.deleteDatabase(e).onsuccess=function(){var t,e,a;t=i,e=n,AGB.App.getUni({keyUni:t})&&AGB.DataBase.Info[e]&&(AGB.Core.Log("DataBase - Remove   : "+t+"_"+e,!0),a=!0,AGB.DataBase.set(t+"_"+e,"status",0),OBJ.iterate(AGB.DataBase.Info,function(e){-3===AGB.DataBase.get(t+"_"+e,"status")&&(a=!1)}),a&&AGB.DataBase.set(t,"status",0))}}))},set:function(e,t,a){e&&t&&OBJ.is(AGB.DataBase.Data[e])&&(AGB.DataBase.Data[e][t]=a)},get:function(e,t){return e&&t&&OBJ.is(AGB.DataBase.Data[e])?AGB.DataBase.Data[e][t]:0},isStatus:function(e,t){var a,n;if((a=AGB.App.getUni(e))&&t&&AGB.DataBase.Info[t]){if(1===AGB.DataBase.get(a,"status"))return a=a+"_"+t,1===(n=AGB.DataBase.get(a,"status"))||2===n?a:"";e.error=!0}return""},ObjectStore:function(t,a,n,i){if(t&&OBJ.is(AGB.DataBase.Data[t].db))try{i(AGB.DataBase.Data[t].db.transaction(a,n||"readonly").objectStore(a))}catch(e){AGB.DataBase.indexedDB.open(t).onsuccess=function(e){try{AGB.DataBase.Data[t].db=e.target.result}catch(e){AGB.DataBase.Data[t].db=null}try{i(AGB.DataBase.Data[t].db.transaction(a,n||"readonly").objectStore(a))}catch(e){i(null)}}}else i(null)},Set:function(i){var e;OBJ.is(i)&&OBJ.is(i.data)&&(e=AGB.DataBase.isStatus(i,"Player"),i.api=AGB.DataBase.get(i.keyUni,"api"),e&&OBJ.is(i.data.Player)&&AGB.DataBase.ObjectStore(e,"I","readwrite",function(a){a&&OBJ.iterate(i.data.Player,function(e){var t;(t=i.data.Player[e]).I&&(a.get(+e).onsuccess=function(e){(e=e.target.result)&&t.N===e.N&&t.s===e.s&&t.aI===e.aI||(i.api&&AGB.Core.Log("Galaxy - Update Player "+t.N),a.put(t))})})}),(e=AGB.DataBase.isStatus(i,"Universe"))&&OBJ.is(i.data.Planet)&&AGB.DataBase.ObjectStore(e,"pI","readwrite",function(n){n&&OBJ.iterate(i.data.Planet,function(t){var a;a=i.data.Planet[t],n.index("c").get(t).onsuccess=function(e){e=e.target.result,a&&!e?(i.api&&AGB.Core.Log("Galaxy - New planet: "+t),n.put(a)):a&&e?a.I!==e.I?(AGB.Core.Log("Galaxy - Different player: "+t+" - Player "+e.I),e.c="moved",n.put(e),n.put(a)):a.pI!==e.pI?(AGB.Core.Log("Galaxy - Different planet: "+t),e.c="moved",n.put(e),n.put(a)):a.pN===e.pN&&a.mI===e.mI&&a.mN===e.mN||(AGB.Core.Log("Galaxy - Update planet: "+t),n.put(a)):!a&&e&&(AGB.Core.Log("Galaxy - Missing planet: "+t+" - Player "+e.I),e.c="moved",n.put(e))}})}))},GetPlayer:function(a,n){function t(t){a.error&&n(a),a.planets?(t=t||{},AGB.DataBase.getPlanetsByPlayerId(a,function(e){t.planets=e,Array.isArray(t.planets)&&(OBJ.iterateArray(t.planets,function(e){e&&(!t.planetHome||+e.planetId<+t.planetHome)&&(t.planetHome=e.planetId)}),1===a.planets?t.planets.sort(function(e,t){var a,n;return a=STR.check(e.coords).split(":"),n=STR.check(t.coords).split(":"),+a[0]<+n[0]?-1:+a[0]>+n[0]?1:+a[1]<+n[1]?-1:+a[1]>+n[1]?1:+a[2]<+n[2]?-1:+a[2]>+n[2]?1:0}):2===a.planets&&t.planets.sort(function(e,t){return STR.check(e.planetName),STR.check(t.planetName),e<t?-1:e===t?0:1})),n(t)})):n(t)}"function"==typeof n&&(a.id?AGB.DataBase.getPlayerById(a,t):a.coords?AGB.DataBase.getPlanetByCoords(a,function(e){a.id=OBJ.get(e,"playerId"),AGB.DataBase.getPlayerById(a,t)}):n())},GetPlanet:function(e,a){"function"==typeof a&&(e.id?a():e.coords?AGB.DataBase.getPlanetByCoords(e,function(t){t=t||{},e.id=t.playerId,AGB.DataBase.getPlayerById(e,function(e){OBJ.copy(e,t),a(t)})}):a())},getPlayerById:function(t,a){var e;if("function"==typeof a)if(e=AGB.DataBase.isStatus(t,"Player"))try{AGB.DataBase.ObjectStore(e,"I","readonly",function(e){e&&+t.id?e.get(+t.id).onsuccess=function(e){var t;e=e.target.result,OBJ.is(e)&&e.I&&(t={playerId:(e.I||"")+"",playerName:e.N||"",playerStatus:e.s||"",allianceId:(e.aI||"")+""}),a(t)}:a()})}catch(e){a()}else a()},getPlanetsByPlayerId:function(t,i){var e;if("function"==typeof i)if(e=AGB.DataBase.isStatus(t,"Universe"))try{AGB.DataBase.ObjectStore(e,"pI","readonly",function(e){var n;e&&+t.id?(n=[],e.index("I").openCursor(AGB.DataBase.IDBKeyRange.only(+t.id)).onsuccess=function(e){var t,a;e.target.result?(a=e.target.result.value,OBJ.get(a,"pI")&&(t={coords:a.c||"",planetId:(a.pI||"")+"",planetName:a.pN||""},a.mI&&(t.moonId=(a.mI||"")+"",t.moonName=a.mN||""),n.push(t)),e.target.result.continue()):i(n)}):i()})}catch(e){i()}else i()},getPlanetByCoords:function(t,a){var e;if("function"==typeof a)if(e=AGB.DataBase.isStatus(t,"Universe"))try{AGB.DataBase.ObjectStore(e,"pI","readonly",function(e){e&&t.coords?e.index("c").get(t.coords).onsuccess=function(e){var t;e=e.target.result,OBJ.is(e)&&e.pI&&(t={playerId:(e.I||"")+"",coords:e.c||"",planetId:(e.pI||"")+"",planetName:e.pN||"",moonId:(e.mI||"")+"",moonName:e.mN||""}),a(t)}:a()})}catch(e){a()}else a()},Open:function(n,i){function r(e,t,a){s.timestamp=+a||1,s.status=t||("blocked"===e.type?-1:-2);try{s.db=e.target.result}catch(e){s.db=null}AGB.DataBase.Check(n)}var s,o,e;e=-3,AGB.App.getUni(n)&&i&&(n.key="",n.tab=i,AGB.DataBase.Info[n.tab]&&(n.key=n.keyUni+"_"+n.tab,OBJ.is(AGB.DataBase.Data[n.key])||(AGB.DataBase.Data[n.key]={}),e=(e=+(s=AGB.DataBase.Data[n.key]).status||0)<-1?e:1===e||2===e?e:0,s.status=e)),e<0?AGB.DataBase.Check(n):OBJ.is(s.db)&&s.timestamp?AGB.DataBase.Check(n):(s.status=4,AGB.DataBase.Close(n.key),(o=AGB.DataBase.indexedDB.open(n.key,2)).onblocked=r,o.onerror=r,o.onupgradeneeded=function(e){var t,a;t=AGB.DataBase.Info[n.tab].keyPath,o.onsuccess=null,(a=e.target.result).onerror=r,a.objectStoreNames.contains("info")||a.createObjectStore("info"),a.objectStoreNames.contains(t)||(t=a.createObjectStore(t,{keyPath:t}),"Universe"===i&&(t.createIndex("I","I",{unique:!1}),t.createIndex("c","c",{unique:!1}))),r(e,2)},o.onsuccess=function(t){var e;try{(e=t.target.result.transaction("info").objectStore("info").get("timestampServer")).onerror=r,e.onsuccess=function(e){r(t,1,e.target.result)}}catch(e){r(t,-2)}})},isRead:function(e){return AGB.status&&e.api&&e.key&&3<=AGB.DataBase.get(e.keyUni,"status")?AGB.DataBase.Data[e.key].status:0},Check:function(e){var t,a,n;1<=AGB.DataBase.isRead(e)?((t=AGB.DataBase.Data[e.key]).status=1!==t.status?t.status:t.timestamp<1e3?2:AGB.Time.timestamp()-t.timestamp>3600*AGB.DataBase.Info[e.tab].hour?2:1,2<=t.status&&(e.load||!t.timestampRead||AGB.Time.timestamp()-t.timestampRead>AGB.DataBase.readLimit)?((a=new XMLHttpRequest).timeout=2e3,a.open("HEAD",e.urlUni+AGB.DataBase.Info[e.tab].url,!0),a.onerror=a.onload=function(){AGB.DataBase.isRead(e)&&(t.timestampRead=AGB.Time.timestamp(),t.timestampHeader=Math.floor(new Date(a.getResponseHeader("Last-Modified")).getTime()/1e3),200==+a.status&&1e4<t.timestampHeader?t.status=t.timestamp/100<t.timestampHeader/100?3:1:(t.timestampHeader=0,AGB.Core.Log("DataBase   - ########## Problem: These OGame API is not available - "+e.tab,!0))),AGB.DataBase.Read(e)},a.send(null)):AGB.DataBase.Read(e)):(-1===(n=AGB.DataBase.get(e.key,"status"))&&AGB.Core.Log("DataBase   - Problem: Please restart your browser ("+e.key+")",!0),-2===n&&AGB.Core.Log("DataBase   - Problem: Please delete the database "+e.tab+" for the universe "+e.keyUni,!0),AGB.DataBase.Read(e))},Read:function(B){function u(e){p.status=e||-1,p.loading=0;try{p.db.close()}catch(e){}AGB.Manager.message(B,"DataBase","Notify",AGB.DataBase.Status(B)),AGB.Core.Log("DataBase - Read     : "+B.key+" - Finished with entries: "+(p.entries||"")+" ("+e+")",!0),t(B)}function t(t){"Player"===t.tab?AGB.DataBase.Open(t,"Universe"):"Universe"===t.tab&&t.keyUni&&(AGB.DataBase.Data[t.keyUni].status=1,OBJ.iterate(AGB.DataBase.Info,function(e){(e=+AGB.DataBase.get(t.keyUni+"_"+e,"status")||0)<=0&&(AGB.DataBase.Data[t.keyUni].status=-1),3<=e&&-1!==AGB.DataBase.Data[t.keyUni].status&&(AGB.DataBase.Data[t.keyUni].status=3)}))}var p,r,a;3===AGB.DataBase.isRead(B)?(AGB.Core.Log("DataBase - Read     : "+B.key,!0),r=AGB.DataBase.Info[B.tab],(p=AGB.DataBase.Data[B.key]).loading=0,AGB.Manager.message(B,"DataBase","Notify",{tab:B.tab,loading:p.loading}),(a=new XMLHttpRequest).open("GET",B.urlUni+r.url,!0),a.overrideMimeType("text/html"),a.onerror=a.onload=function(){var i,e;AGB.DataBase.isRead(B)&&(i=a.responseText||"",200==+a.status&&-1<i.indexOf(r.split)?(AGB.DataBase.Close(B.key),(e=AGB.DataBase.indexedDB.open(B.key)).onerror=u,e.onblocked=u,e.onsuccess=function(e){var t,s,a,o,c,n,l;t=e,l=0,s=(i||"").split(AGB.DataBase.Info[B.tab].split),c={a:30,v:29,b:28,o:27,h:26,I:23,i:22},n=t.target.result,p.db=t.target.result,p.entries=s.length,p.timestamp=p.timestampHeader||+STR.getAttribute(s[0],"timestamp")||AGB.Time.timestamp(),n.objectStoreNames.contains("info")&&n.objectStoreNames.contains(r.keyPath)?((a=n.transaction("info","readwrite")).objectStore("info").put(0,"timestampServer"),a.objectStore("info").put(0,"entries"),(a=n.transaction(r.keyPath,"readwrite")).onabort=function(){u(1)},a.ontimeout=u,a.oncomplete=function(){s=null,3===AGB.DataBase.isRead(B)&&((a=n.transaction("info","readwrite")).objectStore("info").put(p.timestamp,"timestampServer"),a.objectStore("info").put(p.entries,"entries"),u(1))},(o=a.objectStore(r.keyPath)).clear(),"Player"===B.tab?function e(){var t,a;if(l++,3!==AGB.DataBase.isRead(B))u();else if(l<s.length){a=" "+s[l],t=+STR.getAttribute(a,"id")||l;var n=STR.getAttribute(a,"name"),i=STR.getAttribute(a,"status"),r=21;i&&(i[0]&&(r=Math.max(+c[i[0]]||0,r)),i[1]&&(r=Math.max(+c[i[1]]||0,r)),i[2]&&(r=Math.max(+c[i[2]]||0,r))),t={I:t,N:n,s:r},(a=+STR.getAttribute(a,"alliance")||0)&&(t.aI=a),0==l%Math.ceil(s.length/100)&&(p.loading=Math.ceil(l/(s.length/100))||1,AGB.Manager.message(B,"DataBase","Notify",{tab:B.tab,loading:p.loading})),o.add(t).onsuccess=e}}():"Universe"===B.tab&&function e(){var t,a;l++,3!==AGB.DataBase.isRead(B)?u():l<s.length&&(a=(" "+s[l]).split("<moon"),t={pI:+STR.getAttribute(a[0],"id")||l,I:+STR.getAttribute(a[0],"player")||2,pN:STR.getAttribute(a[0],"name"),c:STR.getAttribute(a[0],"coords")},a[1]&&(t.mI=+STR.getAttribute(a[1],"id")||0,t.mN=STR.getAttribute(a[1],"name")),0==l%Math.ceil(s.length/100)&&(p.loading=Math.ceil(l/(s.length/100))||1,AGB.Manager.message(B,"DataBase","Notify",{tab:B.tab,loading:p.loading})),o.add(t).onsuccess=e)}()):u(-2)}):(AGB.Core.Log("DataBase   - ########## Problem: These OGame API is not available - "+r.url,!0),u())),a=null},a.send(null)):t(B)}},AGB.Tools={Data:{},List:["A","B","C","D","E","F",1,2,3,4,5,6,7,8,9],Links:{T3A:"http://proxyforgame.com/ogame/calc/trade.php",T3B:"http://ogamespec.com/tools/trade.php",T4A:"http://proxyforgame.com/ogame/calc/flight.php",T4B:"http://www.toolsforogame.com/battle/batalla_ACS_SAC.aspx",T4C:"http://snaquekiller.free.fr/ogame/tableau.html",T7A:"http://kb.un1matr1x.de/save.php",T7B:"http://logserver.net/index.php",T9A:"http://wiki.ogame.org/",T9B:"http://board.origin.ogame.de/index.php?page=Thread&threadID=104"},Messages:function(e,t,a){"Action"===e&&AGB.Tools.Action(t,a)},Action:function(e,t){var a,n,i;if(n=AGB.App.getPlayer(e,"copy")){if(i={id:e.id},AGB.Option.Get(n,"T05")&&((a=AGB.Task.splitActive(AGB.Option.Get(n,"T06"),2,e.coordstype)).ships?e.Ships=OBJ.createFilter(a,AGB.Item.Ship):e.planetId&&(e.Ships=AGB.Units.create(n,e.planetId,AGB.Item.ShipCombat))),OBJ.is(e.Search))switch(e.tab=e.Search.tab,e.tab){case"Alliance":e.searchAlliance=e.Search.id,e.searchAllianceName=e.Search.name,e.searchAllianceTag=e.Search.tag;break;case"Player":e.searchPlayer=e.Search.id,e.searchPlayerName=e.Search.name;break;case"Target":e.searchTarget=e.Search.id,e.searchTargetCoords=e.Search.coords}else e.searchAlliance=AGB.Panel.getActive(n,"Alliance","id",6),e.searchAllianceName=AGB.Panel.getActive(n,"Alliance","name",6),e.searchAllianceTag=AGB.Panel.getActive(n,"Alliance","tag",6),e.searchPlayer=AGB.Panel.getActive(n,"Player","id",6),e.searchPlayerName=AGB.Panel.getActive(n,"Player","name",6),e.searchTarget=AGB.Panel.getActive(n,"Target","id",6),e.searchTargetCoords=AGB.Panel.getActive(n,"Target","coords",6);switch(-1<STR.check(e.searchTarget).indexOf(":")&&(e.searchTarget=""),e.searchTargetMoon=3==+STR.check(e.searchTargetCoords).split(":")[3],e.searchTargetCoords=AGB.Task.cutCoords(e.searchTargetCoords),e.id){case"T1A":AGB.Tools.createOgniter(e);break;case"T1B":AGB.Tools.createInfuza(e);break;case"T1C":AGB.Tools.createWarRiders(e);break;case"T2A":AGB.Tools.createCumulative(e);break;case"T2B":AGB.Tools.createOcalcAmortisation(e);break;case"T5A":AGB.Tools.createOsimulate(e);break;case"T5B":AGB.Tools.createWebsim(e);break;case"T5C":AGB.Tools.createDragosim(e);break;default:AGB.Tools.createLink(e)}i.href=e.href}t&&t(i)},createLink:function(e){var t;t=AGB.App.getPlayer(e,"copy"),t=AGB.Tools.Links[e.id]||STR.check(AGB.Option.Get(t,e.id)).split("|",2)[1],(t=STR.check(t).trim())&&("http:/"!==t.slice(0,6).toLowerCase()&&"https:/"!==t.slice(0,7).toLowerCase()&&(t="http://"+t),t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\[UNI\]/g,NMR.parseIntAbs(e.abbrUni)||"")).replace(/\[ALLIANCE\]/g,e.searchAlliance||"")).replace(/\[ALLIANCENAME\]/g,e.searchAllianceName||"")).replace(/\[ALLIANCETAG\]/g,e.searchAllianceTag||"")).replace(/\[PLAYER\]/g,e.searchPlayer||"")).replace(/\[PLAYERNAME\]/g,e.searchPlayerName||"")).replace(/\[TARGET\]/g,e.searchTarget||"")).replace(/\[TARGETCOORDS\]/g,e.searchTargetCoords||"")).replace(/\[TARGETMOON\]/g,e.searchTargetMoon||""),e.href=t)},createWarRiders:function(e){var t,a;(a=AGB.Com.Get(e.abbrCom,"warriders"))&&(t="Alliance"===e.tab?"&page=details&type=ally&name="+(e.searchAllianceTag||""):"Player"===e.tab?"&page=details&type=player&name="+(e.searchPlayerName||""):"",e.href="http://ogame.gamestats.org/?lang="+a+"&uni="+(e.abbrUni||"").toLowerCase()+encodeURI(t))},createInfuza:function(e){var t;t="Alliance"===e.tab?"&pora=alliances&value="+(e.searchAllianceTag||""):"Player"===e.tab?"&pora=players&value="+(e.searchPlayerName||""):"",e.href="http://www.infuza.com/"+AGB.Com.Get(e.abbrCom,"infuza")+"/Search?server="+AGB.Com.Get(e.abbrCom,"infuzaServer")+encodeURI(t)},createOgniter:function(e){var t;t="Alliance"===e.tab?"/alliance/"+(e.searchAlliance||""):"Player"===e.tab?"/player/"+(e.searchPlayer||""):"",e.href="http://www.ogniter.org/"+AGB.Com.Get(e.abbrCom,"ogniter")+"/"+AGB.Com.Get(e.abbrCom,"ogniter")+NMR.parseIntAbs(e.abbrUni)+encodeURI(t)},createCumulative:function(t){var a,n;a=AGB.App.getPlayer(t,"copy"),n="http://calc.antigame.de/?lang="+(t.abbrCom||"").toLowerCase()+"&coords="+(t.coords||"")+"&type="+(t.type||"")+"&name="+(t.planetName||"")+"&uni_speed="+AGB.Uni.Get(a,"speed")+"&robo="+AGB.Units.Get(a,t.planetId,"14")+"&nanite="+AGB.Units.Get(a,t.planetId,"15")+"&rlab="+AGB.Units.Get(a,t.planetId,"31")+(AGB.Option.Get(a,"technocrat")?"&technocrat=1":""),OBJ.iterate(AGB.Item.Mining,function(e){n+=STR.addUrlPara(e+"c",AGB.Units.Get(a,t.planetId,e))}),OBJ.iterate(AGB.Item.Station,function(e){n+=STR.addUrlPara(e+"c",AGB.Units.Get(a,t.planetId,e))}),OBJ.iterate(AGB.Item.Research,function(e){n+=STR.addUrlPara(e+"c",AGB.Units.Get(a,"account",e))}),t.href=n},createOcalcAmortisation:function(t){var a,n,e;a=AGB.App.getPlayer(t,"copy"),e=AGB.Option.Get(a,"commander")&&AGB.Option.Get(a,"admiral")&&AGB.Option.Get(a,"engineer")&&AGB.Option.Get(a,"geologist")&&AGB.Option.Get(a,"technocrat")?"1.12":AGB.Option.Get(a,"geologist")?"1.1":"1",n="http://www.o-calc.com/?sec=_amortisation&lang="+(t.abbrCom||"").toLowerCase()+"&p="+AGB.Units.Get(a,"account","122")+"&g="+e+"&em=2&ec=1&ed=1&s="+AGB.Uni.Get(a,"speed")+"&d=",OBJ.iterate(t.Planets,function(e){n+=encodeURI(OBJ.get(t.Planets[e],"name"))+"."+((+OBJ.get(t.Planets[e],"temp")||0)+40).toString(36)+"."+AGB.Units.Get(a,e,"1").toString(36)+"."+AGB.Units.Get(a,e,"2").toString(36)+"."+AGB.Units.Get(a,e,"3").toString(36)+"+"}),t.href=n},createOsimulate:function(t){var a,e,n;e=AGB.App.getPlayer(t,"copy"),a=t.Task,n="http://www.osimulate.com/?ref=antigame&lang="+AGB.Com.Get(t.abbrCom,"osimulate")+"&uni="+t.abbrCom+"_"+t.abbrUni+"&uni_speed="+AGB.Uni.Get(e,"speedFleet")+"&fleet_debris="+100*AGB.Uni.Get(e,"debrisFactor")+"&defense_debris="+(AGB.Uni.Get(e,"defToTF")?100*AGB.Uni.Get(e,"debrisFactor"):"0")+"&rapidfire="+(AGB.Uni.Get(e,"rapidFire")?1:0)+"&start_pos="+(t.coords||"")+"&engine0_0="+AGB.Units.Get(e,"account","115")+"&engine0_1="+AGB.Units.Get(e,"account","117")+"&engine0_2="+AGB.Units.Get(e,"account","118"),n=a&&!a.timeResearch&&AGB.Option.Get(e,"T03")?n+"&del_techs=1":n+"&tech_a0_0="+AGB.Units.Get(e,"account","109")+"&tech_a0_1="+AGB.Units.Get(e,"account","110")+"&tech_a0_2="+AGB.Units.Get(e,"account","111"),OBJ.iterate(t.Ships,function(e){n+=STR.addUrlPara("ship_a0_"+((+e||0)-202)+"_b",t.Ships[e])}),a&&(n+="&tech_d0_0="+(+a[109]||0)+"&tech_d0_1="+(+a[110]||0)+"&tech_d0_2="+(+a[111]||0)+"&enemy_metal="+(+a.metal||0)+"&enemy_crystal="+(+a.crystal||0)+"&enemy_deut="+(+a.deuterium||0)+"&enemy_name="+(a.name||"")+"&enemy_pos="+(a.coords||"")+"&enemy_type="+(a.type||"")+"&enemy_player="+(a.detail||"")+"&enemy_status="+(a.status||"")+"&report_time="+(a.time||"")+"&plunder_perc="+(a.plunder||"")+STR.addUrlPara("abm_b",a[502]),OBJ.iterate(AGB.Item.Ship,function(e){n+=STR.addUrlPara("ship_d0_"+((+e||0)-202)+"_b",a[e])}),OBJ.iterate(AGB.Item.Defense,function(e){1===AGB.Item.Defense[e]&&(n+=STR.addUrlPara("ship_d0_"+((+e||0)-387)+"_b",a[e]))})),t.href=n},createWebsim:function(t){var a,e,n;e=AGB.App.getPlayer(t,"copy"),a=t.Task,n="http://websim.speedsim.net/index.php?version=1&ref=antigame&lang="+AGB.Com.Get(t.abbrCom,"websim")+"&uni="+t.abbrCom+"_"+t.abbrUni+"&uni_speed="+AGB.Uni.Get(e,"speedFleet")+"&perc-df="+100*AGB.Uni.Get(e,"debrisFactor")+"&def_to_df="+(AGB.Uni.Get(e,"defToTF")?1:0)+"&rf="+(AGB.Uni.Get(e,"rapidFire")?1:0)+"&start_pos="+(t.coords||"")+"&engine0_0="+AGB.Units.Get(e,"account","115")+"&engine0_1="+AGB.Units.Get(e,"account","117")+"&engine0_2="+AGB.Units.Get(e,"account","118"),n=a&&!a.timeResearch&&AGB.Option.Get(e,"T03")?n+"&del_techs=1":n+"&tech_a0_0="+AGB.Units.Get(e,"account","109")+"&tech_a0_1="+AGB.Units.Get(e,"account","110")+"&tech_a0_2="+AGB.Units.Get(e,"account","111"),OBJ.iterate(t.Ships,function(e){n+=STR.addUrlPara("ship_a0_"+((+e||0)-202)+"_b",t.Ships[e])}),a&&(n+="&tech_d0_0="+(+a[109]||0)+"&tech_d0_1="+(+a[110]||0)+"&tech_d0_2="+(+a[111]||0)+"&enemy_metal="+(+a.metal||0)+"&enemy_crystal="+(+a.crystal||0)+"&enemy_deut="+(+a.deuterium||0)+"&enemy_name="+(a.name||"")+"&enemy_pos="+(a.coords||"")+"&enemy_type="+(a.type||"")+"&enemy_player="+(a.detail||"")+"&enemy_status="+(a.status||"")+"&report_time="+(a.time||"")+"&plunder_perc="+(a.plunder||"")+STR.addUrlPara("abm_b",a[502]),OBJ.iterate(AGB.Item.Ship,function(e){n+=STR.addUrlPara("ship_d0_"+((+e||0)-202)+"_b",a[e])}),OBJ.iterate(AGB.Item.Defense,function(e){1===AGB.Item.Defense[e]&&(n+=STR.addUrlPara("ship_d0_"+((+e||0)-387)+"_b",a[e]))})),t.href=n},createDragosim:function(t){var a,e,n,i;e=AGB.App.getPlayer(t,"copy"),a=t.Task,i={202:"k_t",203:"g_t",204:"l_j",205:"s_j",206:"kr",207:"sc",208:"ko",209:"re",210:"sp",211:"bo",212:"so",213:"z",214:"t",215:"sk",401:"ra",402:"l_l",403:"s_l",404:"g",405:"i",406:"p",407:"k_s",408:"g_s"},n="http://drago-sim.com/index.php?ref=antigame&lang="+AGB.Com.Get(t.abbrCom,"dragosim")+"&uni="+t.abbrCom+"_"+t.abbrUni+"&uni_speed="+AGB.Uni.Get(e,"speedFleet")+"&debris_ratio="+AGB.Uni.Get(e,"debrisFactor")+"&def_tf="+Boolean(AGB.Uni.Get(e,"defToTF"))+"&rapid_fire="+(AGB.Uni.Get(e,"rapidFire")?1:0),n=a&&!a.timeResearch&&AGB.Option.Get(e,"T03")?n+"&del_techs=1":n+"&techs[0][0][w_t]="+AGB.Units.Get(e,"account","109")+"&techs[0][0][s_t]="+AGB.Units.Get(e,"account","110")+"&techs[0][0][r_p]="+AGB.Units.Get(e,"account","111"),OBJ.iterate(t.Ships,function(e){n+=STR.addUrlPara("numunits[0][0]["+i[e]+"]",t.Ships[e])}),a&&(n+="&techs[1][0][w_t]="+(+a[109]||0)+"&techs[1][0][s_t]="+(+a[110]||0)+"&techs[1][0][r_p]="+(+a[111]||0)+"&v_met="+(+a.metal||0)+"&v_kris="+(+a.crystal||0)+"&v_deut="+(+a.deuterium||0)+"&v_planet="+(a.name||"")+"&v_coords="+(a.coords||"")+"&enemy_type="+(a.type||"")+"&enemy_player="+(a.detail||"")+"&enemy_status="+(a.status||"")+"&report_time="+(a.time||"")+"&plunder_perc="+(a.plunder||"")+STR.addUrlPara("missiles_available_v",a[502]),OBJ.iterate(AGB.Item.Ship,function(e){n+=STR.addUrlPara("numunits[1][0]["+i[e]+"]",a[e])}),OBJ.iterate(AGB.Item.Defense,function(e){1===AGB.Item.Defense[e]&&(n+=STR.addUrlPara("numunits[1][0]["+i[e]+"]",a[e]))})),t.href=n}};