if(!AGB)var AGB={};AGB.Manager={Messages:function(e,t,o,r,a){e&&OBJ.is(AGB[e])&&"function"==typeof AGB[e].Messages&&("function"==typeof r?AGB[e].Messages(t,JSON.parse(o||"{}"),function(e){r(JSON.stringify(e||""))},a):AGB[e].Messages(t,JSON.parse(o||"{}"),null,a))},Start:function(){var e;AGB.Core.Log("Manager - Start",!0),AGB.status=1,AGB.Config.pathSkin="chrome://skin/content/",e=AGB.Core.resourceFile("install.rdf"),AGB.Config.name=STR.getAttribute(e,"em:name"),AGB.Config.beta=-1<AGB.Config.name.indexOf("Alpha")?AGB.Config.beta:-1<AGB.Config.name.indexOf("Beta")?1:0,AGB.DataBase?AGB.DataBase.Start(AGB.Core.global):AGB.DataBase={};try{AGB.Core.Services.scriptloader.loadSubScript(AGB.Config.path+"js/api_firefox.js",AGB.API.prototype,"UTF-8")}catch(e){AGB.Core.reportError(e,"API js/api_firefox.js")}AGB.Storage.Start(function(){AGB.Core.Log("Start  Storage: "+AGB.Storage.status+"  DataBase: "+AGB.DataBase.status+(1<AGB.Config.beta?"  - Development mode":""),!0)}),AGB.Core.Services.obs.addObserver(AGB.Manager.Check,"content-document-global-created",!1),AGB.Core.Services.obs.addObserver(AGB.Manager.Stop,"quit-application",!1)},Stop:function(e){var t;for(t in AGB.Core.Services.obs.removeObserver(AGB.Manager.Check,"content-document-global-created",!1),AGB.Core.Services.obs.removeObserver(AGB.Manager.Stop,"quit-application",!1),AGB.App.Stop(),AGB.status=0,AGB)AGB.hasOwnProperty(t)&&"object"==typeof AGB[t]&&"Config"!==t&&"Core"!==t&&"Manager"!==t&&"Storage"!==t&&(AGB[t].Data&&(AGB[t].Data=null),AGB[t].Player&&(AGB[t].Player=null),AGB[t].Status&&(AGB[t].Status=null),AGB[t]=null)},WindowListener:{setupBrowserUI:function(e){AGB.Core.Log("AntiGameOrigin:  New Window",!0)},tearDownBrowserUI:function(e){},onOpenWindow:function(e){AGB.Core.Log("AntiGameOrigin:  New Window",!0)},onCloseWindow:function(e){},onWindowTitleChange:function(e,t){}},Check:function(t,e,o){var r;!t.AGO_started&&t.location.href&&t.top===t.self&&o&&"content-document-global-created"===e&&("about:blank"===t.location.href?t.addEventListener("DOMContentLoaded",function e(){t.removeEventListener("DOMContentLoaded",e,!1),"about:blank"===t.location.href||t.AGO_started||(r=AGB.App.Check(t.location.href),OBJ.is(r)&&r.mode&&AGB.Manager.Load(r,t))},!1):(r=AGB.App.Check(t.location.href),OBJ.is(r)&&r.mode&&AGB.Manager.Load(r,t)))},Load:function(e,t){var o,r,a;for(t.AGO_started=1,r=Components.utils.Sandbox(t,{sandboxPrototype:t}),new AGB.API(r),3===e.mode?(o=["js/basics.js","js/common.js","js/overlays.js","js/main.js","js/init.js"],2<=AGB.Config.beta&&o.unshift("js/constant.js")):2===e.mode?(o=["js/basics.js","js/common.js","js/init.js"],2<=AGB.Config.beta&&o.unshift("js/constant.js")):o=["js/coordinates.js"],a=0;a<o.length;a++)try{AGB.Core.Services.scriptloader.loadSubScript(AGB.Config.path+o[a],r,"UTF-8")}catch(e){AGB.Core.reportError(e,"AGO "+o[a])}},loadScripts:function(t,e){var o;if(OBJ.is(t)&&e)for(o=0;o<t.length;o++)try{AGB.Core.Services.scriptloader.loadSubScript(AGB.Config.path+"js/"+t[o]+".js",e,"UTF-8")}catch(e){AGB.Core.reportError(e,"AGO "+t[o])}},message:function(e,t,o,r){var a,n,s,i,c,B,f,A;if(n=AGB.App.getPlayer(e))try{for(s=Components.classes["@mozilla.org/appshell/window-mediator;1"].getService(Components.interfaces.nsIWindowMediator).getEnumerator("navigator:browser");s.hasMoreElements();)if((i=s.getNext().gBrowser)&&i.browsers)for(f=i.browsers.length,A=0;A<f;A++)-1<((c=i.getBrowserAtIndex(A)).currentURI.spec||"").indexOf("ogame.gameforge.com/")&&(a=c.contentDocument.getElementById("ago_global_data"))&&a.getAttribute("ago-data-key")===n&&(e={detail:JSON.stringify({player:n,page:t||"",role:o||"",data:r||""})},(B=c.contentDocument.defaultView).dispatchEvent(new B.CustomEvent("ago_global_send",e)))}catch(e){}}},AGB.Storage={status:0,Start:function(e){var t;if(AGB.Storage.status=0,AGB.Storage.local=AGB.Core.Services.prefs.getBranch("extensions."+AGB.Config.id+"."),AGB.Storage.sync=AGB.Core.Services.prefs.getBranch("services.sync.prefs.sync.extensions."+AGB.Config.id+"."),AGB.Storage.local){t=Math.floor(Date.now()/1e3);try{AGB.Storage.local.setIntPref("App_Start",t),AGB.Storage.status=t===+AGB.Storage.local.getIntPref("App_Start")?1:0}catch(e){}}e()},Set:function(e,t){var o,r;if(OBJ.is(e)&&(e.key?(o={})[e.key]=e.data:o=e.data,OBJ.is(o)&&Object.keys(o).length))try{OBJ.iterate(o,function(e){var t;(t=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString)).data=o[e]?STR.check(o[e]):"",AGB.Storage.local.setComplexValue(e,Components.interfaces.nsISupportsString,t)}),r=1}catch(e){r=-1}t&&t(r)},Get:function(e,t){function o(e){var t;try{if((t=AGB.Storage.local.getPrefType(e))===Components.interfaces.nsIPrefBranch.PREF_STRING)return AGB.Storage.local.getComplexValue(e,Components.interfaces.nsISupportsString).data;if(t===Components.interfaces.nsIPrefBranch.PREF_INT)return AGB.Storage.local.getIntPref(e);if(t===Components.interfaces.nsIPrefBranch.PREF_BOOL)return AGB.Storage.local.getBoolPref(e)}catch(e){}return""}var r="";OBJ.is(e)&&e.key&&t&&(OBJ.is(e.key)?(r={},OBJ.iterate(e.key,function(e){r[e]=o(e)})):r=o(e.key)),t&&t(r)},Remove:function(e){if(OBJ.is(e)&&e.key){AGB.Core.Log("Delete - storage  - "+e.key,!0);try{AGB.Storage.local.prefHasUserValue(e.key)&&AGB.Storage.local.clearUserPref(e.key)}catch(e){}}},List:function(t){var e;OBJ.is(t)&&(e=AGB.Storage.local.getChildList("",{}),OBJ.iterateArray(e,function(e){e&&(t.filter&&0!==STR.check(e).indexOf(t.filter)||AGB.Core.Log("List - storage  - "+e,!0))}),e=AGB.Storage.sync.getChildList("",{}),OBJ.iterateArray(e,function(e){e&&(t.filter&&0!==STR.check(e).indexOf(t.filter)||AGB.Core.Log("List - syncflag  - "+e,!0))}))},RemoveFilter:function(t){var e;OBJ.is(t)&&(e=AGB.Storage.local.getChildList("",{}),OBJ.iterateArray(e,function(e){if(e&&(!t.filter||0===STR.check(e).indexOf(t.filter))){AGB.Core.Log("Delete - storage  - "+e,!0);try{AGB.Storage.local.clearUserPref(e)}catch(e){}}}),e=AGB.Storage.sync.getChildList("",{}),OBJ.iterateArray(e,function(e){if(e&&(!t.filter||0===STR.check(e).indexOf(t.filter))){AGB.Core.Log("Delete - syncflag  - "+e,!0);try{AGB.Storage.sync.clearUserPref(e)}catch(e){}}}))},Sync:function(t){OBJ.is(t)&&OBJ.iterate(t.key,function(e){t.key[e]?0===AGB.Storage.sync.getPrefType(e)&&(AGB.Core.Log("AntiGame:  Sync - Set Sync flag "+e),AGB.Storage.sync.setBoolPref(e,!0)):AGB.Storage.sync.getPrefType(e)&&(AGB.Core.Log("AntiGame:  Sync - Remove flag "+e),AGB.Storage.sync.clearUserPref(e))})}},AGB.API=function(e){e.API=this.API};