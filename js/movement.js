AGO.Movement={Messages:function(e,t){AGO.dummy=e+t},Read:function(){var e;(e=document.getElementById("inhalt"))&&(e=e.querySelector(".fleetStatus"))&&AGO.Fleet.Set("Current",{fleets:DOM.getText(".fleetSlots .current",e,3),fleetsSlots:DOM.getText(".fleetSlots .all",e,3),expos:DOM.getText(".expSlots .current",e,3),exposSlots:DOM.getText(".expSlots .all",e,3)}),PAGE.routine=AGO.Fleet.Get("Current","Routine"),AGO.Fleet.Set("Current","Routine","")},Run:function(){AGO.Option.is("E10")&&!AGO.App.OgameMobile&&(AGO.Movement.enabled=!0,AGO.Movement.improve=AGO.Option.is("E11"),AGO.Movement.Show())},onKeydown:function(e){return 13!==e.keyCode||!AGO.Option.is("E14")||(5===PAGE.routine||6===PAGE.routine?AGO.Init.Messages("Planets","Action",{scroll:"down",type:AGO.Acc.type}):DOM.click('#menuTable .menubutton[href*="page=fleet1"]'),!1)},onSwipe:function(e){"right"===e&&DOM.click('#menuTable .menubutton[href*="page=fleet1"]')},Show:function(){var e,t,l,n,a,r,o,i;if(e=document.getElementById("inhalt")){for(n=0,t=e.querySelectorAll('.fleetDetails[id^="fleet"]'),i=0;i<t.length;i++)l=NMR.parseIntAbs(t[i].id),a=+t[i].getAttribute("data-arrival-time")||0,r=+t[i].getAttribute("data-mission-type")||0,o="true"===t[i].getAttribute("data-return-flight"),l&&a&&r&&(n=Math.max(l,n),AGO.Movement.expandFleet(t[i],l,r,o),AGO.Movement.addReversalTimeBox(t[i],l,r,o),(a=DOM.getAttribute(".destinationCoords",t[i],"title"))&&(l=DOM.appendSPAN(null,"ago_movement_targetName",a),DOM.after(t[i].querySelector(".mission"),l)),(l=t[i].querySelector(".absTime"))&&(a=(l.textContent||"").split(" ")[0],l.textContent=AGO.Time.convertLocal(a,"[H]:[i]:[s]")),(l=t[i].querySelector(".nextabsTime"))&&(a=(l.textContent||"").split(" ")[0],l.textContent=AGO.Time.convertLocal(a,"[H]:[i]:[s]")),2===r&&t[i].querySelector("span.fedAttack")&&DOM.setAttribute(".reversal .icon_link img",t[i],"src",HTML.urlImage("icon_return_red.png")));if(n&&(l=e.querySelector(".fleetDetails#fleet"+n))&&"true"!==l.getAttribute("data-return-flight")&&(t=l.querySelector(".originData figure.moon")?3:1,DOM.setAttribute(l,null,"ago-movement-last",t),e=e.querySelector(".fleetStatus .fleetSlots"))&&(l=DOM.appendSPAN(null,"ago_movement_recall"),t=AGO.Option.is("E13")?"":"ago_movement_recall_active",t=DOM.appendA(l,t,{click:AGO.Movement.clickRecallLast,mouseover:AGO.Movement.changeRecallLast,mouseout:AGO.Movement.changeRecallLast}),DOM.appendSPAN(t,"icon icon_recall"),DOM.appendSPAN(t,""," "+AGO.Label.get("E17")),DOM.after(e,l)),1<AGO.Time.status&&(e=document.querySelectorAll("#inhalt .reversal .tooltipHTML, #inhalt .starStreak .tooltipHTML"))&&e.length)for(l=0;l<e.length;l++)(t=(e[l].getAttribute("title")||"").split("|"))[1]&&(t[1]=AGO.Time.convertLocal(t[1].replace(/<br>/g," ").trim()),e[l].setAttribute("title",t[0]+"| "+t[1]));window.setInterval(AGO.Movement.updateReversalClock,200)}},addReversalTimeBox:function(e,t,l,n){n?DOM.setAttribute(e,null,"ago_events_reverse",1):(t=(t=DOM.getAttribute(".starStreak .origin img",e,"title")).split("|"))[1]&&(t=AGO.Time.parse(t[1].replace(/<br>/g," ").trim()))&&(t.setTime(t.getTime()+AGO.Time.timeZoneDelta),DOM.appendSPAN(e,{class:"ago_movement_reversalTime",title:t.getTime()}),AGO.Movement.updateReversalClock())},updateReversalClock:function(){var e,t,l,n;for(e=document.querySelectorAll("#inhalt .ago_movement_reversalTime"),n=0;n<e.length;n++)(t=DOM.getAttribute(e[n],null,"title",2))&&((l=new Date).setTime(2*(l.getTime()-AGO.Time.localTimeDelta)-t-AGO.Time.timeZoneDelta),DOM.updateText(e[n],null,AGO.Time.format(l)))},expandFleet:function(e,t,l,n){var a;AGO.Movement.improve&&(t=AGO.Movement.getDetails(document.getElementById("bl"+t)))&&((a=DOM.appendDIV(null,"ago_movement_details "+HTML.classMission(l))).innerHTML=t.ships+"<br/><br/>"+t.cargo,(l=e.querySelector(".starStreak .route"))&&(DOM.setStyleDisplay(l),DOM.before(l,a)),(l=DOM.getText(".mission",e,7))&&n&&(l+=e.querySelector(".nextMission")?" ("+l.charAt(0)+")":" ("+AGO.Label.get("E18")+")",DOM.setText(".mission",e,l)),0<(n=11*(Math.ceil((t.ships+t.cargo).length/50)+1)-32)&&(AGO.Styles.set("#"+e.id+".fleetDetails.detailsOpened { height: "+(74+n)+"px; }"),AGO.Styles.set("#"+e.id+".fleetDetails.detailsOpened .starStreak{ height: "+(50+n)+"px; }")))},getDetails:function(e){if(e){var t={ships:"",cargo:""},l="";e=e.getElementsByTagName("td");for(var n=0;n<e.length;n++)"2"===e[n].colSpan?(t.ships=l,l=""):("value"!==e[n].className&&""!==l&&(l+=" "),l+=e[n].innerHTML);return t.cargo=l,t.ships=STR.check(t.ships).replace(/ {2}/g,""),t.cargo=STR.check(t.cargo).replace(/ {2}/g,""),t}return null},changeRecallLast:function(e){var t;e&&e.currentTarget&&AGO.Option.is("E13")&&(t=e.currentTarget.querySelector("span:nth-child(2)"),"mouseover"===e.type?AGO.Movement.recallTimeout=window.setTimeout(function(){t&&AGO.Movement.recallTimeout&&DOM.updateClass(t.parentNode,null,"ago_movement_recall_active")},800):(window.clearTimeout(AGO.Movement.recallTimeout),DOM.updateClass(t.parentNode),AGO.Movement.recallTimeout=null))},clickRecallLast:function(e){e&&e.currentTarget&&"ago_movement_recall_active"===e.currentTarget.className&&DOM.click("#inhalt > .fleetDetails[ago-movement-last] .reversal > .icon_link")}};