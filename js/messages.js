var $;AGO.Messages={getTooltip:function(e,t){return e=AGO.Label.get(e),t=t&&AGO.Option.is("U31")?"&lt;span class=&quot;anti_shortcut&quot;&gt;"+t+"&lt;/span&gt;&nbsp;&nbsp;":"",e||t?' class="tooltip js_hideTipOnMobile" title="'+t+e+'"':""},Messages:function(e,t){"Status"===e?t&&AGO.Messages.clickTooltip(t.id,t.value,t.mode):"sendShips"===e?AGO.Messages.sendShips(t):"toggleSpiohelper"===e?AGO.Spiohelper.changeActive(t):"changeStatus"===e&&AGO.Messages.foldSpyreports("",t||"0")},Interactive:function(){AGO.Messages.enabled=!0,AGO.Messages.shrink=AGO.Option.get("M12",2),$="jQuery"in window?window.jQuery:null,AGO.Spiohelper.Run(),AGO.Messages.Content()},Content:function(e,t,a){if(AGO.Messages.shrink&&(t=(e={1:{top:3,bot:6},2:{top:2,bot:4},3:{top:1,bot:2},4:{top:0,bot:0}})[AGO.Messages.shrink].top,AGO.Styles.set("#netz .contentz #showSpyReportsNow table th.area { padding: 4px 0px;} #netz #inhalt .contentz td { padding-top: "+t+"px; padding-bottom: "+e[AGO.Messages.shrink].bot+"px; } #messagebox .spy td { padding-top: "+t+"px; padding-bottom: "+t+"px; }")),(e=document.getElementById("inhalt"))&&!STR.getParameter("naviSwitch",a)&&(a=e.querySelector("#messageContent form[name=delMsg]"))&&!a.hasAttribute("ago-status")){if(a.setAttribute("ago-status",1),a=a.querySelector("#mailz"),AGO.Spiohelper.ShowContent(),AGO.ShowmessageEspionage.ShowContent(a),1<AGO.Time.status){for(e=a.querySelectorAll("tr.entry td.date"),t=0;t<e.length;t++)e[t].setAttribute("original",e[t].textContent),e[t].textContent=AGO.Time.convertLocal(e[t].textContent);AGO.Messages.changeTimeSpyreport(a)}AGO.Option.is("M04")&&AGO.Messages.addButtons(),1<=AGO.Option.get("M30",2)&&AGO.Option.get("M30",2)<5&&AGO.Messages.foldSpyreports(null,AGO.Option.get("M30",2))}},clickTooltip:function(e,t,a){},addButtons:function(){function e(e,t,a,s,r,l){return t<87||90<t||r?(a=AGO.Label.get(a),r&&(a=a.replace("$subject","'"+r+"'")),'<input type="button" value="'+e+'" style="color: '+(l||"#660011")+';"'+AGO.Messages.getTooltip(a,s)+' name="'+t+'">'):""}var t;if(0<(t=+AGO.Global.message({role:"getProperty",property:"aktCat"})||0)&&3!==t&&1!==t&&0<$(".selectContainer").length){t=AGO.Label.get("M82").replace("$plunder",STR.formatNumber(1e3*AGO.Option.get("M36",2))).replace("$debris",STR.formatNumber(1e3*AGO.Option.get("M37",2)));var a=AGO.Label.get("M83")+" "+AGO.Option.get("M05",2)+(AGO.Option.get("M05",2)<100?" "+AGO.Label.get("L210"):"");t=(t='<table class="anti_msg_buttons" style="width: 100%; table-layout: fixed;"><tr><td style="width: 0px;"></td><td style="width: 45px;">'+e("V",81,"M81","V","","#00B000")+'</td><td style="width: 71px;">'+e("< S",82,t,"<")+e("< C",83,a,"C")+'</td><td style="width: 71px;">'+e("E",84,"M84","E","","#191970")+e("P",85,"M85","P","","#CFCBC2")+'</td><td style="width: 71px;">'+e("S",86,"M80","S",AGO.Label.get("M86"),"#FF9600")+e("R",87,"M80","R",AGO.Label.get("M87"))+'</td><td style="width: 160px;">'+e("1",88,"M80","1",AGO.Option.get("M88",6))+e("2",89,"M80","2",AGO.Option.get("M89",6))+e("3",90,"M80","3",AGO.Option.get("M90",6))+'<span style="display: inline-block; width: 15px"> </span>'+e("X",91,"M91","DEL")+'</td><td class="anti_msg_arrows" style="width: 30%;"></td><td class="anti_msg_fold" style="width: 30px; text-align: right;">')+(a=AGO.ShowmessageEspionage.count&&AGO.Option.is("M30")?'<a href="javascript:void(0);"><img src="/cdn/img/layout/fleetCloseAll.gif"></a>':"")+"</td></tr></table>",$("form[name=delMsg]").before(t).after(t),DOM.addEventsAll(".anti_msg_buttons input",null,{click:AGO.Messages.ButtonEvents}),DOM.addEventsAll(".anti_msg_fold a",null,{click:AGO.Messages.foldSpyreports}),$(".selectContainer").clone(!0).prependTo(".anti_msg_arrows:first").find("div").css("float","left")}},changeTimeCombatreport:function(e){var t,a,s,r;$(".battlereport h3 ~ div.textCenter",e).each(function(){20<(t=STR.trim($(this).html())).length&&(1<(a=t.lastIndexOf("("))&&(s=t.substring(a+1).split(")").join(""))&&s.length<20&&(r=AGO.Time.convertLocal(s,"[d].[m].[Y] [H]:[i]:[s]"),$(this).html(t.substring(0,a+1)+r+")")))})},changeTimeSpyreport:function(e){var t,a,s,r;$("table.material.spy th.area",e).each(function(){(t=STR.trim($(this).html()))&&20<t.length&&(a=t.lastIndexOf(" ",t.length-11),(s=t.substring(a+1))&&s.length<20&&(r=AGO.Time.convertLocal(s,"[m]-[d] [H]:[i]:[s]"),$(this).html(t.substring(0,a+1)+r)))})},foldSpyreports:function(e,t){t||5<(t=(+$("td.anti_msg_fold").attr("status")||0)+1)&&(t=1),$("td.anti_msg_fold").attr("status",t),$("#section2").attr("ago_display_status",t),$(".anti_msg_fold a img").attr("src","/cdn/img/layout/"+(5===t?"fleetCloseAll.gif":"fleetOpenAll.gif")),$('#messageContent tr[id^="spioDetails_"]').each(function(e){1===t||t<5&&$(this).hasClass("smallplunder")?$(this).hide():$(this).show(),e=$(".fleetdefbuildings.spy",this).eq(2).find("tr:not(:first-child)"),2===t||3===t?e.hide():e.show(),e=$(".fleetdefbuildings.spy",this).eq(3).find("tr:not(:first-child)"),2===t?e.hide():e.show()})},ButtonEvents:function(e){e&&e.target&&"button"===e.target.type&&AGO.Messages.HandleButtons(+e.target.getAttribute("name"),e.shiftKey)},onKeydown:function(e){if(AGB.Log("AGO.Messages.onKeydown "+e.keyCode,!0),!e.inputType&&!e.cached){var t=0,a=0,s=0;switch(e.keyCode){case 37:t=e.shiftKey?1:2;break;case 39:t=e.shiftKey?4:3;break;case 65:s=1;break;case 81:s=-1;break;case 86:a=81;break;case 46:a=91;break;case 60:a=82;break;case 67:a=83;break;case 69:a=84;break;case 80:a=85;break;case 83:a=86;break;case 82:a=87;break;case 49:a=88;break;case 50:a=89;break;case 51:a=90;break;case 70:return AGO.Messages.foldSpyreports(),!1}if(t&&(2===t||3===t||"SELECT"!==document.activeElement.nodeName))return AGO.Messages.HandleArrows(t);if(s)return AGO.Messages.HandleSelect(s);if(a)return AGO.Messages.HandleButtons(a,e.shiftKey)}return!0},HandleArrows:function(e){var t=document.querySelectorAll(".selectContainer a");return!(4<=t.length)||(DOM.click(t[e-1]),!1)},HandleSelect:function(e){DOM.updateProperty("#mailz .first .checker",null,"checked",1!==e,1),DOM.click("#mailz .first .checker")},HandleButtons:function(r,l){if(0===$(".anti_msg_buttons").length)return!0;AGO.Global.message({role:"hideAll"});var i=!1;$("#mailz input.checker").each(function(){this.checked&&(i=!0)});var n,o=[];return 87===r&&(n=AGO.Label.get("M87")),88===r&&(n=AGO.Option.get("M88",6)),89===r&&(n=AGO.Option.get("M89",6)),90===r&&(n=AGO.Option.get("M90",6)),n=STR.trim(n),$("#mailz tr.trigger").each(function(){var e=91===r||n&&0===STR.trim($(this).find("td.subject").text()).indexOf(n)||81===r&&$(this).hasClass("new")||82===r&&$(this).hasClass("smallplunder")||86===r&&0<$(this).find("td.subject span.espionagereport").length||84===r&&0<$(this).find("td.subject a").attr("href").indexOf("&cat=8")||85===r&&0<$(this).find("td.subject a").attr("href").indexOf("&cat=6");if(83===r||84===r){var t=STR.trim($(this).find("td.subject span[class^=combatreport_ididattack_]").text());if(t){if(t=STR.check(t.split("(")[1]).split(":"),83===r&&3===t.length&&0===NMR.parseIntFormat(t[1])){var a=NMR.parseIntFormat(t[2]),s=AGO.Option.get("M05",2);s<100?0==a%1e3&&a<=1e3*s&&(e=!0):a<=s&&(e=!0)}84===r&&1===t.length&&(e=!0)}}l&&$(this).hasClass("new")&&(e=!1),i&&!$("input.checker",this).get(0).checked&&(e=!1),e&&o.push($(this).attr("id").toString().replace(/\D/g,""))}),0<o.length&&AGO.Global.message({role:"executeAction",msgIds:o,actionMode:81===r?412:407}),!1},sendShips:function(e){e&&("start"===e.mode?(AGO.Messages.sendShipsMessage=6===e.mission?e.message:0,e="#FF4B00"):e=e.success?"#99CC00":"#D43635",AGO.Messages.sendShipsMessage&&DOM.setStyleColor('.defenseattack .anti_sim_button[rel="'+AGO.Messages.sendShipsMessage+'"]',null,e))}},AGO.Showmessage={Messages:function(e,t){AGO.dummy=e+t},Content:function(e,t,a,s,r){if($="jQuery"in window?window.jQuery:null,t=(a=e?e.querySelector(".showmessage"):null)?a.querySelector(".messagebox"):null,a&&!a.hasAttribute("ago-status")&&(a.setAttribute("ago-status",1),e=DOM.getAttribute("span.ui-dialog-title",e.parentNode,"id",3),a.setAttribute("ago_show",e),t&&e)){if(1<AGO.Time.status&&(a=t.querySelectorAll(".infohead tr:last-child td"))&&a.length)for(s=0;s<a.length;s++)a[s].setAttribute("original",a[s].textContent),a[s].textContent=AGO.Time.convertLocal(a[s].textContent);t.querySelector(".note > .battlereport")?1<AGO.Time.status&&AGO.Messages.changeTimeCombatreport(t):t.querySelector(".note > .material.spy")?(AGO.ShowmessageEspionage.ShowContent(t,e),1<AGO.Time.status&&AGO.Messages.changeTimeSpyreport(t)):t.querySelector(".note > .other.newMessage")?AGO.Showmessage.addQuoteButton(t,e):t.querySelector(".note > .tooltipHTML.player:first-child")?(AGO.Showmessage.showAlliance(t,e),AGO.Showmessage.addQuoteButton(t,e)):t.querySelector(".note > span.tooltip:first-child")&&((e=$(".textWrapper .note",t)).length&&(t=$("span.tooltip",e).attr("title"))&&$(e).append('<p style="padding: 15px;">'+t+"</p>"))}},onKeydown:function(e,t){function a(e,t){var a=(t||document).querySelectorAll('.contentPageNavi a[href*="showmessage"]');2<=a.length&&DOM.click(a[e])}if(12!==e.inputType&&!e.cached){if(37===e.keyCode)return a(0,t),!1;if(39===e.keyCode)return a(1,t),!1;if(46===e.keyCode)return DOM.click(".showMsgNavi .delete a",t),!1}return!0},addQuoteButton:function(e,t){if(0<$(".answerHeadline",e).length){var a='<li class="ago_messages_quote"><a class="dark_highlight_tablet ago_messages_quote" title="Quote this message" href="javascript:void(0);" rel="'+t+'"><span class="icon icon_recall float_left"></span><span class="text">quote</span></a></li>';$("ul.toolbar > li.delete",e).after(a),$("a.ago_messages_quote").click(AGO.Showmessage.addQuote)}},addQuote:function(){var e=$(this).attr("rel");if(e&&(e=$('body > .ui-dialog .showmessage[ago_show="'+e+'"]')).length){var t=(a=STR.trim($(".note",e).text())).indexOf(":"),a="[background color=#1C232C][list]\n[*]"+a.substring(0,t+1)+"[p]\n"+a.substring(t+1)+"\n[/list][/background]";$(".answerForm textarea",e).val(a)}},showAlliance:function(e,t){var a=$(".textWrapper, textWrapperSmall",e);0<a.length&&($(a).after('<div class="answerHeadline open">     answer        <a href="javascript:void(0);" class="openCloseForm"></a></div><div class="answerForm"><form action="index.php?page=allianceBroadcast" method="post"><input type="hidden" value="200" name="empfaenger"><div class="answerText"><textarea class="mailnew" name="text" tabindex="3"></textarea></div><div class="submit_answer"><span class="count textBeefy">(<span class="cntChars">0</span> / 2000)</span><span class="buttonbox" style="float: right;"><input type="submit" name="submitMail" value="Send" class="btn_blue float_right" tabindex="4"></span><br class="clearfloat"></div></form></div>'),$("form",e).attr("ago_show",t).submit(function(){$.post($(this).attr("action"),$(this).serialize()+"&ajax=1");var e=$(this).attr("ago_show");return $("span#ui-id-"+e).parent().find(".ui-dialog-titlebar-close").click(),!1}),$(".openCloseForm",e).click(function(e){$(".answerForm",this.parentNode.parentNode).toggle()}))}},AGO.ShowmessageEspionage={ShowContent:function(e,n){var o;AGO.ShowmessageEspionage.count=0,(AGO.Option.is("M20")||AGO.Option.is("M04")||AGO.Option.is("M14")||1===AGO.Option.get("M30",2))&&($(".material.spy",e).each(function(e){AGO.ShowmessageEspionage.count++,e=$(this).parent();var t,a=$("th.area .rank_bandit1, th.area .rank_bandit2, th.area .rank_bandit3",this).length?2:$("th.area .status_abbr_honorableTarget",this).length?1:0,s=AGO.ShowmessageEspionage.Activity(e,a),r=AGO.ShowmessageEspionage.CalculatePlunder(this,a),l=AGO.ShowmessageEspionage.CalculateDebris(e);if(n)t=$(this).parent().parent().parent().parent().attr("data-message-id");else if(t=$(this).parent().parent().parent().attr("id")){var i="tr#TR"+t.replace(/spioDetails_/,"");r.enough||l.enough||$(i+", tr#"+t).addClass("smallplunder"),AGO.Option.is("M20")&&AGO.ShowmessageEspionage.ShowTitle(i,r,l,s)}o=NMR.parseIntAbs(t),AGO.Option.is("M20")&&(AGO.ShowmessageEspionage.ShowDebris(this,l),AGO.ShowmessageEspionage.ShowPlunder(this,r,a)),AGO.ShowmessageEspionage.SimulatorButtons(e.get(0),o)}),DOM.addEventsAll(".anti_send_ships",null,{click:AGO.ShowmessageEspionage.SendShips}),AGO.ShowmessageEspionage.count?AGO.Option.set("Reports",0):document.querySelectorAll('#messageContent #mailz a.overlay[href*="cat=7"]').length&&AGO.Option.set("Reports",1)),AGO.Option.is("M16")&&$(".defenseattack.spy .attack a",e).attr("target","ago_fleet_attacks")},SendShips:function(e){if(e&&e.target&&e.target.name){var t=e.target.parentNode.parentNode.parentNode.parentNode.parentNode;if(t&&(t=t.querySelector("a.btn_blue[href]"))){var a=t.href,s=STR.check(t.href).split("&mission=1");s.length&&("am209"===e.target.name?(s=(s=(s=s[0]+"&mission=8"+STR.check(s[1])).split("&type="))[0]+"&type=2"+s[1].substring(1),s+="&routine=4"):s=STR.check(t.href)+"&routine=3",t.href=s+"&"+STR.check(e.target.name)+"="+NMR.parseIntAbs(e.target.innerHTML),DOM.click(t),t.href=a)}}},ShowTitle:function(e,t,a,s){t='<span class="anti_spy_info" style="color: '+(t.enough?"#FF9600":"#848484")+';" title="'+AGO.Label.get("M24")+'">'+STR.shortNumber(t.total,0)+' </span><span class="anti_spy_info" style="color: '+(a.enough?"#00B000":"#848484")+';" title="'+AGO.Label.get("M22")+'">'+STR.shortNumber(a.total,0)+' </span>&nbsp;&nbsp;&nbsp;<span style="color: red;" title="'+s.title+'">'+(s.time||"  ")+" </span>",$(e).find("td.from").html(t)},CalculatePlunder:function(e,t){if(5<=(a=$(".fragment td",e)).length){var a,s=2===t?1:1===t?.75:.5,r=Math.floor(NMR.parseIntAbs(a.eq(1).text())*s),l=Math.floor(NMR.parseIntAbs(a.eq(3).text())*s),i=r+l+(a=Math.floor(NMR.parseIntAbs(a.eq(5).text())*s));return{metal:r,crystal:l,deuterium:a,total:i,ratio:s,enough:0<i&&i>=1e3*AGO.Option.get("M36",2)}}return{metal:0,crystal:0,deuterium:0,total:0,ratio:0,enough:!1}},CalculateDebris:function(e){var t,a={};return $(".fleetdefbuildings.spy:lt("+(AGO.Uni.defToTF?2:1)+") td.key",e).each(function(e){(t=AGO.Item.getByName(STR.trim(this.textContent)))&&(a[t]=NMR.parseIntAbs($(this).next().text()))}),AGO.Ogame.getDebris(a,!0)},Activity:function(e,t){var a=$(".aktiv.spy .area",e).text()||"",s=$('.aktiv.spy font[color="red"]',e).text()||"",r='<span style="float: left; color: '+(s?"#FF0000":"#848484")+';" title="'+a+'">&nbsp;&nbsp;'+(s||"--")+" </span>",l=$(".material.spy .area",e).attr("plunder_status",t);return 0<l.length&&l.html(r+l.html()),AGO.Option.is("M14")&&$(".aktiv.spy",e).hide(),{title:a,time:s}},ShowPlunder:function(e,t,a){if(t.enough){var s=0;a="";for(var r=AGO.Option.get("FA3",2);;){s++;var l=Math.max(t.total,Math.min(.75*(2*t.metal+t.crystal+t.deuterium),2*t.metal+t.deuterium)),i=(l=r?l*(1+r/100):l,"203"),n="202",o=25e3,p=5e3;if(AGO.Option.is("FA2")&&(i="202",n="203",o=5e3,p=25e3),a+='<tr><td class="key">'+AGO.Label.get("M24")+" "+(1<s?s:"")+'</td><td class="value"><span style="color: #FF9600;" title="'+AGO.Label.get("L091")+": "+STR.formatNumber(t.metal)+" - "+AGO.Label.get("L092")+": "+STR.formatNumber(t.crystal)+" - "+AGO.Label.get("L093")+": "+STR.formatNumber(t.deuterium)+'">'+STR.formatNumber(t.total)+'</span></td><td class="key">'+AGO.Label.get("K"+n)+(r?" (+"+r+"%)":"")+'</td><td class="value"><a class="anti_send_ships" href="javascript:void(0)" name="am'+n+'">'+STR.formatNumber(Math.ceil(l/p))+'</a></td><td class="key">'+AGO.Label.get("K"+i)+(r?" (+"+r+"%)":"")+'</td><td class="value"><a class="anti_send_ships" href="javascript:void(0)" name="am'+i+'">'+STR.formatNumber(Math.ceil(l/o))+"</a></td>",l=1-t.ratio,t.metal=Math.floor(t.metal*l),t.crystal=Math.floor(t.crystal*l),t.deuterium=Math.floor(t.deuterium*l),t.total=t.metal+t.crystal+t.deuterium,t.enough=0<t.total&&t.total>=1e3*AGO.Option.get("M36",2),!t.enough||s>=AGO.Option.get("M28",2))break}t='<tr><th colspan="6" class="area">'+AGO.Label.get("M24")+" - "+Math.floor(100*t.ratio)+" %</th></tr>",$(e).after('<table class="anti_spy">'+t+a+"</table>")}},ShowDebris:function(e,t){if(t.enough){var a='<tr><th colspan="6" class="area">'+AGO.Label.get("M22")+'</th></tr><tr><td class="key">'+AGO.Label.get("L091")+'</td><td class="value" style="color: #00B000;">'+STR.formatNumber(t.metal)+'</td><td class="key">'+AGO.Label.get("L092")+'</td><td class="value" style="color: #00B000;">'+STR.formatNumber(t.crystal)+'</td><td class="key">'+AGO.Label.get("K209")+'</td><td class="value"><a class="anti_send_ships" href="javascript:void(0)" name="am209">'+STR.formatNumber(Math.ceil(t.total/2e4))+"</a></td></tr>";$(e).after('<table class="anti_spy">'+a+"</table>")}},SimulatorButtons:function(e,t){function a(e,t,a){return 9===e||AGO.Option.is(t)?'<td class="attack"><a class="btn_blue anti_sim_button" name="'+e+'" rel="'+a+'">'+AGO.Label.get(t)+"</a></td>":""}var s=1===(+(($(".defenseattack.spy a.btn_blue",e).eq(0).attr("href")||"").split("&type=")[1]||"").split("&")[0]||0)||AGO.Option.is("commander")?a(9,"LM06",t):"";AGO.Option.is("T00")&&(s+=a(3,"T5A",t)+a(1,"T5B",t)+a(2,"T5C",t)),$(".defenseattack.spy .attack",e).attr("colspan","1").after(s);s=e.querySelectorAll(".anti_sim_button");for(var r=0;r<s.length;r++)DOM.set(s[r],null,null,null,{click:AGO.ShowmessageEspionage.clickButton})},clickButton:function(e){var t,a,s,r,l;e&&(e.preventDefault(),e.target&&e.target.name&&(a=["","T5B","T5C","T5A"][t=+e.target.name||0],r=+((s=e.target.parentNode.parentNode.parentNode.parentNode.parentNode).innerHTML.split('plunder_status="')[1]||"").charAt(0)||0,l=e.target.getAttribute("rel"),a?AGO.ShowmessageEspionage.sendSimulate(a,s,r,e.shiftKey||e.ctrlKey):9===t&&AGO.ShowmessageEspionage.sendEspionage(t,s,l)))},sendEspionage:function(e,t,a){e=($('.material.spy .area a[target="_parent"]',t).text()||"").replace(/[^\d:]/g,"").split(":");var s={type:t=+(($(".defenseattack.spy a.btn_blue",t).eq(0).attr("href")||"").split("&type=")[1]||"").split("&")[0]||0,mission:6,role:"sendShips"};s.galaxy=+e[0]||0,s.system=+e[1]||0,s.position=+e[2]||0,s.message=a||0,AGO.Task.checkCoords(s.galaxy,s.system,s.position)&&(1===t||AGO.Option.is("commander"))&&AGO.Global.message(s)},sendSimulate:function(e,t,a,s){var r,l,i,n,o;r={},5<=(l=$(".material.spy .fragment td",t)).length&&(r.metal=NMR.parseIntAbs(l.eq(1).text()),r.crystal=NMR.parseIntAbs(l.eq(3).text()),r.deuterium=NMR.parseIntAbs(l.eq(5).text())),l=$(".material.spy .area",t).html()||"",i=$('.material.spy .area span[class*="status_abbr"]',t),r.coords=($('.material.spy .area a[target="_parent"]',t).text()||"").replace(/[^\d:]/g,""),r.type=$(".material.spy .area figure",t).hasClass("moon")?3:1,r.name=(l.split("</figure>")[1]||"").split("<a")[0].split("<span")[0].trim(),r.detail=i.text(),r.status=i.attr("class").split("us_abbr_")[1],r.time=($(".material.spy .area",t).text()||"").split((i.text()||"")+")")[1],r.plunder=2===a?100:1===a?75:50,$(".fleetdefbuildings.spy:nth(3) td.key",t).each(function(e){r.timeResearch=1,"109"!==(n=AGO.Item.getByName(STR.trim($(this).text())))&&"110"!==n&&"111"!==n||(r[n]=NMR.parseIntAbs($(this).next().text()))}),$(".fleetdefbuildings.spy:lt(2) td.key",t).each(function(e){n=AGO.Item.getByName(STR.trim($(this).text())),o=NMR.parseIntAbs($(this).next().text()),n&&o&&(r[n]=o)}),AGO.Tools.Action({id:e,shiftKeys:s,Task:r})}},AGO.Spiohelper={Save:function(){AGO.Data.setStorage(AGO.App.keyPlayer+"_Messages_Espionage",AGO.Spiohelper.data)},changeActive:function(e){e&&!AGO.Spiohelper.status&&(AGO.Spiohelper.Run(),AGO.Spiohelper.ShowContent()),AGO.Spiohelper.changeDisplay(e||!1)},changeDisplay:function(e){var t;(t=document.getElementById("spioHelper"))&&(t=$("table",t),e=e&&e.target?!t.is(":visible"):e,AGO.Option.set("M52",e,1),e?t.show():t.hide())},Run:function(){var a;AGO.Option.is("M51")&&(AGO.Spiohelper.status=5,AGO.Spiohelper.DATA={UNI:$("meta[name=ogame-universe]").attr("content"),T1:"sort",T2:"summary of espionage reports",T3:"coordinates",T4:"age",T5:"player (<span style='color:#99CC00;font-weight:normal;'>activity</span>)",T6:"loot",T7:"DF",T8:"DEF",T9:"jump to spy report",T10:"max. $1 "+$.trim($("div#countColonies .textCenter").text()).split(" ")[1],T11:$('ul#menuTable a.menubutton[href$="page=galaxy"] .textlabel').text()+": show position $1",T12:"count",T13:"no data",T14:"actions",T15:"check/uncheck all",T16:"invested resources",T17:"points",T18:"check/uncheck report",T20:"add",T21:"save",T22:$('ul#menuTable a.menubutton[href$="page=fleet1"] .textlabel').text(),T23:$('ul#menuTable a.menubutton[href$="page=defense"] .textlabel').text(),T28:"minimize/maximize table"},AGO.Spiohelper.data=AGO.Data.getStorage(AGO.App.keyPlayer+"_Messages_Espionage","JSON"),(void 0===AGO.Spiohelper.data.SORT||$.isEmptyObject(AGO.Spiohelper.data.SORT))&&(AGO.Spiohelper.data.SORT={REL:"age",INVERSE:!1},AGO.Spiohelper.Save()),AGO.Spiohelper.BEVORZUGT=AGO.Option.is("FA2")?["A202","A203"]:["A203","A202"],void 0!==AGO.Spiohelper.data.CHECKED&&$.isArray(AGO.Spiohelper.data.CHECKED)||(AGO.Spiohelper.data.CHECKED=[],AGO.Spiohelper.Save()),AGO.Spiohelper.DFPERCENT=AGO.Uni.debrisFactor||.3,AGO.Spiohelper.TECH={A109:[AGO.Label.get("L109")],A110:[AGO.Label.get("L110")],A111:[AGO.Label.get("L111")],A115:[AGO.Label.get("L115")],A117:[AGO.Label.get("L117")],A118:[AGO.Label.get("L118")],A124:[AGO.Label.get("L124")],A202:[AGO.Label.get("L202"),2e3,2e3,0,"f",5e3],A203:[AGO.Label.get("L203"),6e3,6e3,0,"f",25e3],A204:[AGO.Label.get("L204"),3e3,1e3,0,"f",50],A205:[AGO.Label.get("L205"),6e3,4e3,0,"f",100],A206:[AGO.Label.get("L206"),2e4,7e3,2e3,"f",800],A207:[AGO.Label.get("L207"),45e3,15e3,0,"f",1500],A208:[AGO.Label.get("L208"),1e4,2e4,1e4,"f",7500],A209:[AGO.Label.get("L209"),1e4,6e3,2e3,"f",2e4],A210:[AGO.Label.get("L210"),0,1e3,0,"f"],A211:[AGO.Label.get("L211"),5e4,25e3,15e3,"f",500],A212:[AGO.Label.get("L212"),0,2e3,500,"f"],A213:[AGO.Label.get("L213"),6e4,5e4,15e3,"f",2e3],A214:[AGO.Label.get("L214"),5e6,4e6,1e6,"f",1e6],A215:[AGO.Label.get("L215"),3e4,4e4,15e3,"f",750],A502:[AGO.Label.get("L502")],A503:[AGO.Label.get("L503")],A401:[AGO.Label.get("L401"),2e3,0,0,"d",20],A402:[AGO.Label.get("L402"),1500,500,0,"d",20],A403:[AGO.Label.get("L403"),6e3,2e3,0,"d",80],A404:[AGO.Label.get("L404"),2e4,15e3,2e3,"d",350],A405:[AGO.Label.get("L405"),2e3,6e3,0,"d",80],A406:[AGO.Label.get("L406"),5e4,5e4,3e4,"d",1e3],A407:[AGO.Label.get("L407"),1e4,1e4,0,"d",200],A408:[AGO.Label.get("L408"),5e4,5e4,0,"d",1e3]},$.fn.sortElements=(a=[].sort,function(e,s){s=s||function(){return this};var t=this.map(function(){var e=s.call(this),t=e.parentNode,a=t.insertBefore(document.createTextNode(""),e.nextSibling);return function(){if(t===this)throw Error("You can't sort elements if any one is a descendant of another.");t.insertBefore(this,a),t.removeChild(a)}});return a.call(this,e).each(function(e){t[e].call(s.call(this))})}))},ShowContent:function(){var e,t;if(5<=AGO.Spiohelper.status)if(AGO.Spiohelper.data.LOOT={m:0,k:0,d:0,s:0},AGO.Spiohelper.data.DF={m:0,k:0,s:0},0<(e=$('tr[id^="spioDetails_"]')).size()){var a=[];e.each(function(){var e=AGO.Spiohelper.parseBericht($(this));null!==e&&a.push(e)});var s=AGO.Spiohelper.ausgabe(a);if($("input#checkAll.checker").click(function(){$(this).is(":checked")?(s.find("th.checkAll").addClass("checked"),s.find("td.checkSingle").addClass("checked"),AGO.Spiohelper.addAllCheck(s)):(s.find("th.checkAll").removeClass("checked"),s.find("td.checkSingle").removeClass("checked"),AGO.Spiohelper.removeAllCheck(s))}),s.find("th.checkAll").addClass("sh_pointer").click(function(){$(this).hasClass("checked")?(DOM.updatePropertyAll('input[type="checkbox"].checker',null,"checked",!1,1),s.find("th.checkAll").removeClass("checked"),s.find("td.checkSingle").removeClass("checked"),AGO.Spiohelper.removeAllCheck(s)):(DOM.updatePropertyAll('input[type="checkbox"].checker',null,"checked",!0,1),s.find("th.checkAll").addClass("checked"),s.find("td.checkSingle").addClass("checked"),AGO.Spiohelper.addAllCheck(s))}),$('input[type="checkbox"].checker').not(":first").click(function(){var e=$(this).attr("id");$(this).is(":checked")?(s.find("td."+e).addClass("checked"),AGO.Spiohelper.addCheck(e)):(s.find("td."+e).removeClass("checked"),AGO.Spiohelper.removeCheck(e))}),s.find("td.checkSingle").addClass("sh_pointer").click(function(){var e=/([0-9]+)/.exec($(this).attr("class"))[1];$(this).hasClass("checked")?(DOM.updateProperty('input.checker[id="'+e+'"]',null,"checked",!1,1),$(this).removeClass("checked"),AGO.Spiohelper.removeCheck(e)):(DOM.updateProperty('input.checker[id="'+e+'"]',null,"checked",!0,1),$(this).addClass("checked"),AGO.Spiohelper.addCheck(e))}),$("a.attackIconButton").click(function(){var e=$(this).closest("tr").find("td.checkSingle");if(!e.hasClass("checked")){var t=/([0-9]+)/.exec(e.attr("class"))[1];DOM.updateProperty('input.checker[id="'+t+'"]',null,"checked",!0,1),e.addClass("checked"),AGO.Spiohelper.addCheck(t)}}),0<AGO.Spiohelper.data.CHECKED.length){for(e=0;e<AGO.Spiohelper.data.CHECKED.length;e++){t=AGO.Spiohelper.data.CHECKED[e];var r=$("input#"+t+".checker"),l=s.find("td."+t);0<r.length&&0<l.length?(DOM.updateProperty('input.checker[id="'+t+'"]',null,"checked",!0,1),s.find("td."+t).addClass("checked")):AGO.Spiohelper.removeCheck(t)}AGO.Spiohelper.data.CHECKED.length===a.length&&(DOM.updateProperty("input#checkAll.checker",null,"checked",!0,1),s.find("th.checkAll").addClass("checked"))}var i=AGO.Spiohelper.data.SORT.INVERSE;s.show().find("table th").not('[rel="check"]').not('[rel="actions"]').addClass("sh_pointer").click(function(){s.find("table tr").not(":first").removeClass("even");var e=$(this),t=e.index(),a=e.attr("rel");e.closest("table").find("td").filter(function(){return $(this).index()===t}).sortElements(function(e,t){return $(e).text()===AGO.Spiohelper.DATA.T13?e=-1:(e=$("span",e).attr("data-value")||$(e).text(),e=AGO.Spiohelper.prepareForSorting(a,e)),$(t).text()===AGO.Spiohelper.DATA.T13?t=-1:(t=$("span",t).attr("data-value")||$(t).text(),t=AGO.Spiohelper.prepareForSorting(a,t)),(isNaN(e)||isNaN(t)?t<e:+t<+e)?i?-1:1:i?1:-1},function(){return this.parentNode}),s.find("table tr").not(":first").filter(":even").addClass("even"),AGO.Spiohelper.data.SORT.REL=a,AGO.Spiohelper.data.SORT.INVERSE=i,AGO.Spiohelper.Save(),i=!i}),s.find("table tr").first().find('[rel="'+AGO.Spiohelper.data.SORT.REL+'"]').click(),s.find("a.sh_arrow_minmax").click(AGO.Spiohelper.changeDisplay)}else if(e=$("#tab-msg li#1").hasClass("aktiv"),t=$("#section2 .mailWrapper a#7"),e&&(0<t.length&&t.hasClass("active")||0===t.length)){if(0<AGO.Spiohelper.data.CHECKED.length)for(e=0;e<AGO.Spiohelper.data.CHECKED.length;e++)t=AGO.Spiohelper.data.CHECKED[e],0===(r=$("input#"+t+".checker")).length&&AGO.Spiohelper.removeCheck(t);AGO.Spiohelper.data.SORT.REL="age",AGO.Spiohelper.data.SORT.INVERSE=!1,AGO.Spiohelper.Save()}},parseBericht:function(e){try{var s={ID:e.attr("id").replace(/spioDetails_/,""),R1:NMR.parseIntFormat(e.find("table.material table td:eq(1)").html()),R2:NMR.parseIntFormat(e.find("table.material table td:eq(3)").html()),R3:NMR.parseIntFormat(e.find("table.material table td:eq(5)").html()),R4:NMR.parseIntFormat(e.find("table.material table td:eq(7)").html()),FDB:e.find("table.fleetdefbuildings").length};s.ACTIONS=$("tr#TR"+s.ID+".entry td.actions a");var t=/\[(\d+:\d+:\d+)\][^\(]*\([^\(\s]+\s+[\']*([^\']+)[\']*\)/.exec(e.find("table.material tr:eq(0) th").html());s.COORDS=t[1],s.SPIELER=t[2],s.SPIELERNAME=(e.find('.material.spy .area span[class*="status_abbr"]').text()||"").trim(),t=/([0-9]+):([0-9]+):([0-9]+)/.exec(s.COORDS),s.GALAXY="http://"+AGO.Spiohelper.DATA.UNI+"/game/index.php?page=galaxy&galaxy="+t[1]+"&system="+t[2]+"&planet="+t[3];var a=e.prev().find("td.date").html();s.DATE=AGO.Time.convertLocal(a),s.AGE=AGO.Time.ogameTime-AGO.Time.parse(a).getTime(),s.FACTOR=$("th.area .rank_bandit1, th.area .rank_bandit2, th.area .rank_bandit3",e).length?1:$("th.area .status_abbr_honorableTarget",e).length?.75:.5,s.ACTIVITY=e.find("table.aktiv font").html(),s.ACTIVITY=s.ACTIVITY?' (<span style="color:#99CC00;">'+s.ACTIVITY+"</span>)":"",t=e.find("table.defenseattack tr:eq(1) td.attack a"),s.ATTACK=t.attr("href"),s.ATTACKTITLE=t.html(),s.MOON=!1,-1!==s.ATTACK.indexOf("&type=3&")&&(s.MOON=!0),s.LOOT={m:Math.round(s.R1*s.FACTOR),k:Math.round(s.R2*s.FACTOR),d:Math.round(s.R3*s.FACTOR),s:0},s.LOOT.s=s.LOOT.m+s.LOOT.k+s.LOOT.d,AGO.Spiohelper.data.LOOT.m+=s.LOOT.m,AGO.Spiohelper.data.LOOT.k+=s.LOOT.k,AGO.Spiohelper.data.LOOT.d+=s.LOOT.d,AGO.Spiohelper.data.LOOT.s+=s.LOOT.s;var r=s.FACTOR*Math.max(s.R1+s.R2+s.R3,Math.min(.75*(2*s.R1+s.R2+s.R3),2*s.R1+s.R3)),l=(l=AGO.Option.get("FA3",2))?1+l/100:1;for(s.SHIPS=[],s.EXTRASHIPS=[],t=0;t<AGO.Spiohelper.BEVORZUGT.length;t++){var i=Math.ceil(r/AGO.Spiohelper.TECH[AGO.Spiohelper.BEVORZUGT[t]][5]),n=Math.ceil(r*l/AGO.Spiohelper.TECH[AGO.Spiohelper.BEVORZUGT[t]][5]);s.SHIPS.push(i),s.EXTRASHIPS.push(n-i)}s.FLEET={m:0,k:0,d:0,s:0,p:0},s.DEFENCE={m:0,k:0,d:0,s:0,p:0},s.DEF=0,s.FLEETLIST=[],s.DEFENCELIST=[],e.find("table.fleetdefbuildings td.key").each(function(){var e,t=$.trim($(this).text()),a=NMR.parseIntAbs($(this).next().text());for(e in AGO.Spiohelper.TECH)AGO.Spiohelper.TECH[e][0]==t&&(s[e]=[],s[e].push(a),1<AGO.Spiohelper.TECH[e].length&&(s[e].push(a*AGO.Spiohelper.TECH[e][1]),s[e].push(a*AGO.Spiohelper.TECH[e][2]),s[e].push(a*AGO.Spiohelper.TECH[e][3]),"f"===AGO.Spiohelper.TECH[e][4]?(s.FLEET.m+=a*AGO.Spiohelper.TECH[e][1],s.FLEET.k+=a*AGO.Spiohelper.TECH[e][2],s.FLEET.d+=a*AGO.Spiohelper.TECH[e][3],s.FLEETLIST.push([AGO.Spiohelper.TECH[e][0],a])):"d"===AGO.Spiohelper.TECH[e][4]&&(s.DEFENCE.m+=a*AGO.Spiohelper.TECH[e][1],s.DEFENCE.k+=a*AGO.Spiohelper.TECH[e][2],s.DEFENCE.d+=a*AGO.Spiohelper.TECH[e][3],s.DEF+=a*AGO.Spiohelper.TECH[e][5],s.DEFENCELIST.push([AGO.Spiohelper.TECH[e][0],a]))))}),s.FLEET.s=s.FLEET.m+s.FLEET.k+s.FLEET.d,s.FLEET.p=Math.floor(s.FLEET.s/1e3),s.DEFENCE.s=s.DEFENCE.m+s.DEFENCE.k+s.DEFENCE.d,s.DEFENCE.p=Math.floor(s.DEFENCE.s/1e3),s.DEBRISFIELD={m:Math.round(s.FLEET.m*AGO.Spiohelper.DFPERCENT),k:Math.round(s.FLEET.k*AGO.Spiohelper.DFPERCENT),s:0},s.DEBRISFIELD.s=s.DEBRISFIELD.m+s.DEBRISFIELD.k,AGO.Spiohelper.data.DF.m+=s.DEBRISFIELD.m,AGO.Spiohelper.data.DF.k+=s.DEBRISFIELD.k,AGO.Spiohelper.data.DF.s+=s.DEBRISFIELD.s,s.RECS=Math.ceil(s.DEBRISFIELD.s/2e4);var o=s.SHIPS[0];return AGO.Option.is("FA3")&&(o+=s.EXTRASHIPS[0]),s.ATTACK+="&routine=3&am"+NMR.parseIntAbs(AGO.Spiohelper.BEVORZUGT[0])+"="+o,s}catch(e){return null}},ausgabe:function(e){var t,a=$("<div/>").attr("id","spioHelper").hide();$("#messageContent").prepend(a);var s=$("<table/>").attr("cellspacing","0").attr("cellpadding","0").hide().appendTo(a);AGO.Option.is("M52")&&s.show();var r=$("<tr/>").addClass("header").appendTo(s);$("<th/>").width(18).attr("rel","check").attr("title",AGO.Spiohelper.DATA.T15).addClass("checkAll").addClass("tooltip").appendTo(r),$("<th/>").attr("rel","coords").text(AGO.Spiohelper.DATA.T3).attr("title",AGO.Spiohelper.DATA.T1).addClass("tooltip").appendTo(r),$("<th/>").attr("rel","age").text(AGO.Spiohelper.DATA.T4).attr("title",AGO.Spiohelper.DATA.T1).addClass("tooltip").appendTo(r),$("<th/>").attr("rel","player").html(AGO.Spiohelper.DATA.T5).attr("title",AGO.Spiohelper.DATA.T1).addClass("tooltip").appendTo(r),$("<th/>").attr("rel","loot").text(AGO.Spiohelper.DATA.T6).attr("title",AGO.Spiohelper.DATA.T1).addClass("tooltip").appendTo(r),$("<th/>").attr("rel","df").text(AGO.Spiohelper.DATA.T7).attr("title",AGO.Spiohelper.DATA.T1).addClass("tooltip").appendTo(r),$("<th/>").attr("rel","def").text(AGO.Spiohelper.DATA.T8).attr("title",AGO.Spiohelper.DATA.T1).addClass("tooltip").appendTo(r),$("<th/>").width(84).attr("rel","actions").text(AGO.Spiohelper.DATA.T14).appendTo(r);for(var l=0;l<e.length;l++){var i=e[l],n=$("<tr/>").addClass("row").appendTo(s);0==l%2&&n.addClass("even"),t=$("<td/>").addClass(i.ID).addClass("checkSingle").appendTo(n),$("<div/>").css({width:"16px",height:"16px"}).attr("title",AGO.Spiohelper.DATA.T18).addClass("tooltip").appendTo(t),t=$("<td/>").addClass("sh_textCenter").appendTo(n),t=$("<a/>").css("display","block").attr("href","#TR"+i.ID).attr("title",AGO.Spiohelper.DATA.T9).text(i.COORDS).addClass("tooltip").appendTo(t),i.MOON&&$("<img/>").attr("src","http://"+AGO.Spiohelper.DATA.UNI+"/cdn/img/galaxy/moon_a.gif").addClass("moon").appendTo(t),t=$("<td/>").appendTo(n),$("<span/>").text(AGO.Time.formatTime(i.AGE/1e3,!0)).attr("title",i.DATE).attr("data-value",i.AGE).addClass("tooltipRight").appendTo(t);var o=$("<td/>").appendTo(n);t=AGO.Spiohelper.DATA.T13,i.A124&&(t=AGO.Spiohelper.DATA.T10.replace(/\$1/,1+Math.ceil(NMR.parseInt(i.A124[0])/2)));var p="javascript:AGO_Data('"+i.SPIELERNAME+"',1,2);";$("<a/>").html(i.SPIELER+i.ACTIVITY).attr("title",t).attr("href",p).addClass("tooltipRight").appendTo(o),o=$("<td/>").addClass("sh_textRight").appendTo(n),p=AGO.Option.is("M53")?STR.shortNumber(i.LOOT.s,1):STR.formatNumber(i.LOOT.s),t='|<table cellspacing="0" cellpadding="10" style="border:0;">';for(var d=0;d<AGO.Spiohelper.BEVORZUGT.length;d++){var h=STR.formatNumber(i.SHIPS[d]);AGO.Option.is("FA3")&&(h+=" (+ "+i.EXTRASHIPS[d]+")"),t+='<tr><td style="padding-right:10px;">'+AGO.Spiohelper.TECH[AGO.Spiohelper.BEVORZUGT[d]][0]+': </td><td class="sh_textRight">'+h+"</td></tr>"}if(t+='<tr><td colspan="2" style="height:5px;"></td></tr>',t+='<tr><td style="padding-right:10px;">'+AGO.Spiohelper.DATA.T6+': </td><td class="sh_textRight" style="color:#99CC00;">'+100*i.FACTOR+"%</td></tr>",t+='<tr><td style="padding-right:10px;">'+AGO.Label.get("L091")+': </td><td class="sh_textRight">'+STR.formatNumber(i.LOOT.m)+"</td></tr>",t+='<tr><td style="padding-right:10px;">'+AGO.Label.get("L092")+': </td><td class="sh_textRight">'+STR.formatNumber(i.LOOT.k)+"</td></tr>",t+='<tr><td style="padding-right:10px;">'+AGO.Label.get("L093")+': </td><td class="sh_textRight">'+STR.formatNumber(i.LOOT.d)+"</td></tr>",t+="</table>",0===i.LOOT.s&&(t=""),$("<span/>").html(p).attr("title",t).attr("data-value",i.LOOT.s).addClass("tooltipHTML").appendTo(o),o=$("<td/>").addClass("sh_textRight").appendTo(n),p=AGO.Option.is("M53")?STR.shortNumber(i.DEBRISFIELD.s,1):STR.formatNumber(i.DEBRISFIELD.s),t='|<table cellspacing="0" cellpadding="10" style="border:0;">',t+='<tr><td style="padding-right:10px;">'+AGO.Spiohelper.TECH.A209[0]+': </td><td class="sh_textRight">'+STR.formatNumber(i.RECS)+"</td></tr>",t+='<tr><td colspan="2" style="height:5px;"></td></tr>',t+='<tr><td style="padding-right:10px;">'+AGO.Label.get("L091")+': </td><td class="sh_textRight">'+STR.formatNumber(i.DEBRISFIELD.m)+"</td></tr>",t+='<tr><td style="padding-right:10px;">'+AGO.Label.get("L092")+': </td><td class="sh_textRight">'+STR.formatNumber(i.DEBRISFIELD.k)+"</td></tr>",t+='<tr><td colspan="2" style="height:15px;"></td></tr>',t+='<tr><td colspan="2" style="color:#6F9FC8;font-weight:bold;font-size:11px;">'+AGO.Spiohelper.DATA.T16+"</td></tr>",t+='<tr><td colspan="2"><div class="splitLine" style="min-height:1px;" /></td></tr>',t+='<tr><td style="padding-right:10px;">'+AGO.Label.get("L091")+': </td><td class="sh_textRight">'+STR.formatNumber(i.FLEET.m)+"</td></tr>",t+='<tr><td style="padding-right:10px;">'+AGO.Label.get("L092")+': </td><td class="sh_textRight">'+STR.formatNumber(i.FLEET.k)+"</td></tr>",t+='<tr><td style="padding-right:10px;">'+AGO.Label.get("L093")+': </td><td class="sh_textRight">'+STR.formatNumber(i.FLEET.d)+"</td></tr>",t+='<tr><td style="padding-right:10px;">'+AGO.Spiohelper.DATA.T17+': </td><td class="sh_textRight" style="color:#99CC00;">'+STR.formatNumber(i.FLEET.p)+"</td></tr>",0<i.FLEETLIST.length)for(t+='<tr><td colspan="2" style="height:15px;"></td></tr>',t+='<tr><td colspan="2" style="color:#6F9FC8;font-weight:bold;font-size:11px;">'+AGO.Spiohelper.DATA.T22+"</td></tr>",t+='<tr><td colspan="2"><div class="splitLine" style="min-height:1px;" /></td></tr>',d=0;d<i.FLEETLIST.length;d++)t+='<tr><td style="padding-right:10px;">'+(h=i.FLEETLIST[d])[0]+': </td><td class="sh_textRight">'+STR.formatNumber(h[1])+"</td></tr>";if(t+="</table>",0===i.DEBRISFIELD.s&&(t=""),i.FDB<1&&(p=AGO.Spiohelper.DATA.T13),$("<span/>").html(p).attr("title",t).attr("data-value",i.DEBRISFIELD.s).addClass("tooltipHTML").appendTo(o),o=$("<td/>").addClass("sh_textRight").appendTo(n),p=AGO.Option.is("M53")?STR.shortNumber(i.DEF,1):STR.formatNumber(i.DEF),t='|<table cellspacing="0" cellpadding="10" style="border:0;">',t+='<tr><td colspan="2" style="color:#6F9FC8;font-weight:bold;font-size:11px;">'+AGO.Spiohelper.DATA.T16+"</td></tr>",t+='<tr><td colspan="2"><div class="splitLine" style="min-height:1px;" /></td></tr>',t+='<tr><td style="padding-right:10px;">'+AGO.Label.get("L091")+': </td><td class="sh_textRight">'+STR.formatNumber(i.DEFENCE.m)+"</td></tr>",t+='<tr><td style="padding-right:10px;">'+AGO.Label.get("L092")+': </td><td class="sh_textRight">'+STR.formatNumber(i.DEFENCE.k)+"</td></tr>",t+='<tr><td style="padding-right:10px;">'+AGO.Label.get("L093")+': </td><td class="sh_textRight">'+STR.formatNumber(i.DEFENCE.d)+"</td></tr>",t+='<tr><td style="padding-right:10px;">'+AGO.Spiohelper.DATA.T17+': </td><td class="sh_textRight" style="color:#99CC00;">'+STR.formatNumber(i.DEFENCE.p)+"</td></tr>",0<i.DEFENCELIST.length)for(t+='<tr><td colspan="2" style="height:15px;"></td></tr>',t+='<tr><td colspan="2" style="color:#6F9FC8;font-weight:bold;font-size:11px;">'+AGO.Spiohelper.DATA.T23+"</td></tr>",t+='<tr><td colspan="2"><div class="splitLine" style="min-height:1px;" /></td></tr>',d=0;d<i.DEFENCELIST.length;d++)t+='<tr><td style="padding-right:10px;">'+(h=i.DEFENCELIST[d])[0]+': </td><td class="sh_textRight">'+STR.formatNumber(h[1])+"</td></tr>";t+="</table>",0===i.DEFENCE.s&&(t=""),i.FDB<2&&(p=AGO.Spiohelper.DATA.T13),$("<span/>").html(p).attr("title",t).attr("data-value",i.DEF).addClass("tooltipHTML").appendTo(o),t=r.find('[rel="def"]').index(),n=$("<td/>").addClass("sh_textCenter").insertAfter(n.find("td:eq("+t+")")),n=$("<div/>").css("display","inline-block").appendTo(n),i.ACTIONS.appendTo(n),t=AGO.Spiohelper.DATA.T11.replace(/\$1/,i.COORDS),$("<a/>").attr("href",i.GALAXY).attr("title",t).text("G").addClass("SHicon").addClass("tooltip").appendTo(n),i=$("<a/>").attr("href",i.ATTACK).attr("title",i.ATTACKTITLE).text("A").addClass("attackIconButton").addClass("SHicon").addClass("tooltip").appendTo(n),AGO.Option.is("M16")&&i.attr("target","ago_fleet_attacks")}return e='<span style="padding: 3px;">'+AGO.Spiohelper.DATA.T12+": "+e.length+" | "+AGO.Spiohelper.DATA.T6+': <span id="SHsummaryLOOT">'+STR.formatNumber(AGO.Spiohelper.data.LOOT.s)+"</span> | "+AGO.Spiohelper.DATA.T7+': <span id="SHsummaryDF">'+STR.formatNumber(AGO.Spiohelper.data.DF.s)+'</span></span><a href="javascript:void(0);" class="sh_arrow_minmax"><img src="/cdn/img/layout/fleetCloseAll.gif"></a>',$("<div/>").width(600).height(20).html(e).addClass("summary").prependTo(a),0<AGO.Spiohelper.data.LOOT.s&&(t='|<table cellspacing="0" cellpadding="10" style="border:0;"><tr><td style="padding-right:10px;">'+AGO.Label.get("L091")+': </td><td class="sh_textRight">'+STR.formatNumber(AGO.Spiohelper.data.LOOT.m)+"</td></tr>",t+='<tr><td style="padding-right:10px;">'+AGO.Label.get("L092")+': </td><td class="sh_textRight">'+STR.formatNumber(AGO.Spiohelper.data.LOOT.k)+"</td></tr>",t+='<tr><td style="padding-right:10px;">'+AGO.Label.get("L093")+': </td><td class="sh_textRight">'+STR.formatNumber(AGO.Spiohelper.data.LOOT.d)+"</td></tr>",t+="</table>",$("#SHsummaryLOOT").attr("title",t).addClass("tooltipHTML").css("cursor","help")),0<AGO.Spiohelper.data.DF.s&&(t='|<table cellspacing="0" cellpadding="10" style="border:0;"><tr><td style="padding-right:10px;">'+AGO.Label.get("L091")+': </td><td class="sh_textRight">'+STR.formatNumber(AGO.Spiohelper.data.DF.m)+"</td></tr>",t+='<tr><td style="padding-right:10px;">'+AGO.Label.get("L092")+': </td><td class="sh_textRight">'+STR.formatNumber(AGO.Spiohelper.data.DF.k)+"</td></tr>",t+="</table>",$("#SHsummaryDF").attr("title",t).addClass("tooltipHTML").css("cursor","help")),a},addCheck:function(e){-1===AGO.Spiohelper.data.CHECKED.indexOf(e)&&(AGO.Spiohelper.data.CHECKED.push(e),AGO.Spiohelper.Save())},removeCheck:function(e){0<AGO.Spiohelper.data.CHECKED.length&&(-1!==(e=AGO.Spiohelper.data.CHECKED.indexOf(e))&&(AGO.Spiohelper.data.CHECKED.splice(e,1),AGO.Spiohelper.Save()))},addAllCheck:function(e){e.find("td.checkSingle").each(function(){var e=/([0-9]+)/.exec($(this).attr("class"))[1];AGO.Spiohelper.addCheck(e)})},removeAllCheck:function(e){e.find("td.checkSingle").each(function(){var e=/([0-9]+)/.exec($(this).attr("class"))[1];AGO.Spiohelper.removeCheck(e)})},prepareForSorting:function(e,t){var a,s;return"coords"===e?(a=0,null!==(s=/([0-9]+):([0-9]+):([0-9]+)/.exec(t))&&(a=NMR.parseInt(("00"+s[1]).slice(-2)+("000"+s[2]).slice(-3)+("00"+s[3]).slice(-2))),a):"age"===e?NMR.parseIntFormat(t):"player"===e?(a=t.replace(/\s\([0-9]+\)/g,""),a=$.trim(a.toLowerCase())):"loot"===e||"df"===e||"def"===e?NMR.parseIntFormat(t):t}};