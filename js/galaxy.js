AGO.Galaxy={status:0,enabled:!1,improve:!1,direction:1,Data:{},Task:{},Messages:function(e,a){"Action"===e?AGO.Galaxy.Action(a):"Display"===e?AGO.Galaxy.Display(a):"sendShips"===e&&AGO.Galaxy.sendShips(a)},Run:function(){AGO.Option.is("G40")&&!AGO.App.OgameMobile&&(AGO.Galaxy.enabled=!0,AGO.Galaxy.improve=AGO.Option.is("G41"),AGO.Galaxy.shrink=AGO.Option.get("G42",2),AGO.Galaxy.status=5,AGO.Galaxy.Show(),document.getElementById("galaxytable")&&AGO.Galaxy.Content())},onKeydown:function(e){if(13===e.keyCode&&!e.cached)return AGO.Galaxy.direction=0,12===e.inputType&&document.activeElement.blur(),DOM.click("#galaxyHeader .btn_blue"),!1;if(12!==e.inputType&&!e.cached){if(32===e.keyCode&&AGO.Option.is("U33"))return-1===AGO.Galaxy.direction?DOM.click("#galaxyHeader .galaxy_icons:nth-child(6)"):1===AGO.Galaxy.direction?DOM.click("#galaxyHeader .galaxy_icons:nth-child(8)"):DOM.click("#galaxyHeader .btn_blue"),!1;if(37===e.keyCode&&(AGO.Galaxy.direction=-1),39===e.keyCode&&(AGO.Galaxy.direction=1),65===e.keyCode)return DOM.click("#solarscroll .backGalaxy"),!1;if(68===e.keyCode)return DOM.click("#solarscroll .forwardGalaxy"),!1}return!0},onSwipe:function(e){AGO.App.OgameMobile||("left"===e&&DOM.click("#solarscroll .backGalaxy"),"right"===e&&DOM.click("#solarscroll .forwardGalaxy"))},Show:function(){var e;AGO.Galaxy.shrink&&DOM.extendClass("inhalt","id","ago_shrink ago_shrink_"+AGO.Galaxy.shrink),(e=STR.splitParameter(document.location.search))&&(e.galaxy&&(AGO.Galaxy.Task.galaxy=+e.galaxy||0),e.system&&(AGO.Galaxy.Task.system=+e.system||0),e.position&&(AGO.Galaxy.Task.position=+e.position||0),e.planet&&(AGO.Galaxy.Task.position=+e.planet||0)),AGO.Task.updateCoords(AGO.Galaxy.Task,1),DOM.addEventsAll("#solarscroll .forwardGalaxy, #solarscroll .backGalaxy, .btn_blue > a",null,{click:AGO.Galaxy.clickArrow}),DOM.addEvents("galaxyContent","id",{click:AGO.Galaxy.click})},Content:function(){var e,a,t,l;if(console.log("galaxy content"),e=document.getElementById("galaxytable"),AGO.Galaxy.status=5,AGO.Galaxy.status&&e&&DOM.updateAttribute(e,null,"ago-status",1,8)){if(a=DOM.getAttribute(e,null,"data-galaxy",2),t=DOM.getAttribute(e,null,"data-system",2),AGO.Galaxy.sameSystem=a===AGO.Galaxy.Data.galaxy&&t===AGO.Galaxy.Data.system,AGO.Galaxy.Data={galaxy:a,system:t,Row:[]},AGO.Galaxy.behave=AGO.Option.is("G51")||AGO.Init.mobile?AGO.Option.is("G52")?3:AGO.isMobile?2:1:0,AGO.Galaxy.behave&&(3===AGO.Galaxy.behave&&DOM.extendClass(e,null,"ago_galaxy_espionage"),a={update:"reload",setting:{id:"G52",mode:"toggle"}},DOM.setData('th[colspan="3"]',e,a),DOM.setData("th.text_moon",e,a),(a=3===AGO.Galaxy.behave?"#008000":2===AGO.Galaxy.behave?"#656977":"")&&DOM.updateStyle('th[colspan="3"]',e,"color",a),(a=AGO.Option.is("commander")?a:2<=AGO.Galaxy.behave?"#656977":"")&&DOM.updateStyle("th.text_moon",e,"color",a)),+(a=DOM.getText("#slotValue",e,7).split("/"))[1]&&(AGO.Fleet.Set("Current",{fleets:+a[0]||0,fleetsSlots:+a[1]||0}),AGO.Init.Messages("Panel","updateTab",{tab:"Flights"})),console.log("galaxy improve"),console.log(AGO.Galaxy.improve),AGO.Galaxy.improve)function o(e,a){a?(e[0].style.width="60px",e[1].style.width="150px",e[4].style.width="160px",DOM.before(e[0],e[1])):(e[1].style.width="60px",e[2].style.width="150px",e[5].style.width="160px",DOM.before(e[1],e[2])),t=e[l],DOM.hasChildren(t)&&(DOM.before(t.children[2],t.children[3]),DOM.before(t.children[4],t.children[5]))}o(e.querySelectorAll("#galaxyheadbg2 th"),!0),e.querySelectorAll(".row").forEach(function(e){o(e.querySelectorAll("td"),!1)}),AGO.Galaxy.showRows(e.querySelectorAll(".row")),AGO.Galaxy.showHighlight(e.querySelectorAll(".row")),AGO.Galaxy.updateDataBase()}},showRows:function(e){var t,l,o,n,i,r,s,a,d,c,y,O,p,G,g,u;for(p=AGO.Option.get("G45",2),g=AGO.Option.is("G58"),u=0;u<e.length;u++)(O={position:u+1}).coords=AGO.Galaxy.Data.galaxy+":"+AGO.Galaxy.Data.system+":"+O.position,O.owncoords=AGO.Planets.owncoords(O.coords,1),O.coordsActive=AGO.Task.cutCoords(AGO.Panel.GetActive("Target","coords",6)),O.coordsCurrent=AGO.Galaxy.Task.coords,AGO.Galaxy.Data.Row[O.position]=O,s=r=i=n=o=l=t=void 0,DOM.iterateChildren(e[u],function(e){var a=e.className||"";HTML.hasClass(a,"allytag")?t=e:HTML.hasClass(a,"playername")?l=e:HTML.hasClass(a,"microplanet")?o=e:HTML.hasClass(a,"moon")?n=e:HTML.hasClass(a,"debris")?i=e:HTML.hasClass(a,"position")?r=e:HTML.hasClass(a,"planetname")&&(s=e)}),t&&(a=t.querySelector(".allytagwrapper"),G=DOM.getAttribute(a,null,"rel"),O.allianceId=STR.check(NMR.parseIntFormat(G)),a&&O.allianceId&&(O.allianceTag=DOM.getTextChild(a,null,7),O.allianceOwn=HTML.hasClass(a.className,"status_abbr_ally_own")?41:0,O.allianceColor=AGO.Token.getClass(AGO.Galaxy.getToken("Alliance",O.allianceId)||O.allianceOwn),O.allianceColor&&DOM.addClass(t,null,O.allianceColor),d=a.querySelector(".htmlTooltip"),c=a.querySelector(".htmlTooltip .ListLinks"),d&&c&&(O.allianceName=DOM.getText("h1",d,7),O.allianceRank=DOM.getText(".rank a",c,2),O.allianceMember=DOM.getText(".members",c,2),y={tab:"Alliance",id:O.allianceId,name:O.allianceName,tag:O.allianceTag},DOM.setData(c,null,y),AGO.Option.is("G44")&&(c=DOM.appendA(null,{class:"ago_galaxy_rank",href:DOM.getAttribute(".rank a",c,"href")}),y=("ago_galaxy_rank "+O.allianceColor).trim(),DOM.appendSPAN(c,y,O.allianceRank+"/"+O.allianceMember),DOM.appendChild(t,c)),g||(DOM.setAttribute(a,null,"rel",G+String.fromCharCode(65+O.position)),DOM.setAttribute(d,null,"id",G+String.fromCharCode(65+O.position)))))),l&&!O.owncoords&&(a=l.querySelector("a.tooltipRel"),G=DOM.getAttribute(a,null,"rel"),O.playerId=STR.check(NMR.parseIntFormat(G)),a&&O.playerId&&(O.playerBuddy=DOM.hasClass(r,null,"status_abbr_buddy")?51:0,O.playerColor=AGO.Token.getClass(AGO.Galaxy.getToken("Player",O.playerId)||O.playerBuddy)||O.allianceColor,O.playerStatus=AGO.Token.getPlayerStatus(".status > span",l)||21,d=l.querySelector(".htmlTooltip"),c=l.querySelector(".htmlTooltip .ListLinks"),d&&c&&(O.playerName=DOM.getText("h1 span",d,7),O.playerRank=DOM.getText(".rank a",c,2),y={message:{page:"Token",role:"Action",data:{action:"set",tab:"Player",token:81,id:O.playerId,name:O.playerName}}},DOM.setData(a,null,y),y={tab:"Player",id:O.playerId,name:O.playerName},DOM.setData(c,null,y),AGO.Option.is("G43")&&(c=DOM.appendA(null,{class:"ago_galaxy_rank",href:DOM.getAttribute(".rank a",c,"href")}),y=("ago_galaxy_rank "+O.playerColor).trim(),y=DOM.appendSPAN(c,y,1e4<=O.playerRank?"10 k":O.playerRank),DOM.appendChild(AGO.Galaxy.improve?l.nextElementSibling:l,c)),g||(DOM.setAttribute(a,null,"rel",G+String.fromCharCode(65+O.position)),DOM.setAttribute(d,null,"id",G+String.fromCharCode(65+O.position)))))),G=2!==AGO.Galaxy.behave&&!O.allianceOwn&&!O.playerBuddy&&VAL.check(O.playerStatus,21,22,23,26,27,28),o&&(O.planetId=DOM.getAttribute(o,null,"data-planet-id",7),O.planetId&&(d=o.querySelector(".htmlTooltip"),c=o.querySelector(".htmlTooltip .ListLinks"),d&&c&&(O.planetName=DOM.getText("h1 span",d,7),o.querySelector(".activity")&&(O.planetActivity=DOM.getText(c.firstElementChild,null,2)||1)),O.owncoords||(y={tab:"Target",id:O.planetId,name:O.playerName,coords:O.coords+":1"},DOM.setData(c,null,y),G&&(3===AGO.Galaxy.behave&&DOM.extendClass(o,null,"ago_galaxy_espionage"),DOM.setAttribute(o,null,"onclick","sendShips(6,"+O.coords.replace(/:/g,",")+",1,0,0,this); return false;"))))),n&&(O.moonId=DOM.getAttribute(n,null,"data-moon-id",7),O.moonId&&(d=n.querySelector(".htmlTooltip"),c=n.querySelector(".htmlTooltip .ListLinks"),d&&c&&(O.moonName=DOM.getText("h1 span",d,7),n.querySelector(".activity")&&(O.moonActivity=DOM.getText(c.firstElementChild,null,2)||1)),O.owncoords||(y={tab:"Target",id:O.planetId,name:O.playerName,coords:O.coords+":3"},DOM.setData(c,null,y),G&&3===AGO.Galaxy.behave&&DOM.extendClass(n,null,"ago_galaxy_espionage"),AGO.Option.is("commander")&&(a=n.querySelector("a[onclick]"),G&&(d=DOM.getAttribute(a,null,"onclick",7).split(");").join(",0,this);"),DOM.setAttribute(n,null,"onclick",d)),DOM.removeAttribute(a,null,"onclick"))))),i&&(y=i.querySelectorAll(".debris-content"),O.debrisMetal=DOM.getText(y[0],null,2),O.debrisCrystal=DOM.getText(y[1],null,2),O.debrisResources=O.debrisMetal+O.debrisCrystal,O.debrisResources)&&(console.log(O),O.highlightDebris=NMR.isGreater(O.debrisResources,AGO.Token.getLimit(95))?95:NMR.isGreater(O.debrisResources,AGO.Token.getLimit(94))?94:0,(a=i.querySelector("a.tooltipRel div"))&&(a.parentElement.style["text-decoration"]="none"),a.parentElement.style["line-height"]="13px",1===p?(d=Math.max(2+3*(O.debrisResources+"").length-AGO.Galaxy.shrink,14),d=Math.min(d,[30,28,26,24][AGO.Galaxy.shrink]),DOM.set(a,null,{width:d,height:d}),O.highlightDebris&&(a.style.background="url("+HTML.urlImage("galaxy_debris.gif")+")")):1<p&&(y=("ago_galaxy_debris "+AGO.Token.getClass(O.highlightDebris)).trim(),c=DOM.appendDIV(null,y),y=O.highlightDebris?"ago_text_background":"",(y=DOM.appendSPAN(c,y)).innerHTML=(3!==p||AGO.Galaxy.sameSystem?STR.formatNumber(O.debrisMetal):STR.shortNumber(O.debrisMetal,0))+"<br/>"+(3!==p||AGO.Galaxy.sameSystem?STR.formatNumber(O.debrisCrystal):STR.shortNumber(O.debrisCrystal,0)),DOM.setStyleDisplay(a),DOM.appendChild(a.parentNode,c),AGO.Galaxy.improve&&DOM.addClass(i,null,"ago_galaxy_debris_shadow")),O.owncoords||(y={tab:"Target",id:O.planetId,name:O.playerName,coords:O.coords+":2"},DOM.setData(".htmlTooltip .ListLinks",i,y))),O.planetId&&(DOM.addClass(e[u],null,"ago_galaxy_row"),O.positionColor=AGO.Token.getClass(AGO.Galaxy.getToken("Target",O.planetId))||O.playerColor,O.positionColor&&DOM.addClass(r,null,O.positionColor),s&&(O.positionColor?(DOM.addClass(s,null,O.positionColor),DOM.addClass("a",s,O.positionColor),DOM.addClass("span",s,O.positionColor)):AGO.Option.is("CT0")&&DOM.addClass("a",s,"ago_color_bright")));a=c=y=a=null},updateDataBase:function(){var e,a,t;for(a={Player:{},Planet:{}},t=1;t<AGO.Galaxy.Data.Row.length;t++)(e=AGO.Galaxy.Data.Row[t]).playerId?(a.Player[e.playerId]={I:+e.playerId,N:e.playerName,s:e.playerStatus},e.allianceId&&(a.Player[e.playerId].aI=+e.allianceId),a.Planet[e.coords]=e.moonId?{I:+e.playerId,pI:+e.planetId,pN:e.planetName,c:e.coords,mI:+e.moonId,mN:e.moonName}:{I:+e.playerId,pI:+e.planetId,pN:e.planetName,c:e.coords}):a.Planet[e.coords]=null;AGB.message("DataBase","Set",{keyUni:AGO.App.keyUni,data:a})},Display:function(e){var a;console.log(e),(a=document.getElementById("galaxyHeader"))&&(e&&"update"===e.update?(e=a.querySelectorAll(".row"),AGO.Galaxy.showHighlight(e,"update")):DOM.click("#galaxyHeader .btn_blue"))},showHighlight:function(e,a){var t,l,o,n,i,r,s,d,c,y,O;if(n=AGO.Task.cutCoords(AGO.Panel.GetActive("Target","coords",6)),i=AGO.Galaxy.Task.coords,OBJ.is(e)&&OBJ.is(AGO.Galaxy.Data.Row))for(o=0;o<e.length;o++)((t=AGO.Galaxy.Data.Row[o+1]).planetId||t.debrisResources)&&(a&&(y=e[o],O=null,DOM.updateStyle(y,O,"backgroundColor","inherit"),DOM.updateStyle(y,O,"opacity","inherit"),DOM.removeClass(y,O,"ago_highlight"),DOM.setClassGroup(e[o],null,"ago_selected")),(l=(l=!t.coords||t.coords!==n&&t.coords!==i?t.playerId&&t.playerId===AGO.Panel.GetActive("Player","id",6)?"SB":"":"SA")&&AGO.Token.getColor(l)?l:"")&&DOM.extendClass(e[o],null,AGO.Token.getClassSelected(l)),t=AGO.Token.getColorOpacity(AGO.Galaxy.highlight(t)),r=e[o],s=null,c=l,(d=t)&&("string"==typeof d?(DOM.addClass(r,s,"ago_highlight"),DOM.updateStyle(r,s,"backgroundColor",d)):c||DOM.updateStyle(r,s,"opacity",d)))},highlight:function(e){function a(e,a,t,l){var o,n;return(o=AGO.Token.getCondition(a))&&(n=AGO.Token.getLimit(a),n=1===o&&!l||2===o&&NMR.isLesser(e.allianceRank,n)||5===o&&"Player"===t||6===o&&NMR.isLesser(e.playerRank,n)||10===o&&"Target"===t||13===o&&NMR.isGreater(e.debrisResources,n)||16===o&&(NMR.isLesser(e.planetActivity,n)||NMR.isLesser(e.moonActivity,n))),n?a:0}var t;return OBJ.is(e)&&(AGO.Option.is("CE0")&&(t=a(e,99,"",!0)||a(e,96,"",!0)||a(e,98,"",!e.planetActivity&&!e.moonActivity)||a(e,97,"",!e.planetActivity&&!e.moonActivity)||a(e,95,"",!e.debrisResources)||a(e,94,"",!e.debrisResources)||0),!t&&AGO.Option.is("CT0")&&(t=a(e,AGO.Galaxy.getToken("Target",e.planetId),"Target")||a(e,AGO.Galaxy.getToken("Player",e.playerId),"Player")||a(e,e.playerBuddy,"Player")||a(e,e.playerStatus,"Player")||a(e,AGO.Galaxy.getToken("Alliance",e.allianceId),"Alliance")||a(e,e.allianceOwn,"Alliance"))),t||0},getToken:function(e,a){return e&&a&&AGO.Token.Data[e]&&AGO.Token.Data[e][a]&&+STR.check(AGO.Token.Data[e][a]).split("|")[0]||0},Tooltip:function(e){var a;(e=document.querySelector('#galaxytable .tooltipRel[ago-tooltip="'+e+'"]'))&&((e=(e="TD"===e.nodeName?e:e.parentNode).querySelector(".galaxyTooltip .ListLinks"))&&((a=DOM.getData(e,null,1)).tab&&(e.addEventListener("click",AGO.Galaxy.click,!1),AGO.Galaxy.appendTooltipToken(e,a),AGO.Galaxy.appendTooltipSearch(e,a))))},appendTooltipToken:function(e,l){function a(e){var a,t;AGO.Token.getColor(e)&&((a=OBJ.create(l)).action=n===e?"remove":"set",a.token=e,t=AGO.Token.getClass(e)+(n===e?" ago_selected":""),DOM.appendA(DOM.appendLI(o),t,null,{message:{page:"Token",role:"Action",data:a}}).textContent=AGO.Token.getLabel(e))}var o,n,t;if(e&&OBJ.is(l)){if(o=document.createDocumentFragment(),DOM.appendDIV(o,"splitLine"),DOM.appendA(DOM.appendLI(o),null,null,{message:{page:"Token",role:"Action",data:{action:"set",tab:l.tab,token:81,id:l.id,name:l.name,tag:l.tag,coords:l.coords}}}).textContent=AGO.Label.get("DT1"),DOM.append(o,"li",null,{lineHeight:"6px"}).textContent=" ",AGO.Option.is("CT0")){if(n=AGO.Galaxy.getToken(l.tab,l.id),"Alliance"===l.tab)for(t=42;t<50;t++)a(t);if("Player"===l.tab){for(t=52;t<60;t++)a(t);DOM.append(o,"li",null,{lineHeight:"6px"}).textContent=" "}if("Player"===l.tab||"Target"===l.tab)for(t=61;t<80;t++)a(t)}e.appendChild(o)}},appendTooltipSearch:function(e,a){var t,l,o;if(AGO.Option.is("T00")&&a.id&&("Alliance"===a.tab||"Player"===a.tab)){for(t=document.createDocumentFragment(),DOM.appendDIV(t,"splitLine"),o=0;o<AGO.Tools.List.length;o++){var n="T1"+AGO.Tools.List[o],i=void 0,r=void 0;AGO.Option.is(n)&&(l=!0,i={message:{page:"Tools",role:"Action",data:{id:n,Search:OBJ.create(a)}}},r=AGO.Option.getPair(n)[0]||AGO.Label.get(n),DOM.appendA(DOM.appendLI(t),"",null,i).textContent=r)}l&&e.appendChild(t)}},getActivityTooltip:function(){return""},getDebrisTooltip:function(){return""},get:function(e,a){if(a){if(!e)return AGO.Galaxy.Data[a]||0;if(OBJ.is(AGO.Galaxy.Data.Row)&&OBJ.is(AGO.Galaxy.Data.Row[e]))return AGO.Galaxy.Data.Row[e][a]}return 0},Action:function(a){var e,t,l,o;console.log("galaxy action"),e=AGO.Galaxy.Data,AGO.Galaxy.status&&e&&OBJ.get(a,"id")&&(l={Alliance:"allianceId",Player:"playerId",Target:"planetId"}[a.tab],OBJ.iterateArray(e.Row,function(e){OBJ.get(e,l)===a.id&&(o="update")}),"Target"===a.tab&&(AGO.Galaxy.Task={},t=AGO.Galaxy.Task,AGO.Task.cutSystem(a.id)===e.galaxy+":"+e.system&&(o="update"),"set"===a.action||"select"===a.action)&&(o="update",AGO.Task.updateCoords(t,4,a),t.galaxy&&t.galaxy!==e.galaxy&&(o="reload",DOM.setValue("galaxy_input","id",t.galaxy)),t.system&&t.system!==e.system&&(o="reload",DOM.setValue("system_input","id",t.system))),o&&(o=80<a.token?o:"set"===a.action||"remove"===a.action?"reload":o,AGO.Galaxy.Display({update:o})))},click:function(e){var a;console.log("galaxy click"),e&&e.target&&e.currentTarget&&(DOM.click(".close-tooltip",e.currentTarget.parentNode.parentNode.parentNode),(a=DOM.getData(e.target,null,2)).setting&&("toggle"===a.setting.mode&&(a.setting.value=!AGO.Option.get(a.setting.id,1)),AGO.Option.set(a.setting.id,a.setting.value,1)),a.message&&("Tools"===a.message.page&&OBJ.set(a.message.data,"shiftKeys",e.shiftKey||e.ctrlKey),AGO.Init.Messages(a.message.page,a.message.role,a.message.data)),a.update&&AGO.Galaxy.Display(a))},clickArrow:function(e){e&&e.currentTarget&&(AGO.Galaxy.direction="showbutton"===e.currentTarget.parentNode.id?0:DOM.hasClass(e.currentTarget,null,"backGalaxy")?-1:1)},sendShips:function(e){var a,t;a=AGO.Fleet.Get("Current","fleets"),t=AGO.Fleet.Get("Current","fleetsSlots"),DOM.setStyleColor("#galaxytable #slots",null,"start"===e.mode?"#FF4B00":t&&t<=a?"#D43635":"#00B000")}};