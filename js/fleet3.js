AGO.Fleet3={filterContinue:"routine holdingtime expeditiontime union retreatAfterDefenderRetreat metal crystal deuterium preferResource arrivalUnion nameUnion coordsMarked arrivalMarked".split(" "),routine:{2:"F60",3:"FA0",4:"FH0",5:"F80",6:"F90",7:"F70",10:"FL0"},Messages:function(e,t){"Action"===e?PAGE.Action(t):"Continue"===e?PAGE.Continue():PAGE.lockedDisplay||"Display"===e&&PAGE.Display()},Read:function(){var n,e,t;(e=document.getElementById("inhalt"))&&AGO.Option.is("F00")&&(PAGE.enabled=!0,n=PAGE.Para=OBJ.parse(AGO.Fleet.Get("Current","Task3",6)),DOM.iterate(document.querySelectorAll('#sendfleet .content > form input[type="hidden"]'),function(e){var t,a;(t=STR.trim(e.name))&&(a=NMR.parseIntAbs(t),n[200<a?a:t]=+e.value||0)}),3<=(e=e.querySelectorAll("#fleetStatusBar li")).length&&(t=STR.trim(DOM.getText(e[1],null).split("]")[1]),n.planetName=1===n.type?t:"",n.moonName=3===n.type?t:"",n.playerHonor=AGO.Ogame.getPlayerHonor(DOM.getAttribute("span.honorRank",e[2],"class")),n.playerStatus=AGO.Token.getPlayerStatus('span[class^="status_abbr"]',e[2])||21,n.playerName=STR.trim(DOM.getText(e[2],null).split(":")[1])),n.union=n.union2,AGO.Task.updateShips(n),AGO.Task.updateCoords(n,4),PAGE.Next=OBJ.create(n),e=5===n.routine?"F81":6===n.routine?"F91":"F31",PAGE.Mini=AGO.Task.splitActive(AGO.Option.get(e,-1),1,0),PAGE.Mini.preferResource=NMR.minMax(PAGE.Mini.preferResource,1,3),AGO.Fleet.Set("Current","Task3","")),n=e=e=null},Run:function(){PAGE.enabled&&PAGE.Show()},Ready:function(){var e,t,a;(a=document.getElementById("inhalt"))&&PAGE.enabled&&(PAGE.lockedDisplay=!0,e=PAGE.Para,AGO.Option.is("F51")&&OBJ.iterateArray([15,7,8,6,1,4,3],function(e){a.querySelector("#missions a.selected")||a.querySelector("#button"+e+".on")&&DOM.click("#missionButton"+e)}),t={holdingtime:e.holdingtime,expeditiontime:e.expeditiontime,retreatAfterDefenderRetreat:e.retreatAfterDefenderRetreat},2===e.routine&&(t.action="set",t.metal=e.metal,t.crystal=e.crystal,t.deuterium=e.deuterium),5===e.routine&&(t.action="setMost"),PAGE.Action(t),e.owncoords&&AGO.Init.Messages("Planets","Action",{mode:"select",coords:e.coords,type:e.type}),DOM.addEvents("#planet h2",null,{click:PAGE.onSummary}),DOM.addEvents("#wrap #resources",null,{click:PAGE.onBriefing}),DOM.addEvents("back","id",{click:PAGE.Back}),DOM.addEvents("ago_fleet_marked","id",{click:PAGE.onMarked}),DOM.addEventsAll("#missions .on a",null,{dblclick:PAGE.onMission})),e=a=t=null},Timer:function(){PAGE.displayUnion(),PAGE.displayMarked()},Show:function(){var e,t,a,n,i,l,o,r;e=PAGE.Para,(t=document.getElementById("inhalt"))&&(DOM.extendClass(t,null,"ago ago_improve"),PAGE.showSummary(),(n=t.querySelector("#buttonz .header h2"))&&(DOM.setStyleDisplay(n),DOM.appendChild(n.parentNode,t.querySelector("#missionName"))),(n=t.querySelector("#missions"))&&(DOM.iterate(n.querySelectorAll("li.off a"),function(e){e.onclick=null}),a=document.createDocumentFragment(),l=PAGE.Next.arrivalUnion?null:{display:"none"},l=DOM.appendDIV(a,{class:"ago_fleet_details",id:"ago_fleet_union"},l),DOM.appendSPAN(l,"ago_fleet_label"),DOM.appendSPAN(l,"ago_fleet_duration"),DOM.appendSPAN(l,"ago_fleet_count"),DOM.appendSPAN(l,"ago_fleet_arrival"),l=PAGE.Next.arrivalMarked?null:{display:"none"},l=DOM.appendDIV(a,{class:"ago_fleet_details ago_panel_remove",id:"ago_fleet_marked"},l),DOM.appendSPAN(l,"ago_fleet_label"),DOM.appendSPAN(l,"ago_fleet_duration"),DOM.appendSPAN(l,"ago_fleet_count"),DOM.appendSPAN(l,"ago_fleet_arrival"),l=DOM.appendDIV(a,{class:"ago_fleet_details",id:"ago_fleet_details"}),(i=t.querySelector("#duration"))&&(DOM.setStyleDisplay(i.parentNode),r=DOM.getTextChild(i.parentNode),DOM.appendSPAN(l,"ago_fleet_label",r),DOM.appendSPAN(l,"ago_fleet_duration")),(i=t.querySelector("#arrivalTime"))&&(i.textContent=AGO.Time.convertLocal(i.textContent,"[H]:[i]:[s]"),DOM.setStyleDisplay(i.parentNode.parentNode),DOM.appendSPAN(l,"ago_fleet_name",DOM.getTextChild(i.parentNode.parentNode)),(o=DOM.appendSPAN(l,"ago_fleet_arrival")).appendChild(i)),l=DOM.appendDIV(a,{class:"ago_fleet_details",id:"ago_fleet_return"}),(i=t.querySelector("#returnTime"))&&(DOM.setStyleDisplay(i.parentNode.parentNode),DOM.appendSPAN(l,"ago_fleet_label",(r||"").split("(")[0]+":"),DOM.appendSPAN(l,"ago_fleet_duration"),DOM.appendSPAN(l,"ago_fleet_name",DOM.getTextChild(i.parentNode.parentNode)),DOM.appendSPAN(l,"ago_fleet_arrival").appendChild(i)),n.parentNode.appendChild(a)),(n=t.querySelector("#roundup ul"))&&!AGO.App.OgameMobile&&((i=n.querySelector("#fightAfterRetreat + li span"))&&(i.className="value",l=document.createElement("li"),DOM.appendSPAN(l,"value").innerHTML=HTML.getPlayer(e.playerName,e.playerStatus,e.playerHonor),DOM.after(i.parentNode,l)),(i=n.querySelector("#consumption"))&&(DOM.removeChildren(i.parentNode,3),l=DOM.appendLI(null,{id:"speedLinks"}),DOM.appendSPAN(l,{class:"value selected","data-value":e.speed},10*e.speed+" %"),DOM.after(i.parentNode.parentNode,l)),a=document.createDocumentFragment(),DOM.appendChild(a,n.querySelector("#holdtimeline")),DOM.appendChild(a,n.querySelector("#expeditiontimeline")),DOM.appendChild(a,n.querySelector("#fightAfterRetreat")),n.appendChild(a)),(n=t.querySelector("#loadAllResources"))&&!AGO.App.OgameMobile&&(a=document.createDocumentFragment(),DOM.appendA(a,{id:"allresources",class:"ago_fleet_loadAllResources tooltip js_hideTipOnMobile",title:n.textContent},null,{action:"setAll"}),DOM.appendA(a,{id:"mostresources",class:"ago_fleet_loadAllResources tooltip js_hideTipOnMobile",title:AGO.Label.get("F38")},null,{action:"setMost"}),DOM.appendA(a,{id:"noneresources",class:"ago_fleet_loadAllResources tooltip js_hideTipOnMobile",title:AGO.Label.get("F39")},null,{action:"setNone"}),DOM.replaceChildren(n,a),OBJ.iterate(AGO.Item.Resource,function(e){(i=n.parentNode.querySelector("#"+e))&&(a=document.createDocumentFragment(),DOM.appendA(a,"ago_fleet_loadResource ago_fleet_allResource",null,{action:"setAllById",id:e}),DOM.appendA(a,"ago_fleet_loadResource ago_fleet_mostResource",null,{action:"setMostById",id:e}),DOM.appendA(a,"ago_fleet_loadResource ago_fleet_noneResource",null,{action:"setNoneById",id:e}),i.parentNode.parentNode.appendChild(a),(o=i.parentNode.parentNode.querySelector(".resourceIcon"))&&(DOM.setData(o,null,{action:"toggleById",id:e}),DOM.appendSPAN(o,{class:"ago_fleet_remaining_resource ago_text_background",id:"ago_fleet_remaining_"+e})))}))),e=t=a=n=i=l=o=null},showSummary:function(){function e(e,t){return 0===e?"ago_color_blue":e===t?"ago_color_palered":e===t-1?"ago_color_orange":"ago_color_lightgreen"}var t,a,n,i,l,o,r;if(t=document.getElementById("planet")){for(AGO.Task.updateResources(PAGE),a=document.createDocumentFragment(),n=DOM.appendDIV(a,{id:"ago_summary_fleets"}),r=e(i=AGO.Fleet.Get("Current","fleets"),l=AGO.Fleet.Get("Current","fleetsSlots")),(n=DOM.appendA(n,{href:AGO.Uni.path+"movement",title:AGO.Label.get("E10"),class:r+" tooltip"})).textContent=AGO.Label.get("F21")+": "+i+"/"+l,r=e(i=AGO.Fleet.Get("Current","expos"),l=AGO.Fleet.Get("Current","exposSlots")),DOM.appendSPAN(n,r,AGO.Label.get("F22")+": "+i+"/"+l),n=DOM.appendDIV(a,{id:"ago_summary"}),i=DOM.appendTABLE(n,null,null,[200,223,223]),l=DOM.appendTR(i,"ago_summary_header"),n=DOM.appendTD(l,{id:"ago_summary_routine"}),n=DOM.appendTD(l,{colspan:2}),l=DOM.appendTR(i,"ago_summary_total"),n=DOM.appendTD(l,null,"I27",10),DOM.appendSPAN(n,{id:"ago_summary_resource"},PAGE.Para.resources,3),n=DOM.appendTD(l,null,"I28",10),DOM.appendSPAN(n,{id:"ago_summary_civil"},PAGE.Para.shipsCivil,3),n=DOM.appendTD(l,null,"I29",10),DOM.appendSPAN(n,{id:"ago_summary_combat"},PAGE.Para.shipsCombat,3),o={Resource:[],ShipCivil:[],ShipCombat:[]},OBJ.iterate(o,function(t){OBJ.iterate(AGO.Item[t],function(e){0<PAGE.Para[e]&&o[t].push(e)})}),r=0;r<9&&(o.Resource[r]||o.ShipCivil[r]||o.ShipCombat[r]);r++)l=DOM.appendTR(i),n=DOM.appendTD(l,null,o.Resource[r],11),DOM.appendSPAN(n,null,PAGE.Para[o.Resource[r]],2),n=DOM.appendTD(l,null,o.ShipCivil[r],11),DOM.appendSPAN(n,null,PAGE.Para[o.ShipCivil[r]],2),n=DOM.appendTD(l,null,o.ShipCombat[r],11),DOM.appendSPAN(n,null,PAGE.Para[o.ShipCombat[r]],2);t.appendChild(a)}t=a=n=i=l=n=o=i=l=r=r=null},Display:function(){var a,t,n,e,i,l;a=PAGE.Next,(t=document.getElementById("inhalt"))&&7<=AGO.Init.status&&(l=PAGE.lockedDisplay=!0,PAGE.updateTask(a,1),a.arrivalUnion=2===a.mission?PAGE.Para.arrivalUnion:0,a.resources=0,OBJ.iterate(AGO.Item.Resource,function(e){var t;t=AGO.Units.get(e),"deuterium"===e&&(t-=DOM.getText("consumption","id",3)),a.resources+=a[e],1.01*a[e]<t-PAGE.Mini[e]&&(l=!1),DOM.setText("ago_fleet_remaining_"+e,"id",Math.max(t-a[e],0),5)}),e=a.resources?l?"ago_fleet_resources_all":"ago_fleet_resources_loaded":"",DOM.updateClass("#naviActions",t,e),DOM.setStyleDisplay("aks","id"),DOM.updateClass("#missionName",t,"missionName "+HTML.classMission(a.mission)),e=0,5===a.mission&&(e=Math.max(a.holdingtime,0),(n=DOM.updateAttribute("#holdtimeline .dropdown a",t,"data-value",e,8))&&DOM.setText(n,null,e,8)),15===a.mission&&(e=Math.max(a.expeditiontime,0),(n=DOM.updateAttribute("#expeditiontimeline .dropdown a",t,"data-value",e,8))&&DOM.setText(n,null,e,8)),a.duration||(a.duration=+AGO.Global.message({role:"getProperty",property:"duration"})||1,DOM.setText("#ago_fleet_details .ago_fleet_duration",t,a.duration,18)),DOM.setText("#ago_fleet_return .ago_fleet_duration",t,2*a.duration+3600*e,18),i=["","metal","crystal","deuterium"][PAGE.Mini.preferResource],OBJ.iterate(AGO.Item.Resource,function(e){(n=t.querySelector(".resourceIcon."+e))&&DOM[e===i?"addClass":"removeClass"](n.parentNode,null,"ago_fleet_preferResource")}),DOM.updateText("ago_summary_routine","id",PAGE.routine[PAGE.Next.routine],10),PAGE.displayUnion(),PAGE.displayMarked()),PAGE.lockedDisplay=!1,a=t=n=null},displayUnion:function(){var e,t,a,n,i,l;e=PAGE.Next,t=document.getElementById("ago_fleet_union"),DOM.hasChildren(t)&&(e.displayUnion!==e.arrivalUnion&&(e.displayUnion=e.arrivalUnion,DOM.updateText(t.children[0],null,e.nameUnion+" ("+AGO.Label.get("F28")+")"),DOM.updateStyle(t,null,"display",e.arrivalUnion?"block":"none"),AGO.Init.Messages("Events","highlight",e.arrivalUnion)),e.arrivalUnion&&(0<=(a=Math.floor(e.arrivalUnion-(AGO.Time.serverTime+AGO.Time.durationRun)/1e3))&&(i=Math.floor(e.duration/130*100),l=Math.floor(1.3*a),n=e.arrivalUnion-a+l,i=e.duration<a?3:i<a?2:0<a?1:0,DOM.updateText(t.children[1],null,l,18),e=AGO.Time.formatTime(Math.abs(e.duration-l))+" / "+AGO.Time.formatTime(Math.abs(a-e.duration)),DOM.updateText(t.children[2],null,e),DOM.updateStyle(t.children[2],null,"color",["#FF0000","#D43635","#FF9600","#99CC00"][i]),DOM.updateText(t.children[3],null,n,17,"[d].[m].[y] [H]:[i]:[s]"))))},displayMarked:function(){var e,t,a,n;e=PAGE.Next,t=document.getElementById("ago_fleet_marked"),DOM.hasChildren(t)&&(e.displayMarked!==e.arrivalMarked&&(e.arrivalMarked=e.displayMarked=1e3<e.arrivalMarked?e.arrivalMarked:0,DOM.updateText(t.children[0],null,AGO.Label.get("I80")+": "+(e.coordsMarked||"")),DOM.updateText(t.children[3],null,e.arrivalMarked,17,"[d].[m].[y] [H]:[i]:[s]"),DOM.updateStyle(t,null,"display",e.arrivalMarked?"block":"none")),e.arrivalMarked&&(a=Math.floor(e.arrivalMarked-(AGO.Time.serverTime+AGO.Time.durationRun)/1e3),n=e.duration<a?3:0<a?2:0,DOM.updateText(t.children[1],null,Math.max(a,0),18),DOM.updateText(t.children[2],null,Math.abs(a-e.duration),18),DOM.updateStyle(t.children[2],null,"color",["#FF0000","#D43635","#FF9600","#99CC00"][n])))},Dialog:function(e,t){e&&"errorBoxDecision"===t&&AGO.Option.is("F18")&&7===PAGE.Next.mission&&AGO.Planets.count>=AGO.Planets.possible&&(window.setTimeout(function(){DOM.click("#errorBoxDecision a.yes")},210),window.setTimeout(function(){DOM.click("#errorBoxDecision a.yes")},610))},Action:function(t){function a(e){return AGO.Units.get(e)-("deuterium"===e?DOM.getText("consumption","id",3):0)}function n(e,t){DOM.setValue(e,"id",Math.max(t,0),8,"keyup")}var e,i,l,o;e=PAGE.Next,(i=document.getElementById("inhalt"))&&AGO.Init.status&&t&&(PAGE.lockedDisplay=!0,l=t.action,t.arrival&&(e.coordsMarked=t.coords||"",e.arrivalMarked=+t.arrival||0),t.holdingtime&&(DOM.setValue("#holdtimeline select",i,Math.max(t.holdingtime,0),8),AGO.Global.message({role:"updateHoldingOrExpTime"})),t.expeditiontime&&(DOM.setValue("#expeditiontimeline select",i,t.expeditiontime,8),AGO.Global.message({role:"updateHoldingOrExpTime"})),t.retreatAfterDefenderRetreat&&DOM.setProperty("#fightAfterRetreat input",i,"checked",!0),t.preferResource&&(e={metal:1,crystal:2,deuterium:3}[t.preferResource])&&(PAGE.Mini.preferResource=e),VAL.check(l,"set","setAll","setMost","setNone")?(OBJ.iterate(AGO.Item.Resource,function(e){n(e,0)}),OBJ.iterateArray((o=PAGE.Mini.preferResource,1===(o=NMR.minMax(o,1,3))?["metal","crystal","deuterium"]:2===o?["crystal","deuterium","metal"]:3===o?["deuterium","crystal","metal"]:[]),function(e){n(e,"set"===l?+t[e]||0:"setAll"===l?a(e):"setMost"===l?a(e)-(+PAGE.Mini[e]||0):0)})):VAL.check(l,"setAllById","setMostById","setNoneById")&&t.id in AGO.Item.Resource?(e="setAllById"===l?a(t.id):"setMostById"===l?a(t.id)-(+PAGE.Mini[t.id]||0):0,n(t.id,e)):"toggleById"===l&&t.id in AGO.Item.Resource&&(e=0===(e=DOM.getValue(t.id,"id",2))?a(t.id):e<AGO.Units.get(t.id+"Start")?a(t.id)-e:0,n(t.id,e)),PAGE.Display()),e=i=null},Continue:function(){DOM.hasClass("start","id","on")&&(DOM.addClass("start","id","ago_selected_button"),AGB.message("Units","Action",{planet:AGO.Acc.planetId,tabs:["Ship"],action:"remove",list:[OBJ.create(PAGE.Para)]}),PAGE.updateTask(PAGE.Next,0),AGO.Fleet.Set("Current","Routine",PAGE.Next.routine),AGB.message("Fleet","Action",{tab:"Last",action:"set",data:PAGE.Next,coords:AGO.Acc.coords}),window.setTimeout(function(){AGO.Init.status&&DOM.removeClass("start","id","ago_selected_button")},1500))},Back:function(){var t,a;a={},t=PAGE.Next,DOM.addClass("back","id","ago_selected_button"),PAGE.updateTask(t,1),OBJ.iterateFilter(t,function(e){a[e]=t[e]},PAGE.filterContinue),2!==t.routine&&OBJ.iterate(AGO.Item.Resource,function(e){delete a[e]}),1!==t.mission&&delete a.retreatAfterDefenderRetreat,5!==t.mission&&delete a.holdingtime,15!==t.mission&&delete a.expeditiontime,AGO.Fleet.Set("Current",{Task2:JSON.stringify(a)}),t=a=null},updateTask:function(e,t){var a;(a=document.getElementById("inhalt"))&&e&&(e.holdingtime=DOM.getValue("#holdtimeline select",a,2)||-1,e.expeditiontime=DOM.getValue("#expeditiontimeline select",a,2),e.retreatAfterDefenderRetreat=DOM.getProperty("#fightAfterRetreat input",a,"checked")?1:0,e.mission=DOM.getValue('input[name="mission"]',a,2),1<=t&&(e.metal=DOM.getValue("#metal",a,2),e.crystal=DOM.getValue("#crystal",a,2),e.deuterium=DOM.getValue("#deuterium",a,2)))},onKeydown:function(e){if(13===e.keyCode){if(document.activeElement&&"A"!==document.activeElement.nodeName&&"INPUT"!==document.activeElement.nodeName)return DOM.hasClass("start","id","on")&&DOM.click("#start.on"),!1}else{if(65===e.keyCode)return DOM.click("#allresources"),!1;if(77===e.keyCode)return DOM.click("#mostresources"),!1;if(81===e.keyCode)return DOM.click("#noneresources"),!1}return!0},onSwipe:function(e){"diagUp"===e&&DOM.click("#noneresources"),"diagDown"===e&&DOM.click("#mostresources"),"left"===e&&DOM.click("#back")},onSummary:function(e){e&&e.target&&"click"===e.type&&e.currentTarget&&"H2"===e.target.nodeName&&DOM.click("#planet .toggleHeader")},onMission:function(e){"dblclick"===e.type&&AGO.Option.is("U34")&&(DOM.setClassGroup(this,null,"ago_selected",AGO.Token.getClassSelected("S5")),DOM.click("#start.on"))},onMarked:function(){PAGE.Action({arrival:-1})},onBriefing:function(e){e&&e.target&&"click"===e.type&&((e=DOM.getData(e.target,null,2)).action&&PAGE.Action(e))}};